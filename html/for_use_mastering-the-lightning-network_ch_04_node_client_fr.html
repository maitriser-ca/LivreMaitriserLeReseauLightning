<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<title>Logiciel de n≈ìud Lightning</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article data-line-1">
<div id="header">
</div>
<div id="content">
<div class="sect1 data-line-2">
<h2 id="set_up_a_lightning_node">Logiciel de n≈ìud Lightning</h2>
<div class="sectionbody">
<div class="paragraph data-line-4">
<p>Comme nous l&#8217;avons vu dans les chapitres pr√©c√©dents, un n≈ìud Lightning est un syst√®me informatique qui participe au Lightning Network. Le Lightning Network n&#8217;est pas un produit ou une entreprise ; il s&#8217;agit d&#8217;un ensemble de normes ouvertes qui d√©finissent une base d&#8217;interop√©rabilit√©. En tant que tel, les logiciels de n≈ìud Lightning ont √©t√© cr√©√©s par diverses entreprises et groupes communautaires. La grande majorit√© des logiciels Lightning sont <em>open source</em>, ce qui signifie que le code source est ouvert et sous licence de mani√®re √† permettre la collaboration, le partage et la participation de la communaut√© au processus de d√©veloppement. De m√™me, les impl√©mentations de n≈ìuds Lightning que nous pr√©senterons dans ce chapitre sont toutes open source et sont d√©velopp√©es de mani√®re collaborative.</p>
</div>
<div class="paragraph data-line-6">
<p>Contrairement √† Bitcoin, o√π la norme est d√©finie par une <em>impl√©mentation de r√©f√©rence</em> avec un logiciel (Bitcoin Core), pour Lightning, la norme est d√©finie par une s√©rie de documents standards appel√©s <em>Basis of Lightning Technology</em> (<em>BOLT</em>), disponibles sur <a href="https://github.com/lightningnetwork/lightning-rfc" data-href="https://github.com/lightningnetwork/lightning-rfc"><em>lightning-rfc</em> repository</a>.</p>
</div>
<div class="paragraph data-line-8">
<p>Il n&#8217;y a pas d&#8217;impl√©mentation de r√©f√©rence du Lightning Network, mais il existe plusieurs impl√©mentations concurrentes, BOLT-compatibles et interop√©rables qui sont d√©velopp√©es par diff√©rentes √©quipes et organisations. Les √©quipes qui d√©veloppent des logiciels pour le Lightning Network contribuent √©galement au d√©veloppement et √† l&#8217;√©volution des normes BOLT.</p>
</div>
<div class="paragraph data-line-10">
<p>Une autre diff√©rence majeure entre le logiciel de n≈ìud Lightning et le logiciel de n≈ìud Bitcoin est que les n≈ìuds Lightning n&#8217;ont pas besoin de fonctionner en parall√®le avec des r√®gles de consensus et peuvent avoir des fonctionnalit√©s √©tendues au-del√† de la ligne de base des BOLT. Par cons√©quent, diff√©rentes √©quipes peuvent poursuivre diverses fonctionnalit√©s exp√©rimentales qui, si elles r√©ussissent et sont largement d√©ploy√©es, peuvent faire partie des BOLT plus tard.</p>
</div>
<div class="paragraph pagebreak-before data-line-13">
<p>Dans ce chapitre, vous apprendrez √† configurer chacun des paquets logiciels pour les impl√©mentations de n≈ìuds Lightning les plus courantes. Nous les avons pr√©sent√©s par ordre alphab√©tique afin de souligner que nous ne pr√©f√©rons ni ne recommandons l&#8217;un plus que les autres. Chacun a ses forces et ses faiblesses, et le choix d√©pendra de divers facteurs. Puisqu&#8217;ils sont d√©velopp√©s dans diff√©rents langages de programmation (par exemple, Go, C, etc.), votre choix peut √©galement d√©pendre de votre niveau de familiarit√© et d&#8217;expertise avec un langage sp√©cifique et un ensemble d&#8217;outils de d√©veloppement.</p>
</div>
<div class="sect2 data-line-15">
<h3 id="_environnement_de_d√©veloppement_lightning">Environnement de d√©veloppement Lightning</h3>
<div class="paragraph data-line-17">
<p>Si vous d√©veloppez, vous souhaiterez configurer un environnement de d√©veloppement avec tous les outils, biblioth√®ques et logiciels de support pour √©crire et ex√©cuter des logiciels Lightning. Dans ce chapitre tr√®s technique, nous allons parcourir ce processus √©tape par √©tape. Si le contenu devient trop dense ou si vous ne configurez pas r√©ellement un environnement de d√©veloppement, n&#8217;h√©sitez pas √† passer au chapitre suivant, qui est moins technique.</p>
</div>
<div class="sect3 data-line-19">
<h4 id="_utilisation_de_la_ligne_de_commande">Utilisation de la ligne de commande</h4>
<div class="paragraph data-line-21">
<p>Les exemples de ce chapitre, et plus largement dans la majeure partie de ce livre, utilisent un terminal de ligne de commande. Cela signifie que vous tapez des commandes dans un terminal et recevez des r√©ponses textuelles. En outre, les exemples sont pr√©sent√©s sur un syst√®me d&#8217;exploitation bas√© sur le noyau Linux et le syst√®me logiciel GNU, en particulier la derni√®re version stable √† long terme d&#8217;Ubuntu (Ubuntu 20.04 LTS). La majorit√© des exemples peuvent √™tre r√©pliqu√©s sur d&#8217;autres syst√®mes d&#8217;exploitation tels que Windows ou macOS, avec de petites modifications des commandes. La plus grande diff√©rence entre les syst√®mes d&#8217;exploitation est le <em>gestionnaire de paquets</em> qui installe les diff√©rentes biblioth√®ques de logiciels et leurs pr√©requis. Dans les exemples donn√©s, nous utiliserons apt, qui est le gestionnaire de paquets pour Ubuntu. Sur macOS, un gestionnaire de paquets commun utilis√© pour le d√©veloppement open source est <a href="https://brew.sh" data-href="https://brew.sh">Homebrew</a>, auquel on acc√®de par la commande brew.</p>
</div>
<div class="paragraph data-line-23">
<p>Dans la plupart des exemples ici, nous allons compiler le logiciel directement √† partir du code source. Bien que cela puisse √™tre assez difficile, cela nous donne le plus de pouvoir et de contr√¥le. Vous pouvez choisir d&#8217;utiliser des conteneurs Docker, des paquets pr√©compil√©s ou d&#8217;autres m√©canismes d&#8217;installation √† la place si vous √™tes bloqu√©¬†!</p>
</div>
<div class="admonitionblock tip data-line-26">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-27">
<p>Dans de nombreux exemples de ce chapitre, nous utiliserons l&#8217;interface de ligne de commande du syst√®me d&#8217;exploitation (√©galement appel√©e <em>shell</em>), accessible via une application de <em>terminal</em>. Le shell affichera d&#8217;abord une invite (prompt) comme indicateur qu&#8217;il est pr√™t pour votre commande. Ensuite, vous tapez une commande et appuyez sur la touche Entr√©e, √† laquelle le shell r√©pond avec du texte et une nouvelle invite pour votre prochaine commande. L&#8217;invite peut sembler diff√©rente sur votre syst√®me, mais dans les exemples suivants, elle est indiqu√©e par un symbole $. Dans les exemples, lorsque vous voyez du texte apr√®s un symbole $, ne tapez pas le symbole $ mais tapez la commande qui le suit imm√©diatement. Appuyez ensuite sur la touche Entr√©e pour ex√©cuter la commande. Dans les exemples, les lignes qui suivent chaque commande sont les r√©ponses du syst√®me d&#8217;exploitation √† cette commande. Lorsque vous verrez le prochain pr√©fixe $, vous saurez qu&#8217;il s&#8217;agit d&#8217;une nouvelle commande et vous devrez r√©p√©ter le processus.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-30">
<p>Pour garder les choses coh√©rentes, nous utilisons le shell bash dans tous les exemples de ligne de commande. Alors que d&#8217;autres shells se comporteront de la m√™me mani√®re et que vous pourrez ex√©cuter tous les exemples sans lui, certains scripts shell sont √©crits sp√©cifiquement pour le shell bash et peuvent n√©cessiter des modifications ou des personnalisations pour s&#8217;ex√©cuter dans un autre shell. Pour plus de coh√©rence, vous pouvez installer le shell bash sur Windows et macOS, et il est install√© par d√©faut sur la plupart des syst√®mes Linux.</p>
</div>
</div>
<div class="sect3 data-line-32">
<h4 id="_t√©l√©chargement_du_d√©p√¥t_du_livre">T√©l√©chargement du d√©p√¥t du livre</h4>
<div class="paragraph data-line-34">
<p>Tous les exemples de code sont disponibles dans le d√©p√¥t en ligne du livre. √âtant donn√© que le d√©p√¥t sera tenu √† jour autant que possible, vous devez toujours rechercher la derni√®re version dans le d√©p√¥t en ligne au lieu de la copier √† partir du livre imprim√© ou du livre √©lectronique.</p>
</div>
<div class="paragraph data-line-36">
<p>Vous pouvez t√©l√©charger le d√©p√¥t sous forme de fichier ZIP en visitant <a href="https://github.com/lnbook/lnbook" data-href="https://github.com/lnbook/lnbook">GitHub</a> et en s√©lectionnant le bouton vert Code sur la droite.</p>
</div>
<div class="paragraph data-line-39">
<p>Vous pouvez √©galement utiliser la commande git pour cr√©er un clone sous contr√¥le de versions du d√©p√¥t sur votre ordinateur local. Git est un syst√®me de contr√¥le de version distribu√© utilis√© par la plupart des d√©veloppeurs pour collaborer au d√©veloppement de logiciels et suivre les modifications apport√©es aux d√©p√¥ts de logiciels. T√©l√©chargez et installez git en suivant les instructions <a href="https://git-scm.com" data-href="https://git-scm.com">du projet Git</a>.</p>
</div>
<div class="paragraph data-line-42">
<p>Pour faire une copie locale du d√©p√¥t sur votre ordinateur, ex√©cutez la commande git comme suit¬†:</p>
</div>
<div id="git-clone-lnbook" class="listingblock data-line-45">
<div class="content">
<pre>$ git clone https://github.com/lnbook/lnbook.git</pre>
</div>
</div>
<div class="paragraph data-line-49">
<p>Vous avez maintenant une copie compl√®te du d√©p√¥t de livres dans un dossier appel√© lnbook. Vous voudrez passer au r√©pertoire nouvellement t√©l√©charg√© en ex√©cutant¬†:</p>
</div>
<div id="cd-lnbook" class="listingblock data-line-52">
<div class="content">
<pre>$ cd lnbook</pre>
</div>
</div>
<div class="paragraph data-line-56">
<p>Tous les exemples suivants supposeront que vous ex√©cutez des commandes √† partir de ce dossier.</p>
</div>
</div>
</div>
<div class="sect2 data-line-58">
<h3 id="_conteneurs_docker">Conteneurs Docker</h3>
<div class="paragraph data-line-60">
<p>De nombreux d√©veloppeurs utilisent un <em>conteneur</em> ("container" en anglais), qui est un type de machine virtuelle, pour installer un syst√®me d&#8217;exploitation et applications pr√©configur√©s avec toutes les d√©pendances n√©cessaires. Une grande partie du logiciel Lightning peut √©galement √™tre install√©e √† l&#8217;aide d&#8217;un syst√®me de conteneurs tel que <em>Docker</em> disponible sur <a href="https://docker.com" data-href="https://docker.com">la page d&#8217;accueil de Docker</a>. Les installations de conteneurs sont beaucoup plus faciles, en particulier pour ceux qui ne sont pas habitu√©s √† un environnement de ligne de commande.</p>
</div>
<div class="paragraph data-line-62">
<p>Le d√©p√¥t du livre contient une collection de conteneurs Docker qui peuvent √™tre utilis√©s pour configurer un environnement de d√©veloppement coh√©rent pour pratiquer et reproduire les exemples sur n&#8217;importe quel syst√®me. √âtant donn√© que le conteneur est un syst√®me d&#8217;exploitation complet qui s&#8217;ex√©cute avec une configuration coh√©rente, vous pouvez √™tre s√ªr que les exemples fonctionneront sur votre ordinateur sans avoir √† vous soucier des d√©pendances, des versions de biblioth√®que ou des diff√©rences de configuration.</p>
</div>
<div class="paragraph data-line-64">
<p>Les conteneurs Docker sont souvent optimis√©s pour √™tre petits, c&#8217;est-√†-dire qu&#8217;ils occupent le minimum d&#8217;espace disque. Cependant, dans ce livre, nous utilisons des conteneurs pour <em>standardiser</em> l&#8217;environnement et le rendre coh√©rent pour tous les lecteurs. De plus, ces conteneurs ne sont pas destin√©s √† √™tre utilis√©s pour ex√©cuter des services en arri√®re-plan. Au lieu de cela, ils sont destin√©s √† √™tre utilis√©s pour tester les exemples et apprendre en interagissant avec le logiciel. Pour ces raisons, les conteneurs sont assez volumineux et sont livr√©s avec de nombreux outils de d√©veloppement et utilitaires. G√©n√©ralement, la distribution Alpine est utilis√©e pour les conteneurs Linux en raison de leur taille r√©duite. N√©anmoins, nous fournissons des conteneurs construits sur Ubuntu car de plus en plus de d√©veloppeurs connaissent Ubuntu, et cette familiarit√© est plus importante pour nous que la taille.</p>
</div>
<div class="paragraph data-line-66">
<p>L&#8217;installation et l&#8217;utilisation de Docker et de ses commandes sont d√©taill√©es dans <a href="#appendix_docker">[appendix_docker]</a>. Si vous n&#8217;√™tes pas familier avec Docker, c&#8217;est le bon moment pour passer rapidement en revue cette section.</p>
</div>
<div class="paragraph data-line-68">
<p>Vous pouvez trouver les derni√®res d√©finitions de conteneurs et configurations de compilation dans le d√©p√¥t du livre dans le dossier <em>code/docker</em>. Chaque conteneur se trouve dans un dossier s√©par√©, comme on peut le voir sur ce qui suit¬†:</p>
</div>
<div id="tree" class="listingblock data-line-71">
<div class="content">
<pre>$ tree -F --charset=asciii code/docker</pre>
</div>
</div>
<div id="docker-dir-list" class="listingblock data-line-76">
<div class="content">
<pre>code/docker
|-- bitcoind/
|   |-- bashrc
|   |-- bitcoind/
|   |   |-- bitcoin.conf
|   |   `-- keys/
|   |       |-- demo_address.txt
|   |       |-- demo_mnemonic.txt
|   |       `-- demo_privkey.txt
|   |-- bitcoind-entrypoint.sh
|   |-- cli
|   |-- Dockerfile
|   `-- mine.sh*
|-- c-lightning/
|   |-- bashrc
|   |-- cli
|   |-- c-lightning-entrypoint.sh
|   |-- devkeys.pem
|   |-- Dockerfile
|   |-- fund-c-lightning.sh
|   |-- lightningd/
|   |   `-- config
|   |-- logtail.sh
|   `-- wait-for-bitcoind.sh
|-- eclair/
|   |-- bashrc
|   |-- cli
|   |-- Dockerfile
|   |-- eclair/
|   |   `-- eclair.conf
|   |-- eclair-entrypoint.sh
|   |-- logtail.sh
|   `-- wait-for-bitcoind.sh
|-- lnd/
|   |-- bashrc
|   |-- cli
|   |-- Dockerfile
|   |-- fund-lnd.sh
|   |-- lnd/
|   |   `-- lnd.conf
|   |-- lnd-entrypoint.sh
|   |-- logtail.sh
|   `-- wait-for-bitcoind.sh
|-- check-versions.sh
|-- docker-compose.yml
|-- Makefile
`-- run-payment-demo.sh*</pre>
</div>
</div>
<div class="paragraph data-line-126">
<p>Comme nous le verrons dans les prochaines sections, vous pouvez cr√©er ces conteneurs localement ou les extraire du d√©p√¥t du livre sur <a href="https://hub.docker.com/orgs/lnbook" data-href="https://hub.docker.com/orgs/lnbook"><em>Docker Hub</em></a>. Les sections suivantes supposent que vous avez install√© Docker et que vous √™tes familiaris√© avec l&#8217;utilisation de base de la commande docker.</p>
</div>
</div>
<div class="sect2 data-line-128">
<h3 id="_bitcoin_core_et_regtest">Bitcoin Core et Regtest</h3>
<div class="paragraph data-line-130">
<p>La plupart des impl√©mentations de n≈ìuds Lightning ont besoin d&#8217;acc√©der √† un n≈ìud Bitcoin complet pour fonctionner.</p>
</div>
<div class="paragraph data-line-132">
<p>L&#8217;installation d&#8217;un n≈ìud Bitcoin complet et la synchronisation de la blockchain Bitcoin sortent du cadre de ce livre et constituent une entreprise relativement complexe en soi. Si vous voulez l&#8217;essayer, consultez <a href="https://github.com/bitcoinbook/bitcoinbook" data-href="https://github.com/bitcoinbook/bitcoinbook"><em>Ma√Ætriser Bitcoin</em></a>, "Chapitre 3 : Bitcoin Core : L&#8217;impl√©mentation de r√©f√©rence", qui traite de l&#8217;installation et du fonctionnement d&#8217;un n≈ìud Bitcoin.</p>
</div>
<div class="paragraph data-line-134">
<p>Un n≈ìud Bitcoin peut √™tre utilis√© en mode <code>regtest</code>, o√π le n≈ìud cr√©e une blockchain Bitcoin simul√©e locale √† des fins de test. Dans les exemples suivants, nous utiliserons le mode regtest pour nous permettre de d√©montrer Lightning sans avoir √† synchroniser un n≈ìud Bitcoin ou √† risquer des fonds.</p>
</div>
<div class="paragraph data-line-136">
<p>Le conteneur pour Bitcoin Core est bitcoind. Il est configur√© pour ex√©cuter Bitcoin Core en mode regtest et pour extraire 6 nouveaux blocs toutes les 10 secondes. Son port d&#8217;appel de proc√©dure distante ("Remote Procedure Call" ou "RPC" en anglais) est expos√© sur le port 18443 et est accessible pour les appels RPC avec le nom d&#8217;utilisateur regtest et le mot de passe regtest. Vous pouvez √©galement y acc√©der avec un shell interactif et ex√©cuter les commandes +bitcoin-cli + localement.</p>
</div>
<div class="sect3 data-line-138">
<h4 id="_construire_le_conteneur_bitcoin_core">Construire le conteneur Bitcoin Core</h4>
<div class="paragraph data-line-140">
<p>Pr√©parons le conteneur bitcoind. Le moyen le plus simple consiste √† extraire la derni√®re version du conteneur depuis <em>Docker Hub</em>¬†:</p>
</div>
<div class="listingblock data-line-143">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ docker pull lnbook/bitcoind
Using default tag: latest
latest: Pulling from lnbook/bitcoind
35807b77a593: Pull complete
e1b85b9c5571: Pull complete
[...]
288f1cc78a00: Pull complete
Digest: sha256:861e7e32c9ad650aa367af40fc5acff894e89e47aff4bd400691ae18f1b550e2
Status: Downloaded newer image for lnbook/bitcoind:latest
docker.io/lnbook/bitcoind:latest</code></pre>
</div>
</div>
<div class="paragraph data-line-157">
<p>Vous pouvez √©galement cr√©er le conteneur vous-m√™me √† partir de la d√©finition de conteneur local qui se trouve dans <em>code/docker/bitcoind/Dockerfile</em>.</p>
</div>
<div class="admonitionblock note data-line-160">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-161">
<p>Vous n&#8217;avez pas besoin de cr√©er le conteneur si vous avez pr√©c√©demment utilis√© la commande pull pour l&#8217;extraire de Docker Hub.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-164">
<p>Construire le conteneur localement utilisera un peu moins de bande passante de votre r√©seau, mais prendra plus de temps CPU pour la construction. Nous utilisons la commande docker build pour le construire¬†:</p>
</div>
<div class="listingblock data-line-167">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ cd code/docker
$ docker run -it --name bitcoind lnbook/bitcoind
Starting bitcoind...
Bitcoin Core starting
Waiting for bitcoind to start
bitcoind started
================================================
Imported demo private key
Bitcoin address:  2NBKgwSWY5qEmfN2Br4WtMDGuamjpuUc5q1
Private key:  cSaejkcWwU25jMweWEewRSsrVQq2FGTij1xjXv4x1XvxVRF1ZCr3
================================================
================================================
Balance: 0.00000000
================================================
Mining 101 blocks to unlock some bitcoin
[
  "34c744207fd4dd32b70bac467902bd8d030fba765c9f240a2e98f15f05338964",
  "64d82721c641c378d79b4ff2e17572c109750bea1d4eddbae0b54f51e4cdf23e",

 [...]

  "7a8c53dc9a3408c9ecf9605b253e5f8086d67bbc03ea05819b2c9584196c9294",
  "39e61e50e34a9bd1d6eab51940c39dc1ab56c30b21fc28e1a10c14a39b67a1c3",
  "4ca7fe9a55b0b767d2b7f5cf4d51a2346f035fe8c486719c60a46dcbe33de51a"
]
Mining 6 blocks every 10 seconds
Balance: 50.00000000
[
  "5ce76cc475e40515b67e3c0237d1eef597047a914ba3f59bbd62fc3691849055",
  "1ecb27a05ecfa9dfa82a7b26631e0819b2768fe5e6e56c7a2e1078b078e21e9f",
  "717ceb8b6c329d57947c950dc5668fae65bddb7fa03203984da9d2069e20525b",
  "185fc7cf3557a6ebfc4a8cdd1f94a8fa08ed0c057040cdd68bfb7aee2d5be624",
  "59001ae237a3834ebe4f6e6047dcec8fd67df0352ddc70b6b02190f982a60384",
  "754c860fe1b9e0e7292e1de96a65eaa78047feb4c72dbbde2a1d224faa1499dd"
]</code></pre>
</div>
</div>
<div class="paragraph data-line-206">
<p>Comme vous pouvez le voir, bitcoind d√©marre et mine 101 blocs simul√©s pour d√©marrer la cha√Æne. En effet, selon les r√®gles de consensus Bitcoin, le bitcoin nouvellement extrait n&#8217;est pas d√©pensable tant que 100 blocs ne se sont pas produits. En minant 101 blocs, nous rendons le coinbase du premier bloc d√©pensable. Apr√®s cette activit√© de minage initiale, 6 nouveaux blocs sont extraits toutes les 10 secondes pour faire avancer la cha√Æne.</p>
</div>
<div class="paragraph data-line-208">
<p>Pour l&#8217;instant, il n&#8217;y a pas de transactions. Mais nous avons des bitcoins de test qui ont √©t√© extraits dans le porte-monnaie et qui sont disponibles pour √™tre d√©pens√©s. Lorsque nous connectons certains n≈ìuds Lightning √† cette cha√Æne, nous envoyons du bitcoin √† leurs porte-monnaie afin de pouvoir ouvrir des canaux Lightning entre les n≈ìuds Lightning.</p>
</div>
<div class="sect4 data-line-210">
<h5 id="_interagir_avec_le_conteneur_bitcoin_core">Interagir avec le conteneur Bitcoin Core</h5>
<div class="paragraph data-line-212">
<p>En attendant, nous pouvons √©galement interagir avec le conteneur bitcoind en lui envoyant des commandes shell. Le conteneur envoie un fichier journal au terminal, affichant le processus de minage du processus bitcoind. Pour interagir avec le shell, nous pouvons √©mettre des commandes dans un autre terminal, en utilisant la commande docker exec. Comme nous avons pr√©c√©demment nomm√© le conteneur en cours d&#8217;ex√©cution avec l&#8217;argument name, nous pouvons nous y r√©f√©rer par ce nom lorsque nous ex√©cutons la commande docker exec. Tout d&#8217;abord, ex√©cutons un shell bash interactif¬†:</p>
</div>
<div class="listingblock data-line-214">
<div class="content">
<pre>$ docker exec -it bitcoind /bin/bash
root@e027fd56e31a:/bitcoind# ps x
  PID TTY      STAT   TIME COMMAND
    1 pts/0    Ss+    0:00 /bin/bash /usr/local/bin/mine.sh
    7 ?        Ssl    0:03 bitcoind -datadir=/bitcoind -daemon
   97 pts/1    Ss     0:00 /bin/bash
  124 pts/0    S+     0:00 sleep 10
  125 pts/1    R+     0:00 ps x
root@e027fd56e31a:/bitcoind#</pre>
</div>
</div>
<div class="paragraph data-line-226">
<p>L&#8217;ex√©cution du shell interactif nous place "√† l&#8217;int√©rieur" du conteneur. Il se connecte en tant qu&#8217;utilisateur root, comme nous pouvons le voir √† partir du pr√©fixe root@ dans la nouvelle invite du shell root@e027fd56e31a:/bitcoind#. Si nous ex√©cutons la commande ps x pour voir quels processus sont en cours d&#8217;ex√©cution, nous voyons √† la fois bitcoind et le script mine.sh s&#8217;ex√©cuter en arri√®re-plan. Pour quitter ce shell, appuyez sur Ctrl-D ou entrez <strong>exit</strong>, et vous serez renvoy√© √† l&#8217;invite de votre syst√®me d&#8217;exploitation.</p>
</div>
<div class="paragraph data-line-228">
<p>Au lieu d&#8217;ex√©cuter un shell interactif, nous pouvons √©galement √©mettre une seule commande qui est ex√©cut√©e √† l&#8217;int√©rieur du conteneur. Pour plus de commodit√©, la commande bitcoin-cli a un alias "cli" qui transmet la configuration correcte. Ex√©cutons-le donc pour interroger Bitcoin Core √† propos de la blockchain. Nous ex√©cutons cli getblockchaininfo¬†:</p>
</div>
<div class="listingblock data-line-231">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ docker exec bitcoind cli getblockchaininfo
{
  "chain": "regtest",
  "blocks": 131,
  "headers": 131,
  "bestblockhash": "2cf57aac35365f52fa5c2e626491df634113b2f1e5197c478d57378e5a146110",

[...]

  "warnings": ""
}</code></pre>
</div>
</div>
<div class="paragraph data-line-246">
<p>La commande cli dans le conteneur bitcoind nous permet d&#8217;√©mettre des commandes RPC vers le n≈ìud Bitcoin Core et d&#8217;obtenir des r√©sultats encod√©s en JavaScript Object Notation (JSON).</p>
</div>
<div class="paragraph data-line-248">
<p>De plus, tous nos conteneurs Docker ont un encodeur/d√©codeur JSON en ligne de commande nomm√© jq pr√©install√©. jq nous aide √† traiter les donn√©es au format JSON via la ligne de commande ou √† partir de scripts internes. Vous pouvez envoyer la sortie JSON de n&#8217;importe quelle commande √† jq en utilisant le caract√®re |. Ce caract√®re ainsi que cette op√©ration s&#8217;appellent un "pipe" (tuyau). Appliquons un pipe et un jq √† la commande pr√©c√©dente comme suit¬†:</p>
</div>
<div class="listingblock data-line-251">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ docker exec bitcoind bash -c "cli getblockchaininfo | jq .blocks"
197</code></pre>
</div>
</div>
<div class="paragraph data-line-256">
<p>jq .blocks demande au d√©codeur jq JSON d&#8217;extraire le champ blocks du r√©sultat <span class="keep-together">getblockchaininfo</span>. Dans notre cas, il extrait et imprime la valeur de 197 que nous pourrions utiliser dans une commande ult√©rieure.</p>
</div>
<div class="paragraph data-line-258">
<p>Comme vous le verrez dans les sections suivantes, nous pouvons ex√©cuter plusieurs conteneurs en m√™me temps, puis interagir avec eux individuellement. Nous pouvons √©mettre des commandes pour extraire des informations telles que la cl√© publique du n≈ìud Lightning ou pour prendre des mesures telles que l&#8217;ouverture d&#8217;un canal Lightning vers un autre n≈ìud. Les commandes docker run et docker exec, ainsi que jq pour le d√©codage JSON, sont tout ce dont nous avons besoin pour construire un Lightning Network fonctionnel qui m√©lange de nombreuses impl√©mentations de n≈ìuds diff√©rentes. Cela nous permet d&#8217;essayer diverses exp√©riences sur notre propre ordinateur.</p>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-260">
<h3 id="_le_projet_de_n≈ìud_lightning_c_lightning">Le projet de n≈ìud Lightning c-lightning</h3>
<div class="paragraph data-line-262">
<p><code>c-lightning</code> est une impl√©mentation l√©g√®re, hautement personnalisable et conforme aux normes du protocole LN, d√©velopp√©e par Blockstream dans le cadre du Elements Project. Le projet est open source et d√©velopp√© de mani√®re collaborative sur <a href="https://github.com/ElementsProject/lightning" data-href="https://github.com/ElementsProject/lightning">GitHub</a>.</p>
</div>
<div class="paragraph data-line-264">
<p>Dans les sections suivantes, nous allons construire un conteneur Docker qui ex√©cute un n≈ìud <code>c-lightning</code> se connectant au conteneur bitcoind que nous avons construit pr√©c√©demment. Nous vous montrerons √©galement comment configurer et compiler le logiciel <code>c-lightning</code> directement √† partir du code source.</p>
</div>
<div class="sect3 data-line-266">
<h4 id="_construire_c_lightning_en_tant_que_conteneur_docker">Construire c-lightning en tant que conteneur Docker</h4>
<div class="paragraph data-line-268">
<p>La distribution logicielle de <code>c-lightning</code> a un conteneur Docker, mais il est con√ßu pour ex√©cuter <code>c-lightning</code> dans les syst√®mes de production et √† c√¥t√© d&#8217;un n≈ìud bitcoind. Nous utiliserons un conteneur un peu plus simple configur√© pour ex√©cuter <code>c-lightning</code> √† des fins de d√©monstration.</p>
</div>
<div class="paragraph data-line-270">
<p>Tirons le conteneur <code>c-lightning</code> du d√©p√¥t Docker Hub du livre¬†:</p>
</div>
<div class="listingblock data-line-273">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ docker pull lnbook/c-lightning
Using default tag: latest
latest: Pulling from lnbook/c-lightning

[...]

Digest: sha256:bdefcefe8a9712e7b3a236dcc5ab12d999c46fd280e209712e7cb649b8bf0688
Status: Downloaded image for lnbook/c-lightning:latest
docker.io/lnbook/c-lightning:latest</code></pre>
</div>
</div>
<div class="paragraph data-line-287">
<p>Alternativement, nous pouvons construire le conteneur Docker <code>c-lightning</code> √† partir des fichiers du livre que vous avez pr√©c√©demment t√©l√©charg√©s dans un r√©pertoire nomm√© lnbook. Comme pr√©c√©demment, nous utiliserons la commande docker build dans le sous-r√©pertoire code/docker. Nous taguerons l&#8217;image du conteneur avec la balise lnbook/c-lightning, comme ceci¬†:</p>
</div>
<div class="listingblock data-line-290">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ cd code/docker
$ docker build -t lnbook/c-lightning c-lightning
Sending build context to Docker daemon  91.14kB
Step 1/34 : ARG OS=ubuntu
Step 2/34 : ARG OS_VER=focal
Step 3/34 : FROM ${OS}:${OS_VER} as os-base
 ---&gt; fb52e22af1b0

 [...]

Step 34/34 : CMD ["/usr/local/bin/logtail.sh"]
 ---&gt; Running in 8d3d6c8799c5
Removing intermediate container 8d3d6c8799c5
 ---&gt; 30b6fd5d7503
Successfully built 30b6fd5d7503
Successfully tagged lnbook/c-lightning:latest</code></pre>
</div>
</div>
<div class="paragraph data-line-310">
<p>Notre conteneur est maintenant construit et pr√™t √† fonctionner. Cependant, avant d&#8217;ex√©cuter le conteneur <code>c-lightning</code>, nous devons d√©marrer le conteneur bitcoind dans un autre terminal car <code>c-lightning</code> d√©pend de bitcoind. Nous devrons √©galement mettre en place un r√©seau Docker qui permet aux conteneurs de se connecter les uns aux autres comme s&#8217;ils r√©sidaient sur le m√™me r√©seau local.</p>
</div>
<div class="admonitionblock tip data-line-313">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-314">
<p>Les conteneurs Docker peuvent "se parler" via un r√©seau local virtuel g√©r√© par le syst√®me Docker. Chaque conteneur peut avoir un nom personnalis√©, et d&#8217;autres conteneurs peuvent utiliser ce nom pour r√©soudre son adresse IP et s&#8217;y connecter facilement.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 data-line-317">
<h4 id="_configuration_dun_r√©seau_docker">Configuration d&#8217;un r√©seau Docker</h4>
<div class="paragraph data-line-319">
<p>Une fois qu&#8217;un r√©seau Docker est configur√©, Docker activera le r√©seau sur notre ordinateur local √† chaque d√©marrage de Docker, par exemple apr√®s le red√©marrage. Nous n&#8217;avons donc besoin de configurer un r√©seau qu&#8217;une seule fois en utilisant la commande docker network create. Le nom du r√©seau lui-m√™me n&#8217;est pas important, mais il doit √™tre unique sur notre ordinateur. Par d√©faut, Docker a trois r√©seaux nomm√©s host, bridge et none. Nous allons nommer notre nouveau r√©seau lnbook et le cr√©er comme ceci¬†:</p>
</div>
<div class="listingblock data-line-322">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ docker network create lnbook
ad75c0e4f87e5917823187febedfc0d7978235ae3e88eca63abe7e0b5ee81bfb
$ docker network ls
NETWORK ID          NAME                DRIVER              SCOPE
7f1fb63877ea        bridge              bridge              local
4e575cba0036        host                host                local
ad75c0e4f87e        lnbook              bridge              local
ee8824567c95        none                null                local</code></pre>
</div>
</div>
<div class="paragraph data-line-333">
<p>Comme vous pouvez le voir, l&#8217;ex√©cution de docker network ls nous donne une liste des r√©seaux Docker. Notre r√©seau lnbook a √©t√© cr√©√©. Nous pouvons ignorer l&#8217;ID r√©seau, car il est g√©r√© automatiquement.</p>
</div>
</div>
<div class="sect3 data-line-335">
<h4 id="_ex√©cution_des_conteneurs_bitcoind_et_c_lightning">Ex√©cution des conteneurs bitcoind et c-lightning</h4>
<div class="paragraph data-line-337">
<p>L&#8217;√©tape suivante consiste √† d√©marrer les conteneurs bitcoind et <code>c-lightning</code> et les connecter au r√©seau lnbook. Pour ex√©cuter un conteneur dans un r√©seau sp√©cifique, nous devons passer l&#8217;argument <span class="keep-together">network</span> √† docker run. Pour faciliter la recherche des conteneurs, nous donnerons √©galement √† chacun un nom avec l&#8217;argument name. Nous commen√ßons bitcoind comme ceci¬†:</p>
</div>
<div class="listingblock data-line-340">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ docker run -it --network lnbook --name bitcoind lnbook/bitcoind</code></pre>
</div>
</div>
<div class="paragraph data-line-344">
<p>Vous devriez voir bitcoind d√©marrer et commencer √† miner des blocs toutes les 10 secondes. Laissez-le fonctionner et ouvrez une nouvelle fen√™tre de terminal pour d√©marrer <code>c-lightning</code>. Nous utilisons une commande docker run similaire avec les arguments network et name pour d√©marrer <code>c-lightning</code> comme suit¬†:</p>
</div>
<div class="listingblock data-line-347">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ docker run -it --network lnbook --name c-lightning lnbook/c-lightning
Waiting for bitcoind to start...
Waiting for bitcoind to mine blocks...
Starting c-lightning...
2021-09-12T13:14:50.434Z UNUSUAL lightningd: Creating configuration directory /lightningd/regtest
Startup complete
Funding c-lightning wallet
8a37a183274c52d5a962852ba9f970229ea6246a096ff1e4602b57f7d4202b31
lightningd: Opened log file /lightningd/lightningd.log
lightningd: Creating configuration directory /lightningd/regtest
lightningd: Opened log file /lightningd/lightningd.log</code></pre>
</div>
</div>
<div class="paragraph data-line-362">
<p>Le conteneur <code>c-lightning</code> d√©marre et se connecte au conteneur bitcoind via le r√©seau Docker. Tout d&#8217;abord, notre n≈ìud <code>c-lightning</code> attendra que bitcoind d√©marre, puis il attendra que bitcoind ait min√© du bitcoin dans son porte-monnaie. Enfin, dans le cadre du d√©marrage du conteneur, un script enverra une commande RPC au n≈ìud bitcoind, qui cr√©era une transaction qui financera le porte-monnaie "c-lightning" avec 10 BTC de test. Maintenant, notre n≈ìud <code>c-lightning</code> est non seulement en cours d&#8217;ex√©cution, mais il a m√™me des bitcoins de test avec lesquels jouer¬†!</p>
</div>
<div class="paragraph data-line-364">
<p>Comme nous l&#8217;avons d√©montr√© avec le conteneur bitcoind, nous pouvons √©mettre des commandes vers notre conteneur <code>c-lightning</code> dans un autre terminal pour extraire des informations, ouvrir des canaux, etc. La commande qui nous permet d&#8217;√©mettre des instructions de ligne de commande vers le n≈ìud <code>c-lightning</code> s&#8217;appelle lightning-cli. Cette commande lightning-cli est √©galement alias cli √† l&#8217;int√©rieur de ce conteneur. Pour obtenir les informations du n≈ìud <code>c-lightning</code>, utilisez la commande docker exec suivante dans une autre fen√™tre de terminal¬†:</p>
</div>
<div class="listingblock data-line-367">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ docker exec c-lightning cli getinfo
{
   "id": "026ec53cc8940df5fed5fa18f8897719428a15d860ff4cd171fca9530879c7499e",
   "alias": "IRATEARTIST",
   "color": "026ec5",
   "num_peers": 0,
   "num_pending_channels": 0,

[...]

   "version": "0.10.1",
   "blockheight": 221,
   "network": "regtest",
   "msatoshi_fees_collected": 0,
   "fees_collected_msat": "0msat",
   "lightning-dir": "/lightningd/regtest"
}</code></pre>
</div>
</div>
<div class="paragraph data-line-388">
<p>Nous avons maintenant notre premier n≈ìud Lightning fonctionnant sur un r√©seau virtuel et communiquant avec une blockchain Bitcoin de test. Plus loin dans ce chapitre, nous d√©marrerons plus de n≈ìuds et les connecterons les uns aux autres pour effectuer des paiements Lightning.</p>
</div>
<div class="paragraph data-line-390">
<p>Dans la section suivante, nous verrons √©galement comment t√©l√©charger, configurer et compiler <code>c-lightning</code> directement √† partir du code source. Il s&#8217;agit d&#8217;une √©tape facultative et avanc√©e qui vous apprendra √† utiliser les outils de compilation et vous permettra d&#8217;apporter des modifications au code source <span class="keep-together"><code>c-lightning</code></span>. Avec ces connaissances, vous pouvez √©crire du code, corriger des bogues ou cr√©er un plug-in pour <code>c-lightning</code>.</p>
</div>
<div class="admonitionblock note data-line-393">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-394">
<p>Si vous ne pr√©voyez pas de plonger dans le code source ou la programmation d&#8217;un n≈ìud Lightning, vous pouvez ignorer compl√®tement la section suivante. Le conteneur Docker que nous venons de construire est suffisant pour la plupart des exemples du livre.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 data-line-397">
<h4 id="_installation_de_c_lightning_√†_partir_du_code_source">Installation de c-lightning √† partir du code source</h4>
<div class="paragraph data-line-399">
<p>Les d√©veloppeurs de <code>c-lightning</code> ont fourni des instructions d√©taill√©es pour compiler <code>c-lightning</code> √† partir du code source. Nous suivrons les instructions <a href="https://github.com/ElementsProject/lightning/blob/master/doc/INSTALL.md" data-href="https://github.com/ElementsProject/lightning/blob/master/doc/INSTALL.md">depuis GitHub</a>.</p>
</div>
</div>
<div class="sect3 data-line-401">
<h4 id="_installation_des_biblioth√®ques_et_paquets_pr√©requis">Installation des biblioth√®ques et paquets pr√©requis</h4>
<div class="paragraph data-line-403">
<p>Ces instructions d&#8217;installation supposent que vous compilez <code>c-lightning</code> sur un syst√®me Linux ou similaire avec les outils de compilation GNU. Si ce n&#8217;est pas le cas, recherchez les instructions pour votre syst√®me d&#8217;exploitation dans le d√©p√¥t Elements Project.</p>
</div>
<div class="paragraph data-line-405">
<p>La premi√®re √©tape courante est l&#8217;installation des biblioth√®ques pr√©-requises. Nous utilisons le gestionnaire de paquets apt pour les installer¬†:</p>
</div>
<div class="listingblock data-line-408">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ sudo apt-get update

Get:1 http://security.ubuntu.com/ubuntu bionic-security InRelease [88.7 kB]
Hit:2 http://eu-north-1b.clouds.archive.ubuntu.com/ubuntu bionic InRelease
Get:3 http://eu-north-1b.clouds.archive.ubuntu.com/ubuntu bionic-updates InRelease [88.7 kB]

[...]

Fetched 18.3 MB in 8s (2,180 kB/s)
Reading package lists... Done

$ sudo apt-get install -y \
  autoconf automake build-essential git libtool libgmp-dev \
  libsqlite3-dev python python3 python3-mako net-tools zlib1g-dev \
  libsodium-dev gettext

Reading package lists... Done
Building dependency tree
Reading state information... Done
The following additional packages will be installed:
  autotools-dev binutils binutils-common binutils-x86-64-linux-gnu cpp cpp-7 dpkg-dev fakeroot g++ g++-7 gcc gcc-7 gcc-7-base libalgorithm-diff-perl

 [...]

Setting up libsigsegv2:amd64 (2.12-2) ...
Setting up libltdl-dev:amd64 (2.4.6-14) ...
Setting up python2 (2.7.17-2ubuntu4) ...
Setting up libsodium-dev:amd64 (1.0.18-1) ...

[...]
$</code></pre>
</div>
</div>
<div class="paragraph data-line-442">
<p>Apr√®s quelques minutes et de nombreuses activit√©s √† l&#8217;√©cran, vous aurez install√© tous les paquets et biblioth√®ques n√©cessaires. Beaucoup de ces biblioth√®ques sont √©galement utilis√©es par d&#8217;autres paquets Lightning et sont n√©cessaires pour le d√©veloppement de logiciels en g√©n√©ral.</p>
</div>
</div>
<div class="sect3 data-line-444">
<h4 id="_copie_du_code_source_de_c_lightning">Copie du code source de c-lightning</h4>
<div class="paragraph data-line-446">
<p>Ensuite, nous allons copier la derni√®re version de <code>c-lightning</code> √† partir du d√©p√¥t de code source. Pour ce faire, nous utiliserons la commande git clone, qui clone une copie sous contr√¥le de version sur votre machine locale, vous permettant ainsi de la maintenir synchronis√©e avec les modifications ult√©rieures sans avoir √† t√©l√©charger √† nouveau l&#8217;int√©gralit√© du d√©p√¥t¬†:</p>
</div>
<div class="listingblock data-line-449">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ git clone --recurse https://github.com/ElementsProject/lightning.git
Cloning into 'lightning'...
remote: Enumerating objects: 24, done.
remote: Counting objects: 100% (24/24), done.
remote: Compressing objects: 100% (22/22), done.
remote: Total 53192 (delta 5), reused 5 (delta 2), pack-reused 53168
Receiving objects: 100% (53192/53192), 29.59 MiB | 19.30 MiB/s, done.
Resolving deltas: 100% (39834/39834), done.

$ cd lightning</code></pre>
</div>
</div>
<div class="paragraph data-line-463">
<p>Nous avons maintenant une copie de <code>c-lightning</code> clon√©e dans le sous-dossier <em>lightning</em>, et nous avons utilis√© la commande cd (changer de r√©pertoire) pour entrer dans ce sous-dossier.</p>
</div>
</div>
<div class="sect3 data-line-465">
<h4 id="_compilation_du_code_source_de_c_lightning">Compilation du code source de c-lightning</h4>
<div class="paragraph data-line-467">
<p>Ensuite, nous utilisons un ensemble de <em>scripts de compilation</em> qui sont couramment disponibles dans de nombreux projets open source. Ces scripts de compilation utilisent les commandes configure et make, qui nous <span class="keep-together">permettent  de</span>¬†:</p>
</div>
<div class="ulist data-line-469">
<ul>
<li class="data-line-469">
<p>S√©lectionner les options de compilation et v√©rifiez les d√©pendances n√©cessaires (configure)</p>
</li>
<li class="data-line-470">
<p>Compiler et installer les ex√©cutables et les biblioth√®ques (make)</p>
</li>
</ul>
</div>
<div class="paragraph data-line-472">
<p>Ex√©cuter configure avec l&#8217;option help nous montrera toutes les options disponibles¬†:</p>
</div>
<div class="listingblock data-line-474">
<div class="content">
<pre>$ ./configure --help
Usage: ./configure [--reconfigure] [setting=value] [options]

Options include:
  --prefix= (default /usr/local)
    Prefix for make install
  --enable/disable-developer (default disable)
    Developer mode, good for testing
  --enable/disable-experimental-features (default disable)
    Enable experimental features
  --enable/disable-compat (default enable)
    Compatibility mode, good to disable to see if your software breaks
  --enable/disable-valgrind (default (autodetect))
    Run tests with Valgrind
  --enable/disable-static (default disable)
    Static link sqlite3, gmp and zlib libraries
  --enable/disable-address-sanitizer (default disable)
    Compile with address-sanitizer</pre>
</div>
</div>
<div class="paragraph data-line-495">
<p>Nous n&#8217;avons pas besoin de modifier les valeurs par d√©faut pour cet exemple. Par cons√©quent, nous ex√©cutons √† nouveau  <span class="keep-together">configure</span> sans aucune option pour utiliser les valeurs par d√©faut¬†:</p>
</div>
<div class="listingblock data-line-497">
<div class="content">
<pre>$ ./configure

Compiling ccan/tools/configurator/configurator...done
checking for python3-mako... found
Making autoconf users comfortable... yes
checking for off_t is 32 bits... no
checking for __alignof__ support... yes

[...]

Setting COMPAT... 1
PYTEST not found
Setting STATIC... 0
Setting ASAN... 0
Setting TEST_NETWORK... regtest
$</pre>
</div>
</div>
<div class="paragraph data-line-516">
<p>Ensuite, nous utilisons la commande make pour compiler les biblioth√®ques, les composants et les ex√©cutables du projet <code>c-lightning</code>. Cette partie prendra plusieurs minutes et utilisera intens√©ment le processeur et le disque de votre ordinateur. Attendez-vous √† du bruit de la part des ventilateurs ! Ex√©cutez make¬†:</p>
</div>
<div class="listingblock data-line-519">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ make

cc -DBINTOPKGLIBEXECDIR="\"../libexec/c-lightning\"" -Wall -Wundef -Wmis...

[...]

cc   -Og  ccan-asort.o ccan-autodata.o ccan-bitmap.o ccan-bitops.o ccan-...</code></pre>
</div>
</div>
<div class="paragraph data-line-530">
<p>Si tout se passe bien, vous ne verrez aucun message ERROR stoppant l&#8217;ex√©cution de la commande pr√©c√©dente. Le logiciel <code>c-lightning</code> a √©t√© compil√© √† partir des sources et nous sommes maintenant pr√™ts √† installer les composants ex√©cutables que nous avons cr√©√©s √† l&#8217;√©tape pr√©c√©dente¬†:</p>
</div>
<div class="listingblock data-line-532">
<div class="content">
<pre>$ sudo make install

mkdir -p /usr/local/bin
mkdir -p /usr/local/libexec/c-lightning
mkdir -p /usr/local/libexec/c-lightning/plugins
mkdir -p /usr/local/share/man/man1
mkdir -p /usr/local/share/man/man5
mkdir -p /usr/local/share/man/man7
mkdir -p /usr/local/share/man/man8
mkdir -p /usr/local/share/doc/c-lightning
install cli/lightning-cli lightningd/lightningd /usr/local/bin
[...]</pre>
</div>
</div>
<div class="paragraph data-line-547">
<p>Pour v√©rifier que les commandes lightningd et lightning-cli ont √©t√© correctement install√©es, nous allons demander √† chaque ex√©cutable ses informations de version¬†:</p>
</div>
<div class="listingblock data-line-550">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ lightningd --version
v0.10.1-34-gfe86c11
$ lightning-cli --version
v0.10.1-34-gfe86c11</code></pre>
</div>
</div>
<div class="paragraph data-line-557">
<p>La version se compose de la derni√®re version (v0.10.1), suivie du nombre de modifications depuis la version (34), et enfin d&#8217;un hachage identifiant exactement quelle r√©vision (fe86c11). Vous pouvez voir une version diff√©rente de celle pr√©sent√©e pr√©c√©demment car le logiciel continuera d&#8217;√©voluer longtemps apr√®s la publication de ce livre. Cependant, quelle que soit la version que vous voyez, le fait que les commandes s&#8217;ex√©cutent et r√©pondent avec des informations de version signifie que vous avez r√©ussi √† compiler le logiciel <code>c-lightning</code>.</p>
</div>
</div>
</div>
<div class="sect2 data-line-559">
<h3 id="_le_projet_de_n≈ìud_lightning_network_daemon">Le projet de n≈ìud Lightning Network Daemon</h3>
<div class="paragraph data-line-561">
<p>Le Lightning Network Daemon (LND) est une impl√©mentation compl√®te d&#8217;un n≈ìud LN par Lightning Labs. Le projet LND fournit un certain nombre d&#8217;applications ex√©cutables, notamment lnd (le d√©mon lui-m√™me) et lncli (l&#8217;utilitaire de ligne de commande). LND dispose de plusieurs services de cha√Æne modulables, notamment btcd (un n≈ìud complet), bitcoind (Bitcoin Core) et Neutrino (un nouveau client l√©ger exp√©rimental). LND est √©crit dans le langage de programmation Go. Le projet est open source et d√©velopp√© de mani√®re collaborative sur <a href="https://github.com/LightningNetwork/lnd" data-href="https://github.com/LightningNetwork/lnd">GitHub</a>.</p>
</div>
<div class="paragraph data-line-563">
<p>Dans les prochaines sections, nous allons cr√©er un conteneur Docker pour ex√©cuter LND, compiler LND √† partir du code source et apprendre √† configurer et ex√©cuter LND.</p>
</div>
<div class="sect3 data-line-565">
<h4 id="_le_conteneur_docker_lnd">Le conteneur Docker LND</h4>
<div class="paragraph data-line-567">
<p>Nous pouvons tirer l&#8217;exemple de conteneur Docker LND √† partir du <span class="keep-together">d√©p√¥t</span> Docker Hub du livre¬†:</p>
</div>
<div class="listingblock data-line-570">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ docker pull lnbook/lnd
Using default tag: latest
latest: Pulling from lnbook/lnd
35807b77a593: Already exists
e1b85b9c5571: Already exists
52f9c252546e: Pull complete

[...]

Digest: sha256:e490a0de5d41b781c0a7f9f548c99e67f9d728f72e50cd4632722b3ed3d85952
Status: Downloaded newer image for lnbook/lnd:latest
docker.io/lnbook/lnd:latest</code></pre>
</div>
</div>
<div class="paragraph data-line-586">
<p>Alternativement, nous pouvons construire le conteneur LND localement. Le conteneur se trouve dans <em>code/docker/lnd</em>. Nous changeons le r√©pertoire de travail vers <em>code/docker</em> et ex√©cutons la commande docker build¬†:</p>
</div>
<div class="listingblock data-line-589">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ cd code/docker
$ docker build -t lnbook/lnd lnd
Sending build context to Docker daemon  9.728kB
Step 1/29 : FROM golang:1.13 as lnd-base
 ---&gt; e9bdcb0f0af9
Step 2/29 : ENV GOPATH /go

[...]

Step 29/29 : CMD ["/usr/local/bin/logtail.sh"]
 ---&gt; Using cache
 ---&gt; 397ce833ce14
Successfully built 397ce833ce14
Successfully tagged lnbook/lnd:latest</code></pre>
</div>
</div>
<div class="paragraph data-line-607">
<p>Notre conteneur est maintenant pr√™t √† fonctionner. Comme pour le conteneur <code>c-lightning</code> que nous avons construit pr√©c√©demment, le conteneur LND d√©pend √©galement d&#8217;une instance en cours d&#8217;ex√©cution de Bitcoin Core. Comme pr√©c√©demment, nous devons d√©marrer le conteneur bitcoind dans un autre terminal et y connecter LND via un r√©seau Docker. Nous avons d√©j√† mis en place un r√©seau Docker appel√© lnbook et nous l&#8217;utiliserons √† nouveau ici.</p>
</div>
<div class="admonitionblock tip data-line-610">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-611">
<p>Normalement, chaque op√©rateur de n≈ìud ex√©cute son propre n≈ìud Lightning et son propre n≈ìud Bitcoin sur son propre serveur. Pour nous, un seul conteneur bitcoind peut desservir plusieurs n≈ìuds Lightning. Sur notre r√©seau simul√©, nous pouvons ex√©cuter plusieurs n≈ìuds Lightning, tous connect√©s √† un seul n≈ìud Bitcoin en mode regtest.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 data-line-614">
<h4 id="_ex√©cution_des_conteneurs_bitcoind_et_lnd">Ex√©cution des conteneurs bitcoind et LND</h4>
<div class="paragraph data-line-616">
<p>Comme pr√©c√©demment, nous d√©marrons le conteneur bitcoind dans un terminal et LND dans un autre. Si le conteneur bitcoind est d√©j√† en cours d&#8217;ex√©cution, vous n&#8217;avez pas besoin de le red√©marrer. Laissez-le fonctionner et ignorez l&#8217;√©tape suivante. Pour d√©marrer bitcoind dans le r√©seau lnbook, nous utilisons docker run comme ceci¬†:</p>
</div>
<div class="listingblock data-line-619">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ docker run -it --network lnbook --name bitcoind lnbook/bitcoind</code></pre>
</div>
</div>
<div class="paragraph data-line-623">
<p>Ensuite, nous d√©marrons le conteneur LND que nous venons de construire. Comme pr√©c√©demment, nous devons l&#8217;attacher au r√©seau lnbook et lui donner un nom¬†:</p>
</div>
<div class="listingblock data-line-626">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ docker run -it --network lnbook --name lnd lnbook/lnd
Waiting for bitcoind to start...
Waiting for bitcoind to mine blocks...
Starting lnd...
Startup complete
Funding lnd wallet
{"result":"dbd1c8e2b224e0a511c11efb985dabd84d72d935957ac30935ec4211d28beacb","error":null,"id":"lnd-run-container"}
[INF] LTND: Version: 0.13.1-beta commit=v0.13.1-beta, build=production, logging=default, debuglevel=info
[INF] LTND: Active chain: Bitcoin (network=regtest)
[INF] RPCS: Generating TLS certificates...</code></pre>
</div>
</div>
<div class="paragraph data-line-640">
<p>Le conteneur LND d√©marre et se connecte au conteneur bitcoind via le r√©seau Docker. Tout d&#8217;abord, notre n≈ìud LND attendra que bitcoind d√©marre, puis il attendra que bitcoind ait extrait du bitcoin dans son porte-monnaie. Enfin, dans le cadre du d√©marrage du conteneur, un script enverra une commande RPC au n≈ìud bitcoind, cr√©ant ainsi une transaction qui finance le porte-monnaie LND avec 10 BTC de test.</p>
</div>
<div class="paragraph data-line-642">
<p>Comme nous l&#8217;avons d√©montr√© pr√©c√©demment, nous pouvons envoyer des commandes √† notre conteneur dans un autre terminal pour extraire des informations, ouvrir des canaux, etc. La commande qui nous permet d&#8217;√©mettre des instructions de ligne de commande au d√©mon lnd s&#8217;appelle lncli. Encore une fois, dans ce conteneur, nous avons fourni l&#8217;alias cli qui ex√©cute lncli avec tous les param√®tres appropri√©s. Obtenons les informations sur le n≈ìud √† l&#8217;aide de la commande docker exec dans une autre fen√™tre de terminal¬†:</p>
</div>
<div class="listingblock data-line-645">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ docker exec lnd cli getinfo
{
    "version": "0.13.1-beta commit=v0.13.1-beta",
    "commit_hash": "596fd90ef310cd7abbf2251edaae9ba4d5f8a689",
    "identity_pubkey": "02d4545dccbeda29a10f44e891858940f4f3374b75c0f85dcb7775bb922fdeaa14",

[...]

}</code></pre>
</div>
</div>
<div class="paragraph data-line-657">
<p>Nous avons maintenant un autre n≈ìud Lightning fonctionnant sur le r√©seau lnbook et communiquant avec bitcoind. Si vous ex√©cutez toujours le conteneur <code>c-lightning</code>, il y a maintenant deux n≈ìuds en cours d&#8217;ex√©cution. Ils ne sont pas encore connect√©s l&#8217;un √† l&#8217;autre, mais nous les connecterons bient√¥t.</p>
</div>
<div class="paragraph data-line-659">
<p>Si vous le souhaitez, vous pouvez ex√©cuter n&#8217;importe quelle combinaison de n≈ìuds LND et <code>c-lightning</code> sur le m√™me Lightning Network. Par exemple, pour ex√©cuter un deuxi√®me n≈ìud LND, vous lancez la commande docker run avec un nom de conteneur diff√©rent, comme ceci¬†:</p>
</div>
<div class="listingblock data-line-662">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ docker run -it --network lnbook --name lnd2 lnbook/lnd</code></pre>
</div>
</div>
<div class="paragraph data-line-666">
<p>Dans la commande pr√©c√©dente, nous d√©marrons un autre conteneur LND, en le nommant lnd2. Les noms d√©pendent enti√®rement de vous, tant qu&#8217;ils sont uniques. Si vous ne fournissez pas de nom, Docker construira un nom unique en combinant au hasard deux mots anglais tels que "naughty_einstein" (traduisible en "einstein_coquin"). C&#8217;est le vrai nom que Docker a choisi pour nous quand nous avons √©crit ce paragraphe. Comme c&#8217;est dr√¥le !</p>
</div>
<div class="paragraph data-line-668">
<p>Dans la section suivante, nous verrons comment t√©l√©charger et compiler LND directement √† partir du code source. Il s&#8217;agit d&#8217;une √©tape facultative et avanc√©e qui vous apprendra √† utiliser les outils de compilation du langage Go et vous permettra d&#8217;apporter des modifications au code source LND. Avec cette connaissance, vous pouvez √©crire du code ou corriger des bogues.</p>
</div>
<div class="admonitionblock note data-line-671">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-672">
<p>Si vous ne pr√©voyez pas de plonger dans le code source ou la programmation d&#8217;un n≈ìud Lightning, vous pouvez ignorer compl√®tement la section suivante. Le conteneur Docker que nous venons de construire est suffisant pour la plupart des exemples du livre.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 data-line-675">
<h4 id="_installation_de_lnd_√†_partir_du_code_source">Installation de LND √† partir du code source</h4>
<div class="paragraph data-line-677">
<p>Dans cette section, nous allons cr√©er LND √† partir de z√©ro. LND est √©crit dans le langage de programmation Go. Si vous souhaitez en savoir plus sur Go, recherchez golang au lieu de go pour √©viter des r√©sultats non pertinents. Parce qu&#8217;il est √©crit en Go et non en C ou C++, il utilise un framework de "compilation" diff√©rent du framework GNU autotools/make que nous avons vu pr√©c√©demment et utilis√© pour <code>c-lightning</code>. Ne vous inqui√©tez pas cependant, il est assez facile d&#8217;installer et d&#8217;utiliser les outils golang, et nous montrerons chaque √©tape ici. Go est un langage fantastique pour le d√©veloppement de logiciels collaboratifs car il produit un code tr√®s coh√©rent, pr√©cis et facile √† lire quel que soit le nombre d&#8217;auteurs. Go est cibl√© et "minimaliste" d&#8217;une mani√®re qui encourage la coh√©rence entre les versions du langage. En tant que langage compil√©, il est √©galement assez efficace. Plongeons dans le vif du sujet.</p>
</div>
<div class="paragraph data-line-679">
<p>Nous suivrons les instructions d&#8217;installation trouv√©es dans la <a href="https://github.com/lightningnetwork/lnd/blob/master/docs/INSTALL.md" data-href="https://github.com/lightningnetwork/lnd/blob/master/docs/INSTALL.md">documentation du projet LND</a>.</p>
</div>
<div class="paragraph data-line-681">
<p>Tout d&#8217;abord, nous allons installer le paquet golang et les biblioth√®ques associ√©es. Nous avons strictement besoin de Go version 1.13 ou ult√©rieure. Les paquets du langage Go officiels sont distribu√©s sous forme de fichiers binaires √† partir de <a href="https://golang.org/dl" data-href="https://golang.org/dl">Go Project</a>. Pour plus de commodit√©, ils sont √©galement conditionn√©s sous forme de paquets Debian disponibles via la commande apt. Vous pouvez suivre les instructions de <a href="https://golang.org/dl" data-href="https://golang.org/dl">Go Project</a> ou utiliser les commandes apt suivantes sur un syst√®me Debian/Ubuntu Linux comme d√©crit sur la <a href="https://github.com/golang/go/wiki/Ubuntu" data-href="https://github.com/golang/go/wiki/Ubuntu">page wiki de GitHub au sujet du langage Go</a>¬†:</p>
</div>
<div class="listingblock data-line-684">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ sudo apt install golang-go</code></pre>
</div>
</div>
<div class="paragraph data-line-688">
<p>V√©rifiez que la version correcte est install√©e et pr√™te √† l&#8217;emploi en ex√©cutant¬†:</p>
</div>
<div class="listingblock data-line-691">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ go version
go version go1.13.4 linux/amd64</code></pre>
</div>
</div>
<div class="paragraph data-line-696">
<p>Nous avons la version 1.13.4, nous sommes donc pr√™ts √†&#8230;&#8203; y "aller" ("go" en anglais)¬†! Ensuite, nous devons indiquer √† tous les programmes o√π trouver le code Go. Ceci est accompli en d√©finissant la variable d&#8217;environnement GOPATH. Habituellement, le code Go se trouve dans un r√©pertoire nomm√© <em>gocode</em> directement dans le r√©pertoire personnel de l&#8217;utilisateur. Avec les deux commandes suivantes, nous d√©finissons syst√©matiquement le GOPATH et nous nous assurons que votre shell l&#8217;ajoute √† votre ex√©cutable PATH. Notez que le r√©pertoire personnel de l&#8217;utilisateur est appel√© ~ dans le shell.</p>
</div>
<div class="listingblock data-line-699">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ export GOPATH=~/gocode
$ export PATH=$PATH:$GOPATH/bin</code></pre>
</div>
</div>
<div class="paragraph data-line-704">
<p>Pour √©viter d&#8217;avoir √† d√©finir ces variables d&#8217;environnement √† chaque fois que vous ouvrez un shell, vous pouvez ajouter ces deux lignes √† la fin de votre fichier de configuration bash shell <em>.bashrc</em> dans votre r√©pertoire personnel, en utilisant l&#8217;√©diteur de votre choix.</p>
</div>
</div>
<div class="sect3 data-line-706">
<h4 id="_copie_du_code_source_lnd">Copie du code source LND</h4>
<div class="paragraph data-line-708">
<p>Comme pour de nombreux projets open source de nos jours, le code source de LND se trouve sur GitHub (<em>www.github.com</em>). La commande go get peut le r√©cup√©rer directement en utilisant le protocole Git¬†:</p>
</div>
<div class="listingblock data-line-711">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ go get -d github.com/lightningnetwork/lnd</code></pre>
</div>
</div>
<div class="paragraph data-line-715">
<p>Une fois go get termin√©, vous aurez un sous-r√©pertoire sous GOPATH qui contiendra le code source LND.</p>
</div>
</div>
<div class="sect3 data-line-717">
<h4 id="_compilation_du_code_source_lnd">Compilation du code source LND</h4>
<div class="paragraph data-line-719">
<p>LND utilise le syst√®me de compilation make. Pour construire le projet, nous changeons de r√©pertoire pour le code source de LND, puis utilisons make comme ceci¬†:</p>
</div>
<div class="listingblock data-line-722">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ cd $GOPATH/src/github.com/lightningnetwork/lnd
$ make &amp;&amp; make install</code></pre>
</div>
</div>
<div class="paragraph data-line-727">
<p>Apr√®s plusieurs minutes, vous aurez deux nouvelles commandes, lnd et lncli, install√©es. Essayez-les et v√©rifiez leur version pour vous assurer qu&#8217;elles sont install√©es¬†:</p>
</div>
<div class="listingblock data-line-730">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ lnd --version
lnd version 0.10.99-beta commit=clock/v1.0.0-106-gc1ef5bb908606343d2636c8cd345169e064bdc91
$ lncli --version
lncli version 0.10.99-beta commit=clock/v1.0.0-106-gc1ef5bb908606343d2636c8cd345169e064bdc91</code></pre>
</div>
</div>
<div class="paragraph data-line-737">
<p>Vous verrez probablement une version diff√©rente de celle pr√©sent√©e pr√©c√©demment, car le logiciel continuera d&#8217;√©voluer longtemps apr√®s la publication de ce livre. Cependant, quelle que soit la version que vous voyez, le fait que les commandes s&#8217;ex√©cutent et vous affichent les informations de version signifie que vous avez r√©ussi √† compiler le logiciel LND.</p>
</div>
</div>
</div>
<div class="sect2 data-line-739">
<h3 id="_le_projet_de_n≈ìud_lightning_eclair">Le projet de n≈ìud Lightning Eclair</h3>
<div class="paragraph data-line-741">
<p>Eclair est une impl√©mentation Scala du Lightning Network cr√©√©e par ACINQ. Eclair est √©galement l&#8217;un des porte-monnaie mobiles Lightning les plus populaires et les plus innovants, nous l&#8217;avons utilis√© pour faire d√©monstration d&#8217;un paiement Lightning dans <a href="#getting-started">[getting-started]</a>. Dans cette section, nous examinons le projet de serveur Eclair, qui ex√©cute un n≈ìud Lightning. Eclair est un projet open source et peut √™tre trouv√© sur <a href="https://github.com/ACINQ/eclair" data-href="https://github.com/ACINQ/eclair">GitHub</a>.</p>
</div>
<div class="paragraph data-line-743">
<p>Dans les prochaines sections, nous allons construire un conteneur Docker pour ex√©cuter Eclair, comme nous l&#8217;avons fait pr√©c√©demment avec <code>c-lightning</code> et LND. Nous compilerons √©galement Eclair directement √† partir du code source.</p>
</div>
<div class="sect3 data-line-745">
<h4 id="_le_conteneur_docker_eclair">Le conteneur Docker Eclair</h4>
<div class="paragraph data-line-747">
<p>Tirons le conteneur Eclair du d√©p√¥t Docker Hub du livre¬†:</p>
</div>
<div class="listingblock data-line-750">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ docker pull lnbook/eclair
Using default tag: latest
latest: Pulling from lnbook/eclair
35807b77a593: Already exists
e1b85b9c5571: Already exists

[...]

c7d5d5c616c2: Pull complete
Digest: sha256:17a3d52bce11a62381727e919771a2d5a51da9f91ce2689c7ecfb03a6f028315
Status: Downloaded newer image for lnbook/eclair:latest
docker.io/lnbook/eclair:latest</code></pre>
</div>
</div>
<div class="paragraph data-line-766">
<p>Nous pouvons √©galement construire le conteneur localement. A pr√©sent, vous √™tes presque un expert dans les op√©rations de base de Docker ! Dans cette section, nous allons r√©p√©ter plusieurs des commandes vues pr√©c√©demment pour construire le conteneur Eclair. Le conteneur est situ√© dans <em>code/docker/eclair</em>. Nous commen√ßons dans un terminal en changeant le r√©pertoire de travail en <em>code/docker</em> et en lan√ßant la commande docker build :</p>
</div>
<div class="listingblock data-line-769">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ cd code/docker
$ docker build -t lnbook/eclair eclair
Sending build context to Docker daemon  11.26kB
Step 1/27 : ARG OS=ubuntu
Step 2/27 : ARG OS_VER=focal
Step 3/27 : FROM ${OS}:${OS_VER} as os-base
 ---&gt; fb52e22af1b0

[...]

Step 27/27 : CMD ["/usr/local/bin/logtail.sh"]
 ---&gt; Running in fe639120b726
Removing intermediate container fe639120b726
 ---&gt; e6c8fe92a87c
Successfully built e6c8fe92a87c
Successfully tagged lnbook/eclair:latest</code></pre>
</div>
</div>
<div class="paragraph data-line-789">
<p>Notre image est maintenant pr√™te √† √™tre ex√©cut√©e. Le conteneur Eclair d√©pend √©galement d&#8217;une instance en cours d&#8217;ex√©cution de Bitcoin Core. Comme pr√©c√©demment, nous devons d√©marrer le conteneur bitcoind dans un autre terminal et y connecter Eclair via un r√©seau Docker. Nous avons d√©j√† mis en place un r√©seau Docker appel√© lnbook, et le r√©utiliserons ici.</p>
</div>
<div class="paragraph data-line-791">
<p>Une diff√©rence notable entre Eclair et LND ou <code>c-lightning</code> est qu&#8217;Eclair ne contient pas de porte-monnaie Bitcoin s√©par√©, mais s&#8217;appuie directement sur le porte-monnaie Bitcoin de Bitcoin Core. Rappelons qu&#8217;en utilisant LND, nous avons financ√© son porte-monnaie Bitcoin en ex√©cutant une transaction pour transf√©rer des bitcoins du porte-monnaie Bitcoin Core vers le porte-monnaie Bitcoin de LND. Cette √©tape n&#8217;est pas n√©cessaire avec Eclair. Lors de l&#8217;ex√©cution d&#8217;Eclair, le porte-monnaie Bitcoin Core est utilis√© directement comme source de fonds pour ouvrir des canaux. Par cons√©quent, contrairement aux conteneurs LND ou <code>c-lightning</code>, le conteneur Eclair ne contient pas de script pour transf√©rer des bitcoins dans son porte-monnaie au d√©marrage.</p>
</div>
</div>
<div class="sect3 data-line-793">
<h4 id="_ex√©cution_des_conteneurs_bitcoin_et_eclair">Ex√©cution des conteneurs Bitcoin et Eclair</h4>
<div class="paragraph data-line-795">
<p>Comme pr√©c√©demment, nous d√©marrons le conteneur bitcoind dans un terminal et le conteneur Eclair dans un autre. Si le conteneur bitcoind est d√©j√† en cours d&#8217;ex√©cution, vous n&#8217;avez pas besoin de le red√©marrer. Laissez-le fonctionner et ignorez l&#8217;√©tape suivante. Pour d√©marrer bitcoind dans le r√©seau lnbook, nous utilisons docker run comme ceci¬†:</p>
</div>
<div class="listingblock data-line-798">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ docker run -it --network lnbook --name bitcoind lnbook/bitcoind</code></pre>
</div>
</div>
<div class="paragraph data-line-802">
<p>Ensuite, nous d√©marrons le conteneur Eclair que nous venons de construire. Nous devrons l&#8217;attacher au r√©seau lnbook et lui donner un nom, comme nous l&#8217;avons fait avec les autres conteneurs¬†:</p>
</div>
<div class="listingblock data-line-805">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ docker run -it --network lnbook --name eclair lnbook/eclair
Waiting for bitcoind to start...
Waiting for bitcoind to mine blocks...
Starting eclair...
Eclair node started
INFO  o.b.Secp256k1Context - secp256k1 library successfully loaded
INFO  fr.acinq.eclair.Plugin - loading 0 plugins
INFO  a.e.slf4j.Slf4jLogger - Slf4jLogger started
INFO  fr.acinq.eclair.Setup - hello!
INFO  fr.acinq.eclair.Setup - version=0.4.2 commit=52444b0

[...]</code></pre>
</div>
</div>
<div class="paragraph data-line-821">
<p>Le conteneur Eclair d√©marre et se connecte au conteneur bitcoind via le r√©seau Docker. Tout d&#8217;abord, notre n≈ìud Eclair attendra que bitcoind d√©marre, puis il attendra que bitcoind ait min√© des bitcoins dans son porte-monnaie.</p>
</div>
<div class="paragraph data-line-823">
<p>Comme nous l&#8217;avons d√©montr√© pr√©c√©demment, nous pouvons √©mettre des commandes vers notre conteneur dans un autre terminal pour extraire des informations, ouvrir des canaux, etc. La commande qui nous permet d&#8217;√©mettre des instructions en ligne de commande vers le d√©mon eclair s&#8217;appelle eclair-cli. Comme pr√©c√©demment, dans ce conteneur, nous avons fourni un alias utile √† eclair-cli, appel√© simplement cli, qui offre les arguments et param√®tres n√©cessaires. En utilisant la commande docker exec dans une autre fen√™tre de terminal, nous obtenons les informations depuis le n≈ìud Eclair¬†:</p>
</div>
<div class="listingblock data-line-826">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ docker exec eclair cli getinfo
{
  "version": "0.4.2-52444b0",
  "nodeId": "02fa6d5042eb8098e4d9c9d99feb7ebc9e257401ca7de829b4ce757311e0301de7",
  "alias": "eclair",
  "color": "#49daaa",
  "features": {

[...]

  },
  "chainHash": "06226e46111a0b59caaf126043eb5bbf28c34f3a5e332a1fc7b2b73cf188910f",
  "network": "regtest",
  "blockHeight": 779,
  "publicAddresses": [],
  "instanceId": "01eb7a68-5db0-461b-bdd0-29010df40d73"
}</code></pre>
</div>
</div>
<div class="paragraph data-line-847">
<p>Nous avons maintenant un autre n≈ìud Lightning fonctionnant sur le r√©seau lnbook et communiquant avec bitcoind. Vous pouvez ex√©cuter n&#8217;importe quel nombre et n&#8217;importe quelle combinaison de n≈ìuds Lightning sur le m√™me Lightning Network. N&#8217;importe quel nombre de n≈ìuds Eclair, LND et <code>c-lightning</code> peuvent coexister. Par exemple, pour ex√©cuter un deuxi√®me n≈ìud Eclair, vous lancez la commande docker run avec un nom de conteneur diff√©rent, comme suit¬†:</p>
</div>
<div class="listingblock data-line-850">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ docker run -it --network lnbook --name eclair2 lnbook/eclair</code></pre>
</div>
</div>
<div class="paragraph data-line-854">
<p>Dans la commande pr√©c√©dente, nous d√©marrons un autre conteneur Eclair nomm√© eclair2.</p>
</div>
<div class="paragraph data-line-856">
<p>Dans la section suivante, nous verrons √©galement comment t√©l√©charger et compiler Eclair directement √† partir du code source. Il s&#8217;agit d&#8217;une √©tape facultative et avanc√©e qui vous apprendra √† utiliser les outils de construction des langages Scala et Java et vous permettra d&#8217;apporter des modifications au code source d&#8217;Eclair. Avec cette connaissance, vous pouvez √©crire du code ou corriger des bogues.</p>
</div>
<div class="admonitionblock note data-line-859">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-860">
<p>Si vous ne pr√©voyez pas de plonger dans le code source ou la programmation d&#8217;un n≈ìud Lightning, vous pouvez ignorer compl√®tement la section suivante. Le conteneur Docker que nous venons de construire est suffisant pour la plupart des exemples du livre.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 data-line-863">
<h4 id="_installer_eclair_√†_partir_du_code_source">Installer Eclair √† partir du code source</h4>
<div class="paragraph data-line-865">
<p>Dans cette section, nous allons compiler Eclair √† partir de z√©ro. Eclair est √©crit dans le langage de programmation Scala, qui est compil√© √† l&#8217;aide du compilateur Java. Pour ex√©cuter Eclair, nous devons d&#8217;abord installer Java et ses outils de compilation. Nous suivrons les instructions trouv√©es dans <a href="https://github.com/ACINQ/eclair/blob/master/BUILD.md" data-href="https://github.com/ACINQ/eclair/blob/master/BUILD.md">le document <em>BUILD.md</em></a> du projet Eclair.</p>
</div>
<div class="paragraph data-line-867">
<p>Le compilateur Java requis fait partie d&#8217;OpenJDK 11. Nous aurons √©galement besoin d&#8217;un framework de compilation appel√© Maven, version 3.6.0 ou sup√©rieure.</p>
</div>
<div class="paragraph data-line-869">
<p>Sur un syst√®me Linux Debian/Ubuntu, nous pouvons utiliser la commande apt pour installer √† la fois OpenJDK 11 et Maven, comme illustr√© ci-dessous¬†:</p>
</div>
<div class="listingblock data-line-872">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ sudo apt install openjdk-11-jdk maven</code></pre>
</div>
</div>
<div class="paragraph data-line-876">
<p>V√©rifiez que la version correcte est install√©e en ex√©cutant¬†:</p>
</div>
<div class="listingblock data-line-879">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ javac -version
javac 11.0.7
$ mvn -v
Apache Maven 3.6.1
Maven home: /usr/share/maven
Java version: 11.0.7, vendor: Ubuntu, runtime: /usr/lib/jvm/java-11-openjdk-amd64</code></pre>
</div>
</div>
<div class="paragraph data-line-889">
<p>Nous avons OpenJDK 11.0.7 et Maven 3.6.1, nous sommes donc pr√™ts.</p>
</div>
</div>
<div class="sect3 data-line-891">
<h4 id="_copie_du_code_source_declair">Copie du code source d&#8217;Eclair</h4>
<div class="paragraph data-line-893">
<p>Le code source d&#8217;Eclair se trouve sur GitHub. La commande git clone peut cr√©er une copie locale pour nous. Passons √† notre r√©pertoire personnel et ex√©cutons-le ici¬†:</p>
</div>
<div class="listingblock data-line-896">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ cd ~
$ git clone https://github.com/ACINQ/eclair.git</code></pre>
</div>
</div>
<div class="paragraph data-line-902">
<p>Une fois git clone termin√©, vous aurez un sous-r√©pertoire eclair contenant le code source du serveur Eclair.</p>
</div>
</div>
<div class="sect3 data-line-904">
<h4 id="_compilation_du_code_source_declair">Compilation du code source d&#8217;Eclair</h4>
<div class="paragraph data-line-906">
<p>Eclair utilise le syst√®me de compilation Maven. Pour construire le projet, nous changeons le r√©pertoire de travail pour le code source d&#8217;Eclair, puis utilisons mvn package comme ceci¬†:</p>
</div>
<div class="listingblock data-line-909">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ cd eclair
$ mvn package
[INFO] Scanning for projects...
[INFO] ------------------------------------------------------------------------
[INFO] Reactor Build Order:
[INFO]
[INFO] --------------------&lt; fr.acinq.eclair:eclair_2.13 &gt;---------------------
[INFO] Building eclair_2.13 0.4.3-SNAPSHOT                                [1/4]
[INFO] --------------------------------[ pom ]---------------------------------

[...]


[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  01:06 min
[INFO] Finished at: 2020-12-12T09:43:21-04:00
[INFO] ------------------------------------------------------------------------</code></pre>
</div>
</div>
<div class="paragraph data-line-932">
<p>Apr√®s plusieurs minutes, la compilation du paquets Eclair devrait se terminer. Cependant, l&#8217;action "package" ex√©cutera √©galement des tests, et certains d&#8217;entre eux se connectent √† Internet et peuvent √©chouer. Si vous souhaitez ignorer les tests, ajoutez -DskipTests √† la commande.</p>
</div>
<div class="paragraph data-line-934">
<p>Maintenant, d√©compressez et ex√©cutez le paquet de compilation en suivant les <a href="https://github.com/ACINQ/eclair#installing-eclair" data-href="https://github.com/ACINQ/eclair#installing-eclair">instructions pour l&#8217;installation d&#8217;Eclair</a> sur GitHub.</p>
</div>
<div class="paragraph data-line-936">
<p>Toutes nos f√©licitations¬†! Vous avez construit Eclair √† partir des sources et vous √™tes pr√™t √† coder, tester, corriger des bogues et contribuer √† ce projet !</p>
</div>
</div>
</div>
<div class="sect2 data-line-938">
<h3 id="_construire_un_r√©seau_complet_de_divers_n≈ìuds_lightning">Construire un r√©seau complet de divers n≈ìuds Lightning</h3>
<div class="paragraph data-line-940">
<p>Notre dernier exemple, pr√©sent√© dans cette section, rassemblera tous les diff√©rents conteneurs que nous avons construits pour former un Lightning Network fait de diverses impl√©mentations de n≈ìuds (LND, <code>c-lightning</code>, Eclair). Nous allons composer le r√©seau en connectant les n≈ìuds ensemble et en ouvrant des canaux d&#8217;un n≈ìud √† l&#8217;autre. Comme derni√®re √©tape, nous acheminerons un paiement √† travers ces canaux¬†!</p>
</div>
<div class="paragraph data-line-942">
<p>Dans cet exemple, nous allons cr√©er un Lightning Network de d√©monstration compos√© de quatre n≈ìuds Lightning nomm√©s Alice, Bob, Chan et Dina. Nous connecterons Alice √† Bob, Bob √† Chan et Chan √† Dina. Ceci est illustr√© dans <a href="#alice_bob_chan_dina_network_demo">Un petit r√©seau de d√©monstration de quatre n≈ìuds</a>.</p>
</div>
<div id="alice_bob_chan_dina_network_demo" class="imageblock data-line-946">
<div class="content">
<img src="images/mtln_1002.png" alt="Un petit r√©seau de d√©monstration de quatre n≈ìuds">
</div>
<div class="title">Figure 1. Un petit r√©seau de d√©monstration de quatre n≈ìuds</div>
</div>
<div class="paragraph data-line-948">
<p>Enfin, nous demanderons √† Dina de cr√©er une facture et √† Alice de payer cette facture. Comme Alice et Dina ne sont pas directement connect√©es, le paiement sera achemin√© en tant que des HTLC sur tous les canaux de paiement.</p>
</div>
<div class="sect3 data-line-950">
<h4 id="_utilisation_de_docker_compose_pour_orchestrer_les_conteneurs_docker">Utilisation de docker-compose pour orchestrer les conteneurs Docker</h4>
<div class="paragraph data-line-952">
<p>Pour que cet exemple fonctionne, nous allons utiliser un outil <em>d&#8217;orchestration de conteneurs</em> disponible sous la forme d&#8217;une commande appel√©e docker-compose. Cette commande nous permet de sp√©cifier une application compos√©e de plusieurs conteneurs et d&#8217;ex√©cuter l&#8217;application en lan√ßant tous les conteneurs coop√©rants ensemble.</p>
</div>
<div class="paragraph data-line-954">
<p>Tout d&#8217;abord, installons docker-compose. Les <a href="https://docs.docker.com/compose/install" data-href="https://docs.docker.com/compose/install">instructions</a> d√©pendent de votre syst√®me d&#8217;exploitation.</p>
</div>
<div class="paragraph data-line-956">
<p>Une fois l&#8217;installation termin√©e, vous pouvez v√©rifier votre installation en ex√©cutant <code>docker-compose</code> comme ceci¬†:</p>
</div>
<div class="listingblock data-line-959">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ docker-compose version
docker-compose version 1.21.0, build unknown
[...]</code></pre>
</div>
</div>
<div class="paragraph data-line-966">
<p>Les commandes docker-compose les plus courantes que nous utiliserons sont up et down, par exemple docker-compose up.</p>
</div>
</div>
<div class="sect3 data-line-968">
<h4 id="_configuration_de_docker_compose">Configuration de docker-compose</h4>
<div class="paragraph data-line-970">
<p>Le fichier de configuration pour docker-compose se trouve dans le r√©pertoire <em>code/docker</em> et est nomm√© <em>docker-compose.yml</em>. Il contient une sp√©cification pour un r√©seau et chacun des quatre conteneurs. Le haut du fichier ressemble √† √ßa :</p>
</div>
<div class="listingblock data-line-972">
<div class="content">
<pre>version: "3.3"
networks:
  lnnet:

services:
  bitcoind:
    container_name: bitcoind
    build:
        context: bitcoind
    image: lnbook/bitcoind:latest
    networks:
      - lnnet
    expose:
      - "18443"
      - "12005"
      - "12006"

  Alice:
    container_name: Alice</pre>
</div>
</div>
<div class="paragraph data-line-994">
<p>Le fragment pr√©c√©dent d√©finit un r√©seau appel√© lnnet et un conteneur appel√© bitcoind qui s&#8217;attachera au r√©seau lnnet. Le conteneur est le m√™me que celui que nous avons construit au d√©but de ce chapitre. Nous exposons trois des ports du conteneur, ce qui nous permet de lui envoyer des commandes et de surveiller les blocs et les transactions. Ensuite, la configuration sp√©cifie un conteneur LND appel√© "Alice". Plus bas, vous verrez √©galement les sp√©cifications des conteneurs appel√©s "Bob" (<code>c-lightning</code>), "Chan" (Eclair) et "Dina" (LND √† nouveau).</p>
</div>
<div class="paragraph data-line-996">
<p>√âtant donn√© que toutes ces diverses impl√©mentations suivent les sp√©cifications BOLT et ont √©t√© largement test√©es pour l&#8217;interop√©rabilit√©, elles n&#8217;ont aucune difficult√© √† travailler ensemble pour composer un Lightning Network.</p>
</div>
</div>
<div class="sect3 data-line-998">
<h4 id="_d√©marrage_de_lexemple_de_lightning_network">D√©marrage de l&#8217;exemple de Lightning Network</h4>
<div class="paragraph data-line-1000">
<p>Avant de commencer, nous devons nous assurer que nous n&#8217;ex√©cutons pas d√©j√† l&#8217;un des conteneurs. Si un nouveau conteneur partage le m√™me nom qu&#8217;un conteneur d√©j√† en cours d&#8217;ex√©cution, son lancement √©chouera. Utilisez docker ps, docker stop et docker rm si n√©cessaire pour arr√™ter et supprimer tous les conteneurs en cours d&#8217;ex√©cution¬†!</p>
</div>
<div class="admonitionblock tip data-line-1003">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-1004">
<p>√âtant donn√© que nous utilisons les m√™mes noms pour ces conteneurs Docker orchestr√©s, nous devrons peut-√™tre "faire le m√©nage" pour √©viter tout conflit de noms.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph pagebreak-before data-line-1008">
<p>Pour d√©marrer l&#8217;exemple, nous passons dans le r√©pertoire qui contient le fichier de configuration <em>docker-compose.yml</em> et nous ex√©cutons la commande docker-compose up¬†:</p>
</div>
<div class="listingblock data-line-1011">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ cd code/docker
$ docker-compose up
Creating Chan     ... done
Creating Dina     ... done
Creating bitcoind ... done
Creating Bob      ... done
Creating Alice    ... done
Attaching to Chan, Dina, Alice, bitcoind, Bob
Alice       | Waiting for bitcoind to start...
Bob         | Waiting for bitcoind to start...
Dina        | Waiting for bitcoind to start...
Chan        | Waiting for bitcoind to start...
bitcoind    | Starting bitcoind...
bitcoind    | Waiting for bitcoind to start
bitcoind    | bitcoind started
bitcoind    | ================================================

[...]

Chan        | Starting eclair...
Dina        | Starting lnd...
Chan        | Eclair node started
Alice       | ...Waiting for bitcoind to mine blocks...
Bob         | ...Waiting for bitcoind to mine blocks...
Alice       | Starting lnd...
Bob         | Starting c-lightning...

[...]</code></pre>
</div>
</div>
<div class="paragraph data-line-1043">
<p>Apr√®s le d√©marrage, vous verrez tout un flux de fichiers journaux au fur et √† mesure que chaque n≈ìud d√©marre et signale sa progression. Cela peut sembler assez confus sur votre √©cran, mais chaque ligne de sortie est pr√©fix√©e par le nom du conteneur, comme vu pr√©c√©demment. Si vous souhaitez consulter les journaux d&#8217;un seul conteneur, vous pouvez le faire dans une autre fen√™tre de terminal en utilisant la commande docker-compose logs avec l&#8217;indicateur f (pour <em>follow</em> qui signifie "suivre" en anglais) et le nom de conteneur sp√©cifique¬†:</p>
</div>
<div class="listingblock data-line-1046">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ docker-compose logs -f Alice</code></pre>
</div>
</div>
</div>
<div class="sect3 data-line-1050">
<h4 id="_ouverture_de_canaux_et_routage_dun_paiement">Ouverture de canaux et routage d&#8217;un paiement</h4>
<div class="paragraph data-line-1052">
<p>Notre Lightning Network devrait maintenant fonctionner. Comme nous l&#8217;avons vu dans les sections pr√©c√©dentes de ce chapitre, nous pouvons envoyer des commandes √† un conteneur Docker en cours d&#8217;ex√©cution avec la commande docker exec. Que nous d√©marrions le conteneur avec docker run ou que nous en d√©marrions plusieurs avec docker-compose up, nous pouvons toujours acc√©der aux conteneurs individuellement √† l&#8217;aide des commandes Docker.</p>
</div>
<div class="paragraph data-line-1054">
<p>La d√©mo de paiement est contenue dans un script shell Bash appel√© run-payment-demo.sh. Pour ex√©cuter cette d√©mo, vous devez avoir install√© le shell Bash sur votre ordinateur. La plupart des syst√®mes Linux et de type Unix (par exemple, macOS) ont bash pr√©install√©. Les utilisateurs de Windows peuvent installer le Sous-syst√®me Windows pour Linux et utiliser une distribution Linux comme Ubuntu pour obtenir une commande native bash sur leur ordinateur.</p>
</div>
<div class="paragraph data-line-1056">
<p>Ex√©cutons le script pour voir son effet, puis nous verrons comment il fonctionne en interne. Nous utilisons bash pour l&#8217;ex√©cuter en tant que commande¬†:</p>
</div>
<div class="listingblock data-line-1058">
<div class="content">
<pre>$ cd code/docker
$ bash run-payment-demo.sh
Starting Payment Demo
======================================================

Waiting for nodes to startup
- Waiting for bitcoind startup...
- Waiting for bitcoind mining...
- Waiting for Alice startup...
- Waiting for Bob startup...
- Waiting for Chan startup...
- Waiting for Dina startup...
All nodes have started
======================================================

Getting node IDs
- Alice:  0335e200756e156f1e13c3b901e5ed5a28b01a3131cd0656a27ac5cc20d4e71129
- Bob:    033e9cb673b641d2541aaaa821c3f9214e8a11ada57451ed5a0eab2a4afbce7daa
- Chan:   02f2f12182f56c9f86b9aa7d08df89b79782210f0928cb361de5138364695c7426
- Dina: 02d9354cec0458e0d6dee5cfa56b83040baddb4ff88ab64960e0244cc618b99bc3
======================================================

[...]

Setting up connections and channels
- Alice to Bob
- Open connection from Alice node to Bob's node

- Create payment channel Alice-&gt;Bob


[...]

Get 10k sats invoice from Dina
- Dina invoice:
lnbcrt100u1psnuzzrpp5rz5dg4wy27973yr7ehwns5ldeusceqdaq0hguu8c29n4nsqkznjsdqqcqzpgxqyz5vqsp5vdpehw33fljnmmexa6ljk55544f3syd8nfttqlm3ljewu4r0q20q9qyyssqxh5nhkpjgfm47yxn4p9ecvndz7zddlsgpufnpyjl0kmnq227tdujlm0acdv39hcuqp2vhs40aav70c9yp0tee6tgzk8ut79mr877q0cpkjcfvr
======================================================

Attempting payment from Alice to Dina
Successful payment!</pre>
</div>
</div>
<div class="paragraph data-line-1103">
<p>Comme vous pouvez le voir dans sa sortie, le script obtient d&#8217;abord les ID de n≈ìud (cl√©s publiques) pour chacun des quatre n≈ìuds. Ensuite, il connecte les n≈ìuds et configure un canal de 1¬†000¬†000 de satoshis depuis chaque n≈ìud vers le suivant dans le r√©seau. Enfin, il √©met une facture de 10¬†000 satoshis depuis le n≈ìud de Dina et paie la facture depuis le n≈ìud d&#8217;Alice.</p>
</div>
<div class="admonitionblock tip data-line-1106">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-1107">
<p>Si le script √©choue, vous pouvez essayer de le relancer depuis le d√©but. Ou vous pouvez √©mettre manuellement les commandes trouv√©es dans le script une par une et regarder les r√©sultats.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-1110">
<p>Il y a beaucoup √† revoir dans ce script, mais √† mesure que vous comprenez la technologie sous-jacente, de plus en plus d&#8217;informations deviendront claires. Vous √™tes invit√©s √† revisiter cet exemple plus tard.</p>
</div>
<div class="paragraph data-line-1112">
<p>Bien s√ªr, vous pouvez faire beaucoup plus avec ce r√©seau de test qu&#8217;un paiement √† trois canaux et quatre n≈ìuds. Voici quelques id√©es pour vos exp√©riences :</p>
</div>
<div class="ulist data-line-1114">
<ul>
<li class="data-line-1114">
<p>Cr√©er un r√©seau plus complexe en lan√ßant beaucoup plus de n≈ìuds de diff√©rents types. Modifiez le fichier <em>docker-compose.yml</em> et copiez les sections, en renommant les conteneurs si n√©cessaire.</p>
</li>
<li class="data-line-1116">
<p>Connecter les n≈ìuds dans des topologies plus complexes¬†: itin√©raires circulaires, r√©seau en √©toile ou maillage complet.</p>
</li>
<li class="data-line-1118">
<p>Ex√©cuter de nombreux paiements pour √©puiser la capacit√© du canal. Ex√©cutez ensuite des paiements dans le sens inverse pour r√©√©quilibrer les canaux. Voyez comment l&#8217;algorithme de routage s&#8217;adapte.</p>
</li>
<li class="data-line-1120">
<p>Modifier les frais de canal pour voir comment l&#8217;algorithme de routage n√©gocie plusieurs routes et quelles optimisations il applique. Un itin√©raire long et bon march√© est-il pr√©f√©rable √† un itin√©raire court et co√ªteux¬†?</p>
</li>
<li class="data-line-1122">
<p>Ex√©cuter un paiement circulaire d&#8217;un n≈ìud vers lui-m√™me afin de r√©√©quilibrer ses propres canaux. Voyez comment cela affecte tous les autres canaux et n≈ìuds.</p>
</li>
<li class="data-line-1124">
<p>G√©n√©rer des centaines ou des milliers de petites factures en boucle, puis payez-les le plus rapidement possible dans une autre boucle. Mesurez le nombre de transactions par seconde que vous pouvez extraire de ce r√©seau de test.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip data-line-1127">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-1128">
<p><a href="https://lightningpolar.com" data-href="https://lightningpolar.com">Lightning Polar</a> vous permet de visualiser le r√©seau avec lequel vous avez exp√©riment√© en utilisant Docker.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2 data-line-1131">
<h3 id="_conclusion">Conclusion</h3>
<div class="paragraph data-line-1133">
<p>Dans ce chapitre, nous avons examin√© divers projets qui impl√©mentent les sp√©cifications BOLT. Nous avons cr√©√© des conteneurs pour ex√©cuter un exemple de Lightning Network et appris √† cr√©er chaque projet √† partir du code source. Vous √™tes maintenant pr√™t √† explorer davantage et √† creuser plus profond√©ment.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2023-04-28 02:37:41 -0400
</div>
</div>
</body>
</html>