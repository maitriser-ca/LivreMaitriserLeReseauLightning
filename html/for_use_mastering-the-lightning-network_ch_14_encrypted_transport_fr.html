<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<title>Le transport de messages encrypt√©s de Lightning</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article data-line-1">
<div id="header">
</div>
<div id="content">
<div class="sect1 data-line-2">
<h2 id="encrypted_message_transport">Le transport de messages encrypt√©s de Lightning</h2>
<div class="sectionbody">
<div class="paragraph data-line-4">
<p>Dans ce chapitre, nous examinerons le <em>transport de messages encrypt√©s</em> de Lightning Network,
parfois appel√© <em>Brontide Protocol</em>, qui permet aux pairs
d&#8217;√©tablir une communication encrypt√©e de bout en bout, l&#8217;authentification et la v√©rification
de l&#8217;int√©grit√©.</p>
</div>
<div class="admonitionblock note data-line-10">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-11">
<p>Une partie de ce chapitre comprend des d√©tails hautement techniques sur le protocole d&#8217;encryptage et les algorithmes d&#8217;encryptage utilis√©s dans le transport encrypt√© de Lightning. Vous pouvez d√©cider de sauter cette section si vous n&#8217;√™tes pas int√©ress√© par ces d√©tails.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2 data-line-14">
<h3 id="_le_transport_encrypt√©_dans_de_la_suite_de_protocoles_de_lightning">Le transport encrypt√© dans de la suite de protocoles de Lightning</h3>
<div class="paragraph data-line-16">
<p>Le composant de transport du Lightning Network et ses diff√©rents composants sont illustr√©s dans la partie la plus √† gauche de la couche de connexion r√©seau dans <a href="#LN_protocol_encrypted_transport_highlight">Le transport de messages encrypt√©s dans la suite de protocoles Lightning</a>.</p>
</div>
<div id="LN_protocol_encrypted_transport_highlight" class="imageblock data-line-20">
<div class="content">
<img src="images/mtln_1401.png" alt="Le transport de messages encrypt√©s dans la suite de protocoles Lightning">
</div>
<div class="title">Figure 1. Le transport de messages encrypt√©s dans la suite de protocoles Lightning</div>
</div>
</div>
<div class="sect2 data-line-22">
<h3 id="_introduction">Introduction</h3>
<div class="paragraph data-line-24">
<p>Contrairement au r√©seau P2P de base de Bitcoin, chaque n≈ìud du Lightning Network est
identifi√© par une cl√© publique unique qui lui sert d&#8217;identit√©. Par d√©faut, cette
cl√© publique est utilis√©e pour encrypter de bout en bout <em>toutes</em> les communications au sein du
r√©seau. L&#8217;encryptage par d√©faut au niveau le plus bas du protocole garantit que
tous les messages sont authentifi√©s, sont √† l&#8217;abri des attaques de l&#8217;homme du milieu (MITM) et de l&#8217;espionnage par des tiers, et garantit la confidentialit√© au niveau fondamental du
transport. Dans ce chapitre, nous allons d√©couvrir le protocole de cryptage utilis√© par le
Lightning Network en d√©tail. √Ä la fin de ce chapitre, le lecteur sera
familier avec des protocoles de messagerie encrypt√©s de pointe, ainsi qu&#8217;avec
les diverses propri√©t√©s que de tels protocoles fournissent au r√©seau. Cela vaut la peine
de mentionner que le c≈ìur du transport des messages chiffr√©s est <em>agnostique</em> √†
son utilisation dans le contexte du Lightning Network. En cons√©quence, le
transport de messages chiffr√©s personnalis√© utilis√© par Lightning peut √™tre transpos√© dans n&#8217;importe quel contexte
qui n√©cessite une communication encrypt√©e entre deux parties.</p>
</div>
</div>
<div class="sect2 data-line-38">
<h3 id="_le_graphe_des_canaux_en_tant_quinfrastructure_cl√©s_publiques_d√©centralis√©e">Le graphe des canaux en tant qu&#8217;infrastructure cl√©s publiques d√©centralis√©e</h3>
<div class="paragraph data-line-40">
<p>Comme nous l&#8217;avons appris dans <a href="#routing">[routing]</a>, chaque n≈ìud a une
identit√© √† long terme qui est utilis√©e comme identifiant pour un sommet lors du pathfinding et
√©galement utilis√© dans les op√©rations cryptographiques asym√©triques li√©es √† la cr√©ation de
de paquets de routage chiffr√©s en oignon. Cette cl√© publique, qui sert √† l&#8217;identit√©
du n≈ìud √† long terme, est incluse dans la r√©ponse d&#8217;amor√ßage DNS, ainsi
qu&#8217;int√©gr√©e dans le graphe des canaux. Par cons√©quent, avant qu&#8217;un n≈ìud ne tente de
se connecter √† un autre n≈ìud sur le r√©seau P2P, il conna√Æt d√©j√† la cl√© publique
du n≈ìud auquel il souhaite se connecter.</p>
</div>
<div class="paragraph data-line-49">
<p>De plus, si le n≈ìud auquel vous vous connectez poss√®de d√©j√† une s√©rie de
canaux dans le graphe, le n≈ìud qui se connecte est alors en mesure de v√©rifier davantage l&#8217;identit√© du n≈ìud. Parce que l&#8217;ensemble du graphe des canaux est enti√®rement
authentifi√©, on peut le voir comme une sorte d&#8217;infrastructure √† cl√©s publiques d√©centralis√©e
(PKI) : pour enregistrer une cl√©, un canal public dans la blockchain
Bitcoin doit √™tre ouvert, et une fois qu&#8217;un n≈ìud n&#8217;a plus de canaux publics, alors
ils sont effectivement supprim√©s de la PKI.</p>
</div>
<div class="paragraph data-line-56">
<p>√âtant donn√© que Lightning est un r√©seau d√©centralis√©, il est imp√©ratif qu&#8217;aucune entit√©
centrale ne se voit attribuer le pouvoir de fournir une identit√© par cl√© publique au sein du
r√©seau. A la place d&#8217;une entit√© centrale, le Lightning Network utilise la blockchain
Bitcoin comme m√©canisme d&#8217;att√©nuation de d&#8217;attaque Sybil car obtenir une identit√© sur le
r√©seau a un co√ªt tangible : les frais n√©cessaires pour cr√©er un canal sur la
blockchain, ainsi que le co√ªt d&#8217;opportunit√© du capital allou√© √† leurs
canaux. Tout en d√©ployant une PKI sp√©cifique √† un domaine, le
Lightning Network est en mesure de simplifier consid√©rablement son protocole de transport encrypt√©
car il n&#8217;a pas besoin de traiter toutes les complexit√©s qui se pr√©sentent
avec TLS, le protocole Transport Layer Security.</p>
</div>
</div>
<div class="sect2 data-line-67">
<h3 id="_pourquoi_pas_tls">Pourquoi pas TLS¬†?</h3>
<div class="paragraph data-line-69">
<p>Les lecteurs familiers avec le syst√®me TLS peuvent se demander √† ce stade¬†: pourquoi TLS n&#8217;a-t-il pas √©t√©
utilis√© malgr√© les inconv√©nients du syst√®me PKI existant ? C&#8217;est en effet un
fait que les "certificats auto-sign√©s" peuvent √™tre utilis√©s pour √©viter efficacement le
syst√®me PKI mondial existant en affirmant simplement l&#8217;identit√© d&#8217;une
cl√© publique parmi un ensemble de pairs. Cependant, m√™me avec le syst√®me PKI existant
√† l&#8217;√©cart, TLS pr√©sente plusieurs inconv√©nients qui ont incit√© les cr√©ateurs du Lightning Network
√† opter plut√¥t pour un protocole d&#8217;encryptage personnalis√© plus compact.</p>
</div>
<div class="paragraph data-line-77">
<p>Pour commencer, TLS est un protocole qui existe depuis plusieurs d√©cennies et
en cons√©quence a √©volu√© au fil du temps √† mesure que de nouvelles avanc√©es ont √©t√© r√©alis√©es dans le domaine
de l&#8217;encryptage de transport. Cependant, au fil du temps, cette √©volution a entra√Æn√© le
gonflement en taille et en complexit√© du protocole. Au cours des derni√®res d√©cennies, plusieurs
vuln√©rabilit√©s dans TLS ont √©t√© d√©couvertes et corrig√©es, avec chaque √©volution
apportant plus de complexit√© au protocole. En raison de l&#8217;√¢ge de
du protocole, plusieurs versions et it√©rations existent, ce qui signifie qu&#8217;un client doit
comprendre de nombreuses it√©rations ant√©rieures du protocole pour communiquer
avec une grande partie de l&#8217;Internet public, augmentant encore la complexit√©
de l&#8217;impl√©mentation.</p>
</div>
<div class="paragraph data-line-88">
<p>Dans le pass√©, plusieurs vuln√©rabilit√©s de s√©curit√© li√©es √† la m√©moire ont √©t√© d√©couvertes dans
des impl√©mentations largement utilis√©es de SSL/TLS. Int√©grer un tel protocole dans chaque
n≈ìud Lightning servirait √† augmenter la surface d&#8217;attaque des n≈ìuds expos√©s au r√©seau pair-√†-pair public. Pour augmenter la s√©curit√© du
r√©seau dans son ensemble et minimiser la surface d&#8217;attaque exploitable, les cr√©ateurs du
Lightning Network a plut√¥t choisi d&#8217;adopter le Noise Protocol Framework. Noise comme protocole
internalise plusieurs des le√ßons de s√©curit√© et de confidentialit√© apprises au fil du temps en raison
par l&#8217;examen approfondi continu du protocole TLS durant des d√©cennies. D&#8217;une certaine mani√®re, l&#8217;existence
of Noise permet √† la communaut√© de "recommencer" efficacement, avec un protocole plus compact
et simplifi√© qui conserve tous les atouts de TLS.</p>
</div>
</div>
<div class="sect2 data-line-98">
<h3 id="_le_noise_protocol_framework">Le Noise Protocol Framework</h3>
<div class="paragraph data-line-100">
<p>Le Noise Protocol Framework est un protocole d&#8217;encryptage de messages moderne, extensible et flexible
con√ßu par les cr√©ateurs du Signal Protocol. Le Signal Protocol est l&#8217;un des protocoles de cryptage de message les plus largement utilis√©s
au monde. Il est utilis√© √† la fois par Signal et Whatsapp, qui sont utilis√©s cumulativement par
plus d&#8217;un milliard de personnes dans le monde. Le Noise Framework est le r√©sultat de
de d√©cennies d&#8217;√©volution √† la fois dans le milieu universitaire et dans l&#8217;industrie des protocoles
d&#8217;encryptage de messages. Lightning utilise le Noise Protocol Framework pour impl√©menter
un protocole d&#8217;encryptage <em>orient√© message</em> utilis√© par tous les n≈ìuds pour communiquer
entre eux.</p>
</div>
<div class="paragraph data-line-109">
<p>Une session de communication utilisant Noise comporte deux phases distinctes : la phase de poign√©e de main ("handshake" en anglais)
et la phase de messagerie. Avant que deux parties puissent communiquer l&#8217;une avec l&#8217;autre,
elles doivent d&#8217;abord arriver √† un secret partag√© connu d&#8217;elles seules qui
sera utilis√© pour encrypter et authentifier les messages envoy√©s entre elles. Une variante
de l&#8217;accord de cl√© authentifi√© est utilis√©e pour parvenir √† une cl√© partag√©e finale
entre les deux parties. Dans le contexte du protocole Noise, cet
accord de cl√© authentifi√© est appel√© <em>poign√©e de main</em>. Une fois cette
poign√©e de main termin√©e, les deux n≈ìuds peuvent maintenant s&#8217;envoyer
des messages encrypt√©s. Chaque fois que des pairs doivent se connecter ou se reconnecter l&#8217;un
√† l&#8217;autre, une nouvelle it√©ration du protocole de poign√©e de main est ex√©cut√©e, ce qui permet de garantir
le secret de transmission (la fuite de la cl√© d&#8217;une transcription ant√©rieure ne compromet pas
les transcriptions futures).</p>
</div>
<div class="paragraph data-line-122">
<p>Comme le Noise Protocol permet √† un concepteur de protocole de choisir parmi plusieurs
primitives cryptographiques, telles que l&#8217;encryptage sym√©trique et la cryptographie
√† cl√© publique, il est d&#8217;usage que chaque variante du Noise Protocol soit d√©sign√©e
par un nom unique. Dans l&#8217;esprit de "Noise", chaque variante du protocole
choisit un nom d√©riv√© d&#8217;une sorte de "bruit" ("noise" en anglais). Dans le contexte du
Lightning Network, la variante du protocole de bruit utilis√©e est parfois appel√©e
Brontide. Une <em>brontide</em> est un bruit sourd, semblable √† celui que l&#8217;on peut
entendre lors d&#8217;un orage √† une grande distance.</p>
</div>
</div>
<div class="sect2 data-line-131">
<h3 id="_le_transport_encrypt√©_de_lightning_en_d√©tail">Le transport encrypt√© de Lightning en d√©tail</h3>
<div class="paragraph data-line-133">
<p>Dans cette section, nous d√©composerons le protocole de transport encrypt√© de Lightning et approfondirons les d√©tails des algorithmes et protocole cryptographiques utilis√©s pour √©tablir des communications encrypt√©es, authentifi√©es et √† int√©grit√© garantie entre les pairs. N&#8217;h√©sitez pas √† sauter cette section si vous trouvez ce niveau de d√©tail d√©courageant.</p>
</div>
<div class="sect3 data-line-135">
<h4 id="_noise_xk_la_poign√©e_de_main_noise_du_lightning_network">Noise_XK¬†: La poign√©e de main Noise du Lightning Network</h4>
<div class="paragraph data-line-137">
<p>Le protocole Noise est extr√™mement flexible car il annonce plusieurs
poign√©es de main, chacune ayant des propri√©t√©s diff√©rentes en mati√®re de s√©curit√© et de confidentialit√©,
parmi lesquelles le concepteur √©ventuel de protocole peut faire son choix. Une exploration approfondie de chaque
poign√©e de main et de leurs diff√©rents compromis sort du cadre de ce chapitre.
Cela dit, le Lightning Network utilise une poign√©e de main sp√©cifique appel√©e
<code>Noise_XK</code>. La propri√©t√© unique fournie par cette poign√©e de main est la <em>dissimulation d&#8217;identit√©</em> : pour qu&#8217;un n≈ìud puisse initier une connexion avec un autre n≈ìud, il
doit d&#8217;abord conna√Ætre sa cl√© publique. M√©caniquement, cela signifie que la cl√© publique
du r√©pondant n&#8217;est en fait jamais transmise dans le contexte de la
poign√©e de main. Au lieu de cela, une s√©rie astucieuse de contr√¥les ECDH (Elliptic Curve Diffie-Hellman) et
MAC (Message Authentication Code) est utilis√©e pour authentifier le
r√©pondant.</p>
</div>
</div>
<div class="sect3 data-line-149">
<h4 id="_notation_de_poign√©e_de_main_et_flux_du_protocole">Notation de poign√©e de main et flux du protocole</h4>
<div class="paragraph data-line-151">
<p>Chaque poign√©e de main se d√©roule g√©n√©ralement en plusieurs √©tapes. √Ä chaque √©tape, un
√©l√©ment (√©ventuellement) encrypt√© est envoy√© √† l&#8217;autre partie, une ECDH (ou
plusieurs) est effectu√©e, et le r√©sultat de la poign√©e de main est "m√©lang√©" dans une
<em>transcription</em> de protocole. Cette transcription sert √† authentifier chaque √©tape du
protocole et permet de d√©jouer les attaques de type "homme du milieu". √Ä la
fin de la poign√©e de main, deux cl√©s, <code>ck</code> et <code>k</code>, sont produites et utilis√©es pour
encrypter les messages (<code>k</code>) et effectuer la rotation des cl√©s (<code>ck</code>) tout au long de la dur√©e de vie de
la session.</p>
</div>
<div class="paragraph data-line-160">
<p>Dans le contexte d&#8217;une poign√©e de main, <code>s</code> est g√©n√©ralement une cl√© publique statique √† long terme.
Dans notre cas, le syst√®me de cryptographie √† cl√© publique utilis√© est bas√© sur une courbe elliptique,
instanci√©e avec la courbe <code>secp256k1</code>, qui est utilis√©e ailleurs dans Bitcoin.
Plusieurs cl√©s √©ph√©m√®res sont g√©n√©r√©es tout au long de la poign√©e de main. Nous utilisons <code>e</code> pour
d√©signer une nouvelle cl√© √©ph√©m√®re. Les op√©rations ECDH entre deux cl√©s sont not√©es comme
la concat√©nation de deux cl√©s. Par exemple, <code>ee</code> repr√©sente une op√©ration ECDH
entre deux cl√©s √©ph√©m√®res.</p>
</div>
</div>
<div class="sect3 data-line-168">
<h4 id="_vue_densemble_de_haut_niveau">Vue d&#8217;ensemble de haut niveau</h4>
<div class="paragraph data-line-170">
<p>En utilisant la notation pr√©sent√©e pr√©c√©demment, nous pouvons d√©crire succinctement le <code>Noise_XK</code>
comme <span class="keep-together">suit</span>¬†:</p>
</div>
<div class="listingblock data-line-172">
<div class="content">
<pre class="highlight"><code>    Noise_XK(s, rs):
       &lt;- rs
       ...
       -&gt; e, e(rs)
       &lt;- e, ee
       -&gt; s, se</code></pre>
</div>
</div>
<div class="paragraph data-line-181">
<p>Le protocole commence par la "pr√©-transmission" de la cl√© statique du r√©pondant
(<code>rs</code>) √† l&#8217;initiateur. Avant d&#8217;ex√©cuter la poign√©e de main, l&#8217;initiateur doit
g√©n√©rer sa propre cl√© statique (<code>s</code>). √Ä chaque √©tape de la poign√©e de main, tous
les √©l√©ments envoy√©s sur le fil et les cl√©s envoy√©es/utilis√©es sont incr√©mentalement
hach√©s dans un <em>digest de poign√©e de main</em>, <code>h</code>. Ce digest n&#8217;est jamais envoy√© sur le
fil pendant la poign√©e de main, mais est utilis√© comme "donn√©es associ√©es" lorsque
le AEAD ("Authenticated Encryption with Associated Data" en anglais, traduit litt√©ralement Encryptage Authentifi√© avec Donn√©es Associ√©es) est envoy√© sur le fil.
Les <em>donn√©es associ√©es</em> ("associated data" ou "AD" en anglais) permettent √† un protocole d&#8217;encryptage d&#8217;authentifier des informations suppl√©mentaires
en m√™me temps qu&#8217;un paquet de texte crypt√©. Dans d&#8217;autres domaines, les AD peuvent √™tre
un nom de domaine ou une partie du paquet en texte clair.</p>
</div>
<div class="paragraph data-line-192">
<p>L&#8217;existence de <code>h</code> garantit que si une portion d&#8217;un message de poign√©e de main transmis
est remplac√©e, l&#8217;autre partie le remarquera. √Ä chaque √©tape, un digest MAC
est v√©rifi√©. Si la v√©rification MAC r√©ussit, le destinataire sait
que la poign√©e de main s&#8217;est d√©roul√©e avec succ√®s jusqu&#8217;√† ce point. Dans le cas contraire, si une v√©rification MAC
√©choue, le processus de poign√©e de main a √©chou√© et la connexion
doit √™tre interrompue.</p>
</div>
<div class="paragraph data-line-199">
<p>Le protocole ajoute √©galement une nouvelle donn√©e √† chaque message de poign√©e de main : la version
du protocole. La version initiale du protocole est <code>0</code>. Au moment de la r√©daction de ce document, aucune nouvelle
version de protocole n&#8217;a √©t√© cr√©√©e. Par cons√©quent, si un pair re√ßoit une version
autre que <code>0</code>, il doit rejeter la tentative d&#8217;initiation de la poign√©e de main.</p>
</div>
<div class="paragraph data-line-204">
<p>En ce qui concerne les primitives cryptographiques, SHA-256 est utilis√© comme fonction de hachage de
choix, <code>secp256k1</code> comme courbe elliptique, et <code>ChaChaPoly-130</code> comme construction AEAD
(encryptage sym√©trique).</p>
</div>
<div class="paragraph data-line-208">
<p>Chaque variante du protocole Noise poss√®de une cha√Æne ASCII unique pour s&#8217;y r√©f√©rer. Pour s&#8217;assurer que deux parties utilisent la m√™me variante du
protocole, la cha√Æne ASCII est hach√©e en un digest, qui est utilis√© pour initialiser
l&#8217;√©tat de la poign√©e de main de d√©part. Dans le contexte du Lightning Network, la cha√Æne ASCII
d√©crivant le protocole est <code>Noise_XK_secp256k1_ChaChaPoly_SHA256</code>.</p>
</div>
</div>
<div class="sect3 data-line-213">
<h4 id="_la_poign√©e_de_main_en_trois_actes">La poign√©e de main en trois actes</h4>
<div class="paragraph data-line-215">
<p>La partie "poign√©e de main" peut √™tre s√©par√©e en trois "actes" distincts.
L&#8217;ensemble de la poign√©e de main prend 1,5 aller-retour entre l&#8217;initiateur et le r√©pondant.
√Ä chaque acte, un seul message est envoy√© entre les deux parties. Le message de poign√©e de main
est une charge utile de taille fixe pr√©fix√©e par la version du protocole.</p>
</div>
<div class="paragraph data-line-220">
<p>Le protocole Noise utilise une notation inspir√©e de l&#8217;orientation objet pour d√©crire le
protocole √† chaque √©tape. Lors de l&#8217;√©tablissement de l&#8217;√©tat de la poign√©e de main, chaque partie
initialisera les variables suivantes :</p>
</div>
<div class="dlist data-line-224">
<dl>
<dt class="hdlist1"><code>ck</code></dt>
<dd>
<p>La <em>cl√© de cha√Ænage</em>. Cette valeur est le hachage accumul√© de toutes
les pr√©c√©dentes sorties de l&#8217;ECDH. A la fin de la poign√©e de main, 'ck' est utilis√© pour d√©river
les cl√©s d&#8217;encryptage des messages Lightning.</p>
</dd>
<dt class="hdlist1"><code>h</code></dt>
<dd>
<p>Le <em>hachage de la poign√©e de main</em>. Cette valeur est le hachage accumul√© du <em>toutes</em>
les donn√©es de poign√©e de main qui ont √©t√© envoy√©es et re√ßues jusqu&#8217;√† pr√©sent pendant le processus de
poign√©e de main.</p>
</dd>
<dt class="hdlist1"><code>temp_k1</code>, <code>temp_k2</code>, <code>temp_k3</code></dt>
<dd>
<p>Les <em>cl√©s interm√©diaires</em>. Celles-ci servent √†
encrypter et d√©crypter les charges utiles AEAD de longueur nulle √† la fin de chaque message de
poign√©e de main.</p>
</dd>
<dt class="hdlist1"><code>e</code></dt>
<dd>
<p>La <em>paire de cl√©s √©ph√©m√®re</em> d&#8217;une partie. Pour chaque session, un n≈ìud doit g√©n√©rer une
nouvelle cl√© √©ph√©m√®re cryptographique avec un fort caract√®re al√©atoire</p>
</dd>
<dt class="hdlist1"><code>s</code></dt>
<dd>
<p>La <em>paire de cl√©s statiques</em> d&#8217;une partie (<code>ls</code> pour local, <code>rs</code> pour distant).</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-241">
<p>Compte tenu de cette poign√©e de main et de l&#8217;√©tat de la session de messagerie, nous d√©finirons ensuite une s√©rie de
de fonctions qui op√©reront sur l&#8217;√©tat de la poign√©e de main et de la messagerie. Lors de
la description du protocole de poign√©e de main, nous utiliserons ces variables d&#8217;une mani√®re
similaire au pseudocode pour r√©duire la verbosit√© de l&#8217;explication de
chaque √©tape du protocole. Nous allons d√©finir les primitives <em>fonctionnelles</em> de
la poign√©e de main ainsi :</p>
</div>
<div class="dlist data-line-248">
<dl>
<dt class="hdlist1"><code>ECDH(k, rk)</code></dt>
<dd>
<p>Effectue une op√©ration Elliptic Curve Diffie‚ÄìHellman en utilisant
<code>k</code>, qui est une cl√© priv√©e <code>secp256k1</code> valide, et <code>rk</code>, qui est une cl√© publique valide.</p>
<div class="paragraph data-line-251">
<p>La valeur renvoy√©e est le SHA-256 du format compress√© du
      point g√©n√©r√©.</p>
</div>
</dd>
<dt class="hdlist1"><code>HKDF(salt,ikm)</code></dt>
<dd>
<p>Une fonction d√©finie dans la <code>RFC 5869</code>,
√©valu√© avec un champ "info" de longueur nulle.</p>
<div class="paragraph data-line-257">
<p>Toutes les invocations de <code>HKDF</code> renvoient implicitement 64 octets de
       donn√©es cryptographique al√©atoires en utilisant le composant "extract-and-expand"
        de l&#8217;algorithme <code>HKDF</code>.</p>
</div>
</dd>
<dt class="hdlist1"><code>encryptWithAD(k, n, ad, plaintext)</code></dt>
<dd>
<p>Renvoie <code>encrypt(k, n, ad, plaintext)</code>.</p>
<div class="paragraph data-line-263">
<p>O√π <code>encrypt</code> est une √©valuation de <code>ChaCha20-Poly1305</code> (variante Internet Engineering Task Force)
       avec les arguments pass√©s, avec le nonce <code>n</code> encod√© sur 32 bits √† z√©ro,
       suivi d&#8217;une valeur <em>little-endian</em> de 64 bits. Remarque : cela suit la convention du
       protocole Noice, plut√¥t que notre "endian" usuel.</p>
</div>
</dd>
<dt class="hdlist1"><code>decryptWithAD(k, n, ad, ciphertext)</code></dt>
<dd>
<p>Renvoie <code>decrypt(k, n, ad, ciphertext)</code>.</p>
<div class="paragraph data-line-270">
<p>O√π <code>decrypt</code> est une √©valuation de <code>ChaCha20-Poly1305</code> (variante IETF)
       avec les arguments pass√©s, avec le nonce <code>n</code> encod√© sur 32 bits √† z√©ro,
       suivi d&#8217;une valeur <em>little-endian</em> de 64 bits.</p>
</div>
</dd>
<dt class="hdlist1"><code>generateKey()</code></dt>
<dd>
<p>G√©n√®re et renvoie une nouvelle paire de cl√©s <code>secp256k1</code>.</p>
<div class="paragraph data-line-276">
<p>O√π l&#8217;objet renvoy√© par <code>generateKey</code> a deux attributs¬†: <code>.pub</code>, qui renvoie un objet abstrait repr√©sentant la cl√© publique¬†; et <code>.priv</code>, qui repr√©sente la cl√© priv√©e utilis√©e pour g√©n√©rer la cl√© publique</p>
</div>
<div class="paragraph data-line-278">
<p>O√π l&#8217;objet a √©galement une seule m√©thode¬†: <code>.serializeCompressed()</code></p>
</div>
</dd>
<dt class="hdlist1"><code>a || b</code></dt>
<dd>
<p>Ceci indique la concat√©nation de deux cha√Ænes d&#8217;octets <code>a</code> et <code>b</code>.</p>
</dd>
</dl>
</div>
<div class="sect4 data-line-282">
<h5 id="_initialisation_de_l√©tat_de_session_de_poign√©e_de_main">Initialisation de l&#8217;√©tat de session de poign√©e de main</h5>
<div class="paragraph data-line-284">
<p>Avant de commencer le processus de poign√©e de main, les deux parties doivent initialiser
l&#8217;√©tat de d√©part qu&#8217;ils utiliseront pour faire avancer le processus de poign√©e de main. Pour commencer,
les deux parties doivent construire le r√©sum√© initial de la poign√©e de main <code>h</code>.</p>
</div>
<div class="olist arabic data-line-288">
<ol class="arabic">
<li class="data-line-288">
<p>h = SHA-256(__protocolName__)</p>
<div class="paragraph data-line-290">
<p>O√π __protocolName__ = "Noise_XK_secp256k1_ChaChaPoly_SHA256" encod√© en
      une cha√Æne ASCII.</p>
</div>
</li>
<li class="data-line-293">
<p><code>ck = h</code></p>
</li>
<li class="data-line-295">
<p>h = SHA-256(h || __prologue__)</p>
<div class="paragraph data-line-297">
<p>O√π __prologue__ est la cha√Æne ASCII¬†: <code>lightning</code>.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph data-line-299">
<p>En plus du nom du protocole, nous ajoutons √©galement un "prologue" suppl√©mentaire qui est
utilis√© pour lier davantage le contexte du protocole au Lightning Network.</p>
</div>
<div class="paragraph data-line-302">
<p>Pour conclure l&#8217;√©tape d&#8217;initialisation, les deux parties m√©langent la cl√© publique du r√©pondant
dans le digest de la poign√©e de main. Comme ce digest est utilis√© pendant que les donn√©es associ√©es √† un
un texte chiffr√© de longueur nulle (uniquement le MAC) est envoy√©, cela garantit que l&#8217;initiateur
conna√Æt bien la cl√© publique du r√©pondant.</p>
</div>
<div class="ulist data-line-307">
<ul>
<li class="data-line-307">
<p>Le n≈ìud initiateur m√©lange la cl√© publique statique du n≈ìud r√©pondant
s√©rialis√©e au format compress√© de Bitcoin : <code>h = SHA-256(h || rs.pub.serializeCompressed())</code></p>
</li>
<li class="data-line-310">
<p>Le n≈ìud r√©pondant m√©lange sa cl√© publique statique locale s√©rialis√©e avec
le format compress√© de Bitcoin¬†: <code>h = SHA-256(h || ls.pub.serializeCompressed())</code></p>
</li>
</ul>
</div>
</div>
<div class="sect4 data-line-313">
<h5 id="_les_actes_de_poign√©e_de_main">Les actes de poign√©e de main</h5>
<div class="paragraph data-line-315">
<p>Apr√®s l&#8217;initialisation initiale de la poign√©e de main, nous pouvons commencer l&#8217;ex√©cution proprement dite
du processus de poign√©e de main. La poign√©e de main est compos√©e d&#8217;une s√©rie de
trois messages envoy√©s entre l&#8217;initiateur et le r√©pondant, ci-apr√®s d√©nomm√©s
"actes". Parce que chaque acte est un message unique envoy√© entre les parties, une poign√©e de main
est termin√©e en 1,5 aller-retour au total (0,5 pour chaque acte).</p>
</div>
<div class="paragraph data-line-321">
<p>Le premier acte compl√®te la partie initiale du triple √©change de cl√©s Diffie-Hellman (DH) incr√©mentiel (en utilisant une nouvelle cl√© √©ph√©m√®re g√©n√©r√©e par l&#8217;initiateur)
et garantit √©galement que l&#8217;initiateur conna√Æt r√©ellement la cl√© publique √† long terme du
r√©pondant. Lors du deuxi√®me acte, le r√©pondant transmet la cl√© √©ph√©m√®re
qu&#8217;ils souhaitent utiliser pour la session √† l&#8217;initiateur, et mixe √† nouveau incr√©mentalement
cette nouvelle cl√© dans la poign√©e de main DH triple. Lors du troisi√®me et dernier
agir, l&#8217;initiateur transmet sa cl√© publique statique √† long terme au
r√©pondant et ex√©cute l&#8217;op√©ration DH finale pour la m√©langer au secret
 final partag√© qui en r√©sulte.</p>
</div>
<div class="sect5 data-line-330">
<h6 id="_acte_un">Acte Un</h6>
<div class="listingblock data-line-332">
<div class="content">
<pre class="highlight"><code>    -&gt; e, es</code></pre>
</div>
</div>
<div class="paragraph data-line-336">
<p>L&#8217;Acte Un est envoy√© par l&#8217;initiateur au r√©pondant. Au cours de cet acte, l&#8217;initiateur
tente de r√©pondre √† un d√©fi implicite lanc√© par le r√©pondant. Pour relever ce
d√©fi, l&#8217;initiateur doit conna√Ætre la cl√© publique statique du r√©pondant.</p>
</div>
<div class="paragraph data-line-340">
<p>Le message de poign√©e de main est <em>exactement</em> de 50 octets : 1 octet pour la version de poign√©e de main,
33 octets pour la cl√© publique √©ph√©m√®re compress√©e de l&#8217;initiateur,
et 16 octets pour la balise <code>poly1305</code>.</p>
</div>
<div class="paragraph data-line-344">
<p>Actions de l&#8217;exp√©diteur¬†:</p>
</div>
<div class="olist arabic data-line-346">
<ol class="arabic">
<li class="data-line-346">
<p><code>e = generateKey()</code></p>
</li>
<li class="data-line-347">
<p><code>h = SHA-256(h || e.pub.serializeCompressed())</code></p>
<div class="paragraph data-line-349">
<p>La cl√© √©ph√©m√®re nouvellement g√©n√©r√©e est accumul√©e dans le
       digest de la poign√©e de main.</p>
</div>
</li>
<li class="data-line-351">
<p><code>es = ECDH(e.priv, rs)</code></p>
<div class="paragraph data-line-353">
<p>L&#8217;initiateur effectue une ECDH entre sa cl√© √©ph√©m√®re nouvellement g√©n√©r√©e
       et la cl√© publique statique du n≈ìud distant.</p>
</div>
</li>
<li class="data-line-355">
<p><code>ck, temp_k1 = HKDF(ck, es)</code></p>
<div class="paragraph data-line-357">
<p>Une nouvelle cl√© d&#8217;encryptage temporaire est g√©n√©r√©e, qui est
       utilis√© pour g√©n√©rer le MAC d&#8217;authentification.</p>
</div>
</li>
<li class="data-line-359">
<p><code>c = encryptWithAD(temp_k1, 0, h, zero)</code></p>
<div class="paragraph data-line-361">
<p>O√π <code>zero</code> est un texte brut de longueur nulle.</p>
</div>
</li>
<li class="data-line-362">
<p><code>h = SHA-256(h || c)</code></p>
<div class="paragraph data-line-364">
<p>Enfin, le texte chiffr√© g√©n√©r√© est accumul√© dans l&#8217;authentification
       digest de la poign√©e de main.</p>
</div>
</li>
<li class="data-line-366">
<p>Envoyer <code>m = 0 || e.pub.serializeCompressed() || c</code> au r√©pondant via la m√©moire tampon du r√©seau.</p>
</li>
</ol>
</div>
<div class="paragraph data-line-368">
<p>Actions du destinataire¬†:</p>
</div>
<div class="olist arabic data-line-370">
<ol class="arabic">
<li class="data-line-370">
<p>Lire <em>exactement</em> 50 octets du tampon r√©seau.</p>
</li>
<li class="data-line-371">
<p>Parser le message lu (<code>m</code>) en <code>v</code>, <code>re</code> et <code>c</code>¬†:</p>
<div class="ulist data-line-372">
<ul>
<li class="data-line-372">
<p>O√π <code>v</code> est le <em>premier</em> octet de <code>m</code>, <code>re</code> est les 33 octets suivants
de <code>m</code>, et <code>c</code> est les 16 derniers octets de <code>m</code>.</p>
</li>
<li class="data-line-374">
<p>Les octets bruts de la cl√© publique √©ph√©m√®re de la partie distante (<code>re</code>) doivent √™tre
d√©s√©rialis√© en un point sur la courbe √† l&#8217;aide de coordonn√©es affines telles qu&#8217;encod√©es
par le format compos√© s√©rialis√© de la cl√©.</p>
</li>
</ul>
</div>
</li>
<li class="data-line-377">
<p>Si <code>v</code> est une version de poign√©e de main non reconnue, le r√©pondant doit
annuler la tentative de connexion.</p>
</li>
<li class="data-line-379">
<p><code>h = SHA-256(h || re.serializeCompressed())</code></p>
<div class="paragraph data-line-381">
<p>Le r√©pondant accumule la cl√© √©ph√©m√®re de l&#8217;initiateur dans le digest
      de la poign√©e de main d&#8217;authentification.</p>
</div>
</li>
<li class="data-line-383">
<p><code>es = ECDH(s.priv, re)</code></p>
<div class="paragraph data-line-385">
<p>Le r√©pondant effectue une ECDH entre sa cl√© priv√©e statique et la
      cl√© publique √©ph√©m√®re de l&#8217;initiateur.</p>
</div>
</li>
<li class="data-line-387">
<p><code>ck, temp_k1 = HKDF(ck, es)</code></p>
<div class="paragraph data-line-389">
<p>Une nouvelle cl√© d&#8217;encryptage temporaire est g√©n√©r√©e, qui
      bient√¥t sera utilis√©e pour v√©rifier le MAC d&#8217;authentification.</p>
</div>
</li>
<li class="data-line-391">
<p><code>p = decryptWithAD(temp_k1, 0, h, c)</code></p>
<div class="paragraph data-line-393">
<p>Si la v√©rification MAC de cette op√©ration √©choue, alors l&#8217;initiateur ne connait <em>pas</em>
      la cl√© publique statique du r√©pondant. Si tel est le cas, alors le
      r√©pondant doit mettre fin √† la connexion sans aucun autre message.</p>
</div>
</li>
<li class="data-line-396">
<p><code>h = SHA-256(h || c)</code></p>
<div class="paragraph data-line-398">
<p>Le texte chiffr√© re√ßu est m√©lang√© au digest de la poign√©e de main. Cette √©tape sert
       √† s&#8217;assurer que la charge utile n&#8217;a pas √©t√© modifi√©e par un MITM.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect5 data-line-401">
<h6 id="_acte_deux">Acte Deux</h6>
<div class="listingblock data-line-403">
<div class="content">
<pre class="highlight"><code>   &lt;- e, ee</code></pre>
</div>
</div>
<div class="paragraph data-line-407">
<p>L&#8217;Acte Deux est envoy√© du r√©pondant √† l&#8217;initiateur. L&#8217;Acte Deux n&#8217;aura lieu <em>que</em>
si l&#8217;Acte Un r√©ussit. Le premier acte a √©t√© un succ√®s si le
r√©pondant a pu d√©crypter et v√©rifier correctement le MAC de la balise envoy√©e √†
la fin du premier acte.</p>
</div>
<div class="paragraph data-line-412">
<p>La poign√©e de main fait <em>exactement</em> 50 octets : 1 octet pour la version de poign√©e de main, 33
octets pour la cl√© publique √©ph√©m√®re compress√©e du r√©pondant, et 16 octets
pour la balise "poly1305".</p>
</div>
<div class="paragraph data-line-416">
<p>Actions de l&#8217;exp√©diteur¬†:</p>
</div>
<div class="olist arabic data-line-418">
<ol class="arabic">
<li class="data-line-418">
<p><code>e = generateKey()</code></p>
</li>
<li class="data-line-419">
<p><code>h = SHA-256(h || e.pub.serializeCompressed())</code></p>
<div class="paragraph data-line-421">
<p>La cl√© √©ph√©m√®re nouvellement g√©n√©r√©e est accumul√©e dans le
       digest de la poign√©e de main.</p>
</div>
</li>
<li class="data-line-423">
<p><code>ee = ECDH(e.priv, re)</code></p>
<div class="paragraph data-line-425">
<p>O√π <code>re</code> est la cl√© √©ph√©m√®re de l&#8217;initiateur, qui a √©t√© re√ßue
       durant l&#8217;Acte Un.</p>
</div>
</li>
<li class="data-line-427">
<p><code>ck, temp_k2 = HKDF(ck, ee)</code></p>
<div class="paragraph data-line-429">
<p>Une nouvelle cl√© d&#8217;encryptage temporaire est g√©n√©r√©e, qui est
       utilis√© pour g√©n√©rer le MAC d&#8217;authentification.</p>
</div>
</li>
<li class="data-line-431">
<p><code>c = encryptWithAD(temp_k2, 0, h, zero)</code></p>
<div class="paragraph data-line-433">
<p>O√π <code>zero</code> est un texte brut de longueur nulle.</p>
</div>
</li>
<li class="data-line-434">
<p><code>h = SHA-256(h || c)</code></p>
<div class="paragraph data-line-436">
<p>Enfin, le texte chiffr√© g√©n√©r√© est accumul√© dans l&#8217;authentification
       digest de la poign√©e de main.</p>
</div>
</li>
<li class="data-line-438">
<p>Envoyer <code>m = 0 || e.pub.serializeCompressed() || c</code> √† l&#8217;initiateur sur le tampon r√©seau.</p>
</li>
</ol>
</div>
<div class="paragraph data-line-440">
<p>Actions du destinataire¬†:</p>
</div>
<div class="olist arabic data-line-442">
<ol class="arabic">
<li class="data-line-442">
<p>Lire <em>exactement</em> 50 octets du tampon r√©seau.</p>
</li>
<li class="data-line-443">
<p>Parser le message lu (<code>m</code>) en <code>v</code>, <code>re</code> et <code>c</code>¬†:</p>
<div class="paragraph data-line-445">
<p>O√π <code>v</code> est le <em>premier</em> octet de <code>m</code>, <code>re</code> est les 33 suivant
      de <code>m</code>, et <code>c</code> est les 16 derniers octets de <code>m</code>.</p>
</div>
</li>
<li class="data-line-447">
<p>Si <code>v</code> est une version de poign√©e de main non reconnue, le r√©pondant doit
annuler la tentative de connexion.</p>
</li>
<li class="data-line-449">
<p><code>h = SHA-256(h || re.serializeCompressed())</code></p>
</li>
<li class="data-line-450">
<p><code>ee = ECDH(e.priv, re)</code></p>
<div class="paragraph data-line-452">
<p>O√π <code>re</code> est la cl√© publique √©ph√©m√®re du r√©pondant.</p>
</div>
<div class="paragraph data-line-454">
<p>Les octets bruts de la cl√© publique √©ph√©m√®re de la partie distante (<code>re</code>) doivent √™tre
      d√©s√©rialis√© en un point sur la courbe √† l&#8217;aide de coordonn√©es affines telles qu&#8217;encod√©es
      par le format compos√© s√©rialis√© de la cl√©.</p>
</div>
</li>
<li class="data-line-457">
<p><code>ck, temp_k2 = HKDF(ck, ee)</code></p>
<div class="paragraph data-line-459">
<p>Une nouvelle cl√© d&#8217;encryptage temporaire est g√©n√©r√©e, qui est
       utilis√© pour g√©n√©rer le MAC d&#8217;authentification.</p>
</div>
</li>
<li class="data-line-461">
<p><code>p = decryptWithAD(temp_k2, 0, h, c)</code></p>
<div class="paragraph data-line-463">
<p>Si la v√©rification MAC de cette op√©ration √©choue, l&#8217;initiateur doit
      mettre fin √† la connexion sans autre message.</p>
</div>
</li>
<li class="data-line-465">
<p><code>h = SHA-256(h || c)</code></p>
<div class="paragraph data-line-467">
<p>Le texte chiffr√© re√ßu est m√©lang√© au digest de la poign√©e de main. Cette √©tape sert
       √† s&#8217;assurer que la charge utile n&#8217;a pas √©t√© modifi√©e par un MITM.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect5 data-line-470">
<h6 id="_acte_trois">Acte Trois</h6>
<div class="listingblock data-line-472">
<div class="content">
<pre class="highlight"><code>   -&gt; s, se</code></pre>
</div>
</div>
<div class="paragraph data-line-476">
<p>L&#8217;Acte Trois est la phase finale de l&#8217;accord de cl√© authentifi√© d√©crit dans
cette section. Cet acte est envoy√© de l&#8217;initiateur au r√©pondant en tant
qu&#8217;√©tape de conclusion. L&#8217;Acte Trois est ex√©cut√© <em>si et seulement si</em> l&#8217;Acte Deux a r√©ussi.
Au cours de l&#8217;Acte Trois, l&#8217;initiateur transporte sa cl√© publique statique vers le
r√©pondant crypt√© avec un secret de transmission <em>fort</em>, en utilisant la cl√© secr√®te d√©riv√©e <code>HKDF</code> accumul√©e
√† ce stade de la poign√©e de main.</p>
</div>
<div class="paragraph data-line-483">
<p>La poign√©e de main fait <em>exactement</em> 66 octets : 1 octet pour la version de la poign√©e de main, 33
octets pour la cl√© publique statique chiffr√©e avec l&#8217;encryptage de flux <code>ChaCha20</code>,
16 octets pour la balise de la cl√© publique chiffr√©e g√©n√©r√©e par la construction AEAD,
et 16 octets pour une balise d&#8217;authentification finale.</p>
</div>
<div class="paragraph data-line-488">
<p>Actions de l&#8217;exp√©diteur¬†:</p>
</div>
<div class="olist arabic data-line-490">
<ol class="arabic">
<li class="data-line-490">
<p><code>c = encryptWithAD(temp_k2, 1, h, s.pub.serializeCompressed())</code></p>
<div class="paragraph data-line-492">
<p>O√π <code>s</code> est la cl√© publique statique de l&#8217;initiateur.</p>
</div>
</li>
<li class="data-line-493">
<p><code>h = SHA-256(h || c)</code></p>
</li>
<li class="data-line-494">
<p><code>se = ECDH(s.priv, re)</code></p>
<div class="paragraph data-line-496">
<p>O√π <code>re</code> est la cl√© publique √©ph√©m√®re du r√©pondant.</p>
</div>
</li>
<li class="data-line-497">
<p><code>ck, temp_k3 = HKDF(ck, se)</code></p>
<div class="paragraph data-line-499">
<p>Le secret partag√© interm√©diaire final est m√©lang√© √† la cl√© de cha√Ænage en circulation.</p>
</div>
</li>
<li class="data-line-500">
<p><code>t = encryptWithAD(temp_k3, 0, h, zero)</code></p>
<div class="paragraph data-line-502">
<p>O√π <code>zero</code> est un texte brut de longueur nulle.</p>
</div>
</li>
<li class="data-line-503">
<p><code>sk, rk = HKDF(ck, zero)</code></p>
<div class="paragraph data-line-505">
<p>O√π <code>zero</code> est un texte brut de longueur nulle,
       <code>sk</code> est la cl√© √† utiliser par l&#8217;initiateur pour encrypter les messages pour le
       r√©pondant,
       et <code>rk</code> est la cl√© √† utiliser par l&#8217;initiateur pour d√©crypter les messages envoy√©s par
       le r√©pondant.</p>
</div>
<div class="paragraph data-line-511">
<p>Les cl√©s de cryptage finales, √† utiliser pour envoyer et
       recevoir des messages pendant la dur√©e de la session, sont g√©n√©r√©es.</p>
</div>
</li>
<li class="data-line-513">
<p><code>rn = 0, sn = 0</code></p>
<div class="paragraph data-line-515">
<p>Les nonces d&#8217;envoi et de r√©ception sont initialis√©s √† 0.</p>
</div>
</li>
<li class="data-line-516">
<p>Envoyer <code>m = 0 || c || t</code> sur la m√©moire tampon du r√©seau.</p>
</li>
</ol>
</div>
<div class="paragraph data-line-518">
<p>Actions du destinataire¬†:</p>
</div>
<div class="olist arabic data-line-520">
<ol class="arabic">
<li class="data-line-520">
<p>Lire <em>exactement</em> 66 octets du tampon r√©seau.</p>
</li>
<li class="data-line-521">
<p>Parser le message lu (<code>m</code>) en <code>v</code>, <code>c</code> et <code>t</code>¬†:</p>
<div class="paragraph data-line-523">
<p>O√π <code>v</code> est le <em>premier</em> octet de <code>m</code>, <code>c</code> est les 49 octets suivants
      de <code>m</code>, et <code>t</code> les 16 derniers octets de <code>m</code>.</p>
</div>
</li>
<li class="data-line-525">
<p>Si <code>v</code> est une version de poign√©e de main non reconnue, le r√©pondant doit
annuler la tentative de connexion.</p>
</li>
<li class="data-line-527">
<p><code>rs = decryptWithAD(temp_k2, 1, h, c)</code></p>
<div class="paragraph data-line-529">
<p>√Ä ce stade, le r√©pondant a r√©cup√©r√© la cl√© publique statique de
       l&#8217;initiateur.</p>
</div>
</li>
<li class="data-line-531">
<p><code>h = SHA-256(h || c)</code></p>
</li>
<li class="data-line-532">
<p><code>se = ECDH(e.priv, rs)</code></p>
<div class="paragraph data-line-534">
<p>O√π <code>e</code> est la cl√© √©ph√©m√®re d&#8217;origine du r√©pondant.</p>
</div>
</li>
<li class="data-line-535">
<p><code>ck, temp_k3 = HKDF(ck, se)</code></p>
</li>
<li class="data-line-536">
<p><code>p = decryptWithAD(temp_k3, 0, h, t)</code></p>
<div class="paragraph data-line-538">
<p>Si la v√©rification MAC de cette op√©ration √©choue, le r√©pondant doit
       terminer √† la connexion sans autre message.</p>
</div>
</li>
<li class="data-line-540">
<p><code>rk, sk = HKDF(ck, zero)</code></p>
<div class="paragraph data-line-542">
<p>O√π <code>zero</code> est un texte brut de longueur nulle,
       <code>rk</code> est la cl√© √† utiliser par le r√©pondant pour d√©crypter les messages envoy√©s
       par l&#8217;initiateur,
       et <code>sk</code> est la cl√© √† utiliser par le r√©pondant pour crypter les messages pour
       l&#8217;initiateur.</p>
</div>
<div class="paragraph data-line-548">
<p>Les cl√©s de cryptage finales, √† utiliser pour envoyer et
       recevoir des messages pendant la dur√©e de la session, sont g√©n√©r√©es.</p>
</div>
</li>
<li class="data-line-550">
<p><code>rn = 0, sn = 0</code></p>
<div class="paragraph data-line-552">
<p>Les nonces d&#8217;envoi et de r√©ception sont initialis√©s √† 0.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect4 data-line-554">
<h5 id="_cryptage_des_messages_de_transport">Cryptage des messages de transport</h5>
<div class="paragraph data-line-556">
<p>√Ä la fin de l&#8217;Acte Trois, les deux parties ont d√©riv√© les cl√©s de cryptage, qui
seront utilis√©s pour crypter et d√©crypter les messages pour le reste de la
session.</p>
</div>
<div class="paragraph data-line-560">
<p>Les messages r√©els du protocole Lightning sont encapsul√©s dans les textes chiffr√©s AEAD.
Chaque message est pr√©c√©d√© d&#8217;un autre texte chiffr√© AEAD, qui encode la longueur
totale du message Lightning suivant (sans compter son MAC).</p>
</div>
<div class="paragraph data-line-564">
<p>La taille <em>maximale</em> de <em>n&#8217;importe quel</em> message Lightning ne doit pas d√©passer 65 535 octets. Une
la taille maximale de 65 535 simplifie les tests, facilite la gestion de la m√©moire et
aide √† att√©nuer les attaques d&#8217;√©puisement de la m√©moire.</p>
</div>
<div class="paragraph data-line-568">
<p>Pour rendre l&#8217;analyse du trafic plus difficile, le pr√©fixe de longueur pour tous
les messages Lightning encrypt√©s sont √©galement encrypt√©s. De plus, une balise de 16 octets
<code>Poly-1305</code> est ajout√©e au pr√©fixe de longueur crypt√©e pour garantir que
la longueur du paquet n&#8217;a pas √©t√© modifi√©e en vol et aussi pour √©viter
la cr√©ation d&#8217;un oracle de d√©cryptage.</p>
</div>
<div class="paragraph data-line-574">
<p>La structure des paquets sur le fil ressemble au sch√©ma dans <a href="#noise_encrypted_packet">Structure de paquet encrypt√©</a>.</p>
</div>
<div id="noise_encrypted_packet" class="imageblock data-line-578">
<div class="content">
<img src="images/mtln_1402.png" alt="Structure de paquet encrypt√©">
</div>
<div class="title">Figure 2. Structure de paquet encrypt√©</div>
</div>
<div class="paragraph data-line-580">
<p>La longueur pr√©fix√©e du message est cod√©e sous la forme d&#8217;un entier big-endian de 2 octets, pour une
longueur maximale totale de paquet de <span>2 + 16 + 65 535 + 16 = 65 569</span> octets.</p>
</div>
<div class="sect5 data-line-583">
<h6 id="_encryptage_et_envoi_de_messages">Encryptage et envoi de messages</h6>
<div class="paragraph data-line-585">
<p>Pour encrypter et envoyer un message Lightning (<code>m</code>) vers le flux r√©seau,
√©tant donn√© une cl√© d&#8217;envoi (<code>sk</code>) et un nonce (<code>sn</code>), les √©tapes suivantes sont
effectu√©es¬†:</p>
</div>
<div class="olist arabic pagebreak-before data-line-590">
<ol class="arabic">
<li class="data-line-590">
<p>Soit <code>l = len(m)</code>.</p>
<div class="paragraph data-line-592">
<p>O√π <code>len</code> obtient la longueur en octets du message Lightning.</p>
</div>
</li>
<li class="data-line-593">
<p>S√©rialiser <code>l</code> en 2 octets cod√©s comme un entier big-endian.</p>
</li>
<li class="data-line-594">
<p>Encrypter <code>l</code> (en utilisant <code>ChaChaPoly-1305</code>, <code>sn</code> et <code>sk</code>), pour obtenir <code>lc</code>
(18 octets).</p>
<div class="ulist data-line-596">
<ul>
<li class="data-line-596">
<p>Le nonce <code>sn</code> est encod√© sous la forme d&#8217;un nombre little-endian de 96 bits. Comme le
nonce d√©cod√© fait 64 bits, le nonce de 96 bits est encod√© comme 32 bits
de z√©ros non significatifs suivis d&#8217;une valeur de 64 bits.</p>
</li>
<li class="data-line-599">
<p>Le nonce <code>sn</code> doit √™tre incr√©ment√© apr√®s cette √©tape.</p>
</li>
<li class="data-line-600">
<p>Une tranche d&#8217;octets de longueur nulle doit √™tre transmise comme AD (donn√©es associ√©es).</p>
</li>
</ul>
</div>
</li>
<li class="data-line-601">
<p>Enfin, crypter le message lui-m√™me (<code>m</code>) en utilisant la m√™me proc√©dure utilis√©e pour
encrypter le pr√©fixe de longueur. Que ce texte encrypt√© soit connu <span class="keep-together">comme <code>c</code></span>.</p>
<div class="paragraph data-line-604">
<p>Le nonce <code>sn</code> doit √™tre incr√©ment√© apr√®s cette √©tape.</p>
</div>
</li>
<li class="data-line-605">
<p>Envoyer <code>lc || c</code> sur le tampon r√©seau.</p>
</li>
</ol>
</div>
</div>
<div class="sect5 data-line-607">
<h6 id="_r√©ception_et_d√©cryptage_des_messages">R√©ception et d√©cryptage des messages</h6>
<div class="paragraph data-line-609">
<p>Pour d√©crypter le message <em>suivant</em> dans le flux r√©seau, les √©tapes suivantes
les √©tapes sont r√©alis√©es¬†:</p>
</div>
<div class="olist arabic data-line-612">
<ol class="arabic">
<li class="data-line-612">
<p>Lire <em>exactement</em> 18 octets du tampon r√©seau.</p>
</li>
<li class="data-line-613">
<p>Laisser le pr√©fixe de longueur encrypt√© √™tre connu sous le nom de <code>lc</code>.</p>
</li>
<li class="data-line-614">
<p>D√©crypter <code>lc</code> (en utilisant <code>ChaCha20-Poly1305</code>, <code>rn</code> et <code>rk</code>) pour obtenir la taille de
du paquet encrypt√© <code>l</code>.</p>
<div class="ulist data-line-616">
<ul>
<li class="data-line-616">
<p>Une tranche d&#8217;octets de longueur nulle doit √™tre transmise comme AD (donn√©es associ√©es).</p>
</li>
<li class="data-line-617">
<p>Le nonce <code>rn</code> doit √™tre incr√©ment√© apr√®s cette √©tape.</p>
</li>
</ul>
</div>
</li>
<li class="data-line-618">
<p>Lire <em>exactement</em> <code>l + 16</code> octets du tampon r√©seau et laisser les octets √™tre
connues <span class="keep-together">come <code>c</code></span>.</p>
</li>
<li class="data-line-620">
<p>D√©crypter <code>c</code> (en utilisant <code>ChaCha20-Poly1305</code>, <code>rn</code> et <code>rk</code>) pour obtenir le paquet
<code>p</code> en texte brut.</p>
<div class="paragraph data-line-623">
<p>Le nonce <code>rn</code> doit √™tre incr√©ment√© apr√®s cette √©tape.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect4 data-line-625">
<h5 id="_rotation_de_la_cl√©_de_message_lightning">Rotation de la cl√© de message Lightning</h5>
<div class="paragraph data-line-627">
<p>Changer r√©guli√®rement les cl√©s et oublier les cl√©s pr√©c√©dentes est utile pour emp√™cher le
d√©cryptage des anciens messages, en cas de fuite de cl√© ult√©rieure (c&#8217;est-√†-dire, confidentialit√©
r√©trospective).</p>
</div>
<div class="paragraph data-line-631">
<p>La rotation des cl√©s est effectu√©e pour <em>chaque</em> cl√© (<code>sk</code> et <code>rk</code>) <em>individuellement</em>. Une cl√©
doit subir une rotation apr√®s qu&#8217;une partie encrypte ou d√©crypte 1 000 fois elle (c&#8217;est-√†-dire,
tous les 500 messages). Cela peut √™tre correctement pris en compte en op√©rant une rotation de la cl√©
une fois que le nonce qui lui est d√©di√© d√©passe 1 000.</p>
</div>
<div class="paragraph data-line-636">
<p>La rotation de cl√© pour une cl√© <code>k</code> est effectu√©e selon les √©tapes suivantes¬†:</p>
</div>
<div class="olist arabic data-line-638">
<ol class="arabic">
<li class="data-line-638">
<p>Soit <code>ck</code> la cl√© de cha√Ænage obtenue √† la fin de l&#8217;Acte Trois.</p>
</li>
<li class="data-line-639">
<p><code>ck', k' = HKDF(ck, k)</code></p>
</li>
<li class="data-line-640">
<p>R√©initialiser le nonce pour la cl√© √† <code>n = 0</code>.</p>
</li>
<li class="data-line-641">
<p><code>k = k'</code></p>
</li>
<li class="data-line-642">
<p><code>ck = ck'</code></p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-644">
<h3 id="_conclusion">Conclusion</h3>
<div class="paragraph data-line-646">
<p>L&#8217;encryptage de transport sous-jacent de Lightning est bas√© sur le protocole Noise et offre de solides garanties de s√©curit√© en mati√®re de confidentialit√©, d&#8217;authenticit√© et d&#8217;int√©grit√© pour toutes les communications entre les pairs Lightning.</p>
</div>
<div class="paragraph data-line-648">
<p>Contrairement √† Bitcoin o√π les pairs communiquent souvent "en clair" (sans cryptage), toutes les communications Lightning sont encrypt√©es de pair-√†-pair. En plus du cryptage de transport (pair-√†-pair), sur le Lightning Network, les paiements sont <em>√©galement</em> encrypt√©s en paquets oignon (de saut-en-saut) et les d√©tails de paiement sont envoy√©s hors bande entre l&#8217;exp√©diteur et le destinataire (de bout en bout). La combinaison de tous ces m√©canismes de s√©curit√© est cumulative et fournit une d√©fense en couches contre la d√©sanonymisation, les attaques de l&#8217;homme du milieu et la surveillance du r√©seau.</p>
</div>
<div class="paragraph data-line-650">
<p>Bien s√ªr, aucune s√©curit√© n&#8217;est parfaite et nous verrons dans <a href="#security_and_privacy">[security_and_privacy]</a> que ces propri√©t√©s peuvent √™tre d√©grad√©es et attaqu√©es. Cependant, le Lightning Network am√©liore consid√©rablement la confidentialit√© de Bitcoin.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2023-04-28 02:38:32 -0400
</div>
</div>
</body>
</html>