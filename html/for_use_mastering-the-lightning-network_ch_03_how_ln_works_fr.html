<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<title>Comment fonctionne le Lightning Network</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article data-line-1">
<div id="header">
</div>
<div id="content">
<div class="sect1 data-line-2">
<h2 id="ch03_How_Lightning_Works">Comment fonctionne le Lightning Network</h2>
<div class="sectionbody">
<div class="paragraph data-line-4">
<p>Maintenant que nous avons suivi Alice alors qu&#8217;elle installait un porte-monnaie Lightning et achetait un café de Bob, nous allons regarder sous le capot et détailler les différents composants du Lightning Network impliqués dans ce processus.
Ce chapitre donnera une vue d&#8217;ensemble de haut niveau et n&#8217;abordera pas tous les détails techniques.
Le but est plutôt de vous aider à prendre conscience des concepts et briques de base les plus importants du Lightning Network.</p>
</div>
<div class="paragraph data-line-8">
<p>Si vous avez de l&#8217;expérience en informatique, en cryptographie, dans Bitcoin et en développement de protocoles, ce chapitre devrait vous suffire pour être en mesure de connecter les points par vous-même.
Si vous êtes moins expérimenté, ce chapitre vous donnera une vue d&#8217;ensemble suffisante pour que vous compreniez plus facilement les spécifications formelles du protocole, connues sous le nom de BOLT (Basis of Lightning Technology).
Si vous êtes débutant, ce chapitre vous aidera à mieux comprendre les chapitres techniques du livre.</p>
</div>
<div class="paragraph data-line-12">
<p>Si vous avez besoin d&#8217;un rappel sur les principes fondamentaux de Bitcoin, vous pouvez trouver un résumé des sujets suivants dans <a href="#bitcoin_fundamentals_review">[bitcoin_fundamentals_review]</a> :</p>
</div>
<div class="ulist data-line-14">
<ul>
<li class="data-line-14">
<p>Clés et adresses</p>
</li>
<li class="data-line-15">
<p>Fonctions de hachage</p>
</li>
<li class="data-line-16">
<p>Signatures numériques</p>
</li>
<li class="data-line-17">
<p>Structure des transactions</p>
</li>
<li class="data-line-18">
<p>Entrées et sorties de transactions</p>
</li>
<li class="data-line-19">
<p>Chaînage des transactions</p>
</li>
<li class="data-line-20">
<p>Bitcoin Script</p>
</li>
<li class="data-line-21">
<p>Adresses et scripts multisignatures</p>
</li>
<li class="data-line-22">
<p>Timelocks</p>
</li>
<li class="data-line-23">
<p>Scripts complexes</p>
</li>
</ul>
</div>
<div class="paragraph data-line-25">
<p>Nous commencerons par une définition en une phrase de ce qu&#8217;est le Lightning Network et nous le détaillerons dans le reste de ce chapitre.</p>
</div>
<div class="paragraph data-line-27">
<p>Le Lightning Network est un réseau pair-à-pair de <em>canaux de paiement</em> mis en œuvre sous forme de contrats intelligents sur la <em>blockchain Bitcoin</em> ainsi qu&#8217;un protocole de communication qui définit la manière dont les participants configurent et exécutent ces contrats intelligents.</p>
</div>
<div class="sect2 data-line-30">
<h3 id="what_is_payment_channel">Qu&#8217;est-ce qu&#8217;un canal de paiement ?</h3>
<div class="paragraph data-line-32">
<p>Il existe plusieurs façons de décrire un canal de paiement, selon le contexte. Commençons à un niveau élevé, puis ajoutons quelques détails supplémentaires.</p>
</div>
<div class="paragraph data-line-34">
<p>Un canal de paiement est une <em>relation financière</em> entre deux nœuds du Lightning Network, appelés <em>partenaires de canal</em>. La relation financière alloue un <em>solde de fonds</em> (libellé en millisatoshis), entre les deux partenaires de canal.</p>
</div>
<div class="paragraph data-line-36">
<p>Le canal de paiement est géré par un <em>protocole cryptographique</em>, c&#8217;est-à-dire qu&#8217;un processus prédéfini basé sur la cryptographie est utilisé par les partenaires de canal pour redistribuer le solde du canal en faveur de l&#8217;un ou l&#8217;autre des partenaires du canal. Le protocole cryptographique garantit qu&#8217;un partenaire de canal ne peut pas tromper l&#8217;autre, de sorte que les partenaires n&#8217;ont pas besoin de se faire confiance.</p>
</div>
<div class="paragraph data-line-38">
<p>Le protocole cryptographique est établi par le financement d&#8217;une <em>adresse multisignatures</em> 2-de-2 qui oblige les deux partenaires de canal à coopérer et empêche l&#8217;un ou l&#8217;autre des partenaires de canal de dépenser les fonds unilatéralement.</p>
</div>
<div class="paragraph data-line-40">
<p>Pour résumer : un canal de paiement est une relation financière entre des nœuds, allouant des fonds à partir d&#8217;une adresse multisignatures via un protocole cryptographique strictement défini.</p>
</div>
</div>
<div class="sect2 data-line-42">
<h3 id="_principes_de_base_du_canal_de_paiement">Principes de base du canal de paiement</h3>
<div class="paragraph data-line-44">
<p>Le canal de paiement sous-jacent est simplement une adresse multisignature 2-de-2 sur la blockchain Bitcoin, pour laquelle vous détenez une clé et votre partenaire de canal détient l&#8217;autre clé.</p>
</div>
<div class="paragraph data-line-46">
<p>Vous et votre partenaire de canal négociez une séquence de transactions qui dépensent à partir de cette adresse multisignature. Au lieu de transmettre et d&#8217;enregistrer ces transactions sur la blockchain Bitcoin, vous les conservez tous les deux, non dépensées.</p>
</div>
<div class="paragraph data-line-48">
<p>La dernière transaction de cette séquence encode le solde du canal et définit comment ce solde est divisé entre vous et votre partenaire de canal.</p>
</div>
<div class="paragraph data-line-50">
<p>Ainsi, ajouter une nouvelle transaction à cette séquence équivaut à déplacer une partie du solde du canal d&#8217;un partenaire de canal à l&#8217;autre, sans que le réseau Bitcoin en soit conscient. Au fur et à mesure que vous négociez chaque nouvelle transaction, en modifiant l&#8217;allocation des fonds dans le canal, vous révoquez également la transaction précédente, de sorte qu&#8217;aucune des parties ne puisse régresser vers un état antérieur.</p>
</div>
<div class="paragraph data-line-52">
<p>Chaque transaction de la séquence utilise le langage de script de Bitcoin, et donc la négociation des fonds entre vous et votre partenaire de canal est gérée par un contrat intelligent Bitcoin.
Le contrat intelligent est configuré pour pénaliser un membre du canal s&#8217;il tente de soumettre un état du canal précédemment révoqué.</p>
</div>
<div class="admonitionblock note data-line-56">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-57">
<p>Si vous avez une transaction non publiée à partir d&#8217;une adresse multisignature 2-de-2 qui vous paie une partie du solde, une signature de l&#8217;autre partie garantit que vous pouvez publier indépendamment cette transaction à tout moment en ajoutant votre propre signature.</p>
</div>
<div class="paragraph data-line-59">
<p>La capacité de détenir une transaction partiellement signée, hors ligne et non publiée, avec la possibilité de la publier et de posséder ce solde à tout moment, est la base du Lightning Network.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2 data-line-62">
<h3 id="_acheminement_de_paiements_au_travers_des_canaux">Acheminement de paiements au travers des canaux</h3>
<div class="paragraph data-line-64">
<p>Une fois que plusieurs participants ont des canaux d&#8217;une partie à l&#8217;autre, les paiements peuvent également être "transféré" d&#8217;un canal de paiement à l&#8217;autre en établissant un <em>chemin</em> à travers le réseau reliant plusieurs canaux de paiement ensemble.</p>
</div>
<div class="paragraph data-line-66">
<p>Par exemple, Alice peut envoyer de l&#8217;argent à Charlie si Alice a un canal avec Bob et Bob a un canal avec Charlie.</p>
</div>
<div class="paragraph data-line-68">
<p>En raison du design du Lightning Network, il est possible d&#8217;étendre les contrats intelligents qui gèrent le canal de sorte que Bob n&#8217;ait aucun moyen de voler les fonds qui sont acheminés par son canal.</p>
</div>
<div class="paragraph data-line-70">
<p>De la même manière que le contrat intelligent protège les partenaires de canal afin qu&#8217;ils n&#8217;aient pas besoin de se faire confiance, l&#8217;ensemble du réseau protège les participants afin qu&#8217;ils puissent transférer des paiements sans faire confiance à aucun des autres participants.</p>
</div>
<div class="paragraph data-line-72">
<p>Étant donné que les canaux sont construits à partir d&#8217;adresses multisignatures et que les transactions de mise à jour de solde sont des transactions Bitcoin pré-signées, toute la confiance nécessaire pour faire fonctionner le Lightning Network provient de la confiance dans le réseau Bitcoin décentralisé !</p>
</div>
<div class="paragraph data-line-74">
<p>Les innovations précitées sont certainement les avancées majeures qui ont permis la création du Lightning Network.
Cependant, le Lightning Network est bien plus que des protocoles cryptographiques au-dessus du langage Bitcoin Script.
Il s&#8217;agit d&#8217;un protocole de communication complet qui permet aux pairs d&#8217;échanger des messages Lightning pour réaliser le transfert de bitcoins.
Le protocole de communication définit la manière dont les messages Lightning sont chiffrés et échangés.</p>
</div>
<div class="paragraph data-line-79">
<p>Le Lightning Network utilise également un protocole de bavardage pour diffuser des informations publiques sur les canaux (topologie du réseau) à tous les participants.</p>
</div>
<div class="paragraph data-line-81">
<p>Alice, par exemple, a besoin des informations de topologie du réseau pour connaître le canal entre Bob et Charlie, afin qu&#8217;elle puisse construire une route vers Charlie.</p>
</div>
<div class="paragraph data-line-83">
<p>Enfin et surtout, il est important de comprendre que le Lightning Network n&#8217;est rien de plus qu&#8217;une application au-dessus de Bitcoin, utilisant des transactions Bitcoin et Bitcoin Script. Il n&#8217;y a pas de « Lightning coin » ou de « blockchain Lightning ».
Au-delà de toutes les primitives techniques, le protocole LN est un moyen créatif d&#8217;obtenir plus d&#8217;avantages de Bitcoin en permettant un montant arbitraire de paiements instantanés avec des règlements instantanés sans avoir à faire confiance à quelqu&#8217;un d&#8217;autre que le réseau Bitcoin.</p>
</div>
</div>
<div class="sect2 data-line-86">
<h3 id="_canaux_de_paiement">Canaux de paiement</h3>
<div class="paragraph data-line-88">
<p>Comme nous l&#8217;avons vu dans le chapitre précédent, Alice a utilisé son logiciel de porte-monnaie pour créer un canal de paiement entre elle et un autre participant LN.</p>
</div>
<div class="paragraph data-line-90">
<p>Un canal n&#8217;est limité que par trois choses :</p>
</div>
<div class="ulist data-line-92">
<ul>
<li class="data-line-92">
<p>Premièrement, le temps qu&#8217;il faut à Internet pour transférer les quelques centaines d&#8217;octets de données nécessaires au protocole pour déplacer des fonds d&#8217;un bout à l&#8217;autre du canal</p>
</li>
<li class="data-line-94">
<p>Deuxièmement, la capacité du canal, c&#8217;est-à-dire la quantité de bitcoins qui est engagée sur le canal lors de son ouverture</p>
</li>
<li class="data-line-96">
<p>Troisièmement, la limite de taille maximale d&#8217;une transaction Bitcoin restreint également le nombre de paiements incomplets (en cours) acheminés pouvant être transportés simultanément sur un canal</p>
</li>
</ul>
</div>
<div class="paragraph data-line-98">
<p>Les canaux de paiement ont quelques propriétés très intéressantes et utiles :</p>
</div>
<div class="ulist data-line-100">
<ul>
<li class="data-line-100">
<p>Étant donné que le temps de mise à jour d&#8217;un canal est principalement lié à la vitesse de communication d&#8217;Internet, effectuer un paiement sur un canal de paiement peut être presque instantané.</p>
</li>
<li class="data-line-102">
<p>Si le canal est ouvert, effectuer un paiement ne nécessite pas la confirmation des blocs Bitcoin. En fait, tant que vous et votre partenaire de canal suivez le protocole, cela ne nécessite aucune interaction avec le réseau Bitcoin ou qui que ce soit d&#8217;autre que votre partenaire de canal.</p>
</li>
</ul>
</div>
<div class="ulist pagebreak-before data-line-105">
<ul>
<li class="data-line-105">
<p>Le protocole cryptographique est construit de telle sorte qu&#8217;il n&#8217;y a que peu ou pas de confiance nécessaire entre vous et votre partenaire de canal. Si votre partenaire ne répond plus ou essaie de vous tromper, vous pouvez demander au système Bitcoin d&#8217;agir en tant que "tribunal", en résolvant le contrat intelligent que vous et votre partenaire avez précédemment convenu.</p>
</li>
<li class="data-line-107">
<p>Les paiements effectués dans un canal de paiement ne sont connus que de vous et de votre partenaire. En ce sens, vous gagnez en confidentialité par rapport au Bitcoin, où chaque transaction est publique. Seul le solde final, qui est l&#8217;agrégat de tous les paiements de ce canal, deviendra visible sur la blockchain Bitcoin.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-109">
<p>Bitcoin avait environ cinq ans lorsque des développeurs talentueux ont découvert pour la première fois comment des canaux de paiement bidirectionnels, à durée de vie indéfinie et routables pouvaient être construits, et il existe maintenant au moins trois méthodes connues différentes.</p>
</div>
<div class="paragraph data-line-111">
<p>Ce chapitre se concentrera sur la méthode de construction de canaux décrite pour la première fois dans le <a href="https://lightning.network/lightning-network-paper.pdf" data-href="https://lightning.network/lightning-network-paper.pdf">livre blanc du Lightning Network</a> par Joseph Poon et Thaddeus Dryja en 2015. Ceux-ci sont connus sous le nom de canaux <em>Poon-Dryja</em>, et sont la méthode de construction de canal actuellement utilisée sur le Lightning Network.
Les deux autres méthodes proposées sont les canaux <em>Duplex Micropayment</em>, introduits par Christian Decker à peu près au même moment que les canaux Poon-Dryja et les canaux <em>eltoo</em>, introduits dans <a href="https://blockstream.com/eltoo.pdf" data-href="https://blockstream.com/eltoo.pdf">"eltoo : A Simple Layer2 Protocol for Bitcoin"</a> par Christian Decker, Rusty Russel et (co-auteur de ce livre) Olaoluwa Osuntokun en 2018.</p>
</div>
<div class="paragraph data-line-114">
<p>Les canaux eltoo ont des propriétés intéressantes et simplifient la mise en place des canaux de paiement. Cependant, les canaux eltoo nécessitent un changement du langage Bitcoin Script et ne peuvent donc pas être implémentés sur le réseau principal Bitcoin en 2020.</p>
</div>
<div class="sect3 data-line-116">
<h4 id="_adresse_multisignature">Adresse multisignature</h4>
<div class="paragraph data-line-118">
<p>Les canaux de paiement sont construits sur des adresses multisignatures 2-de-2.</p>
</div>
<div class="paragraph data-line-120">
<p>En résumé, une adresse multisignature est l&#8217;endroit où les bitcoins sont verrouillés, de sorte qu&#8217;ils nécessitent plusieurs signatures pour être déverrouillés et dépensés. Dans une adresse multisignature 2-de-2, telle qu&#8217;utilisée sur le Lightning Network, il y a deux signataires participants et <em>les deux</em> doivent signer pour dépenser les fonds.</p>
</div>
<div class="paragraph data-line-122">
<p>Les scripts et adresses multisignatures sont expliqués plus en détail dans <a href="#multisig">[multisig]</a>.</p>
</div>
</div>
<div class="sect3 pagebreak-before less_space data-line-125">
<h4 id="_transaction_de_financement">Transaction de financement</h4>
<div class="paragraph data-line-127">
<p>La pierre angulaire d&#8217;un canal de paiement est une adresse multisignature 2-de-2. L&#8217;un des deux partenaires de canal financera le canal de paiement en envoyant des bitcoins à l&#8217;adresse multisignature. Cette transaction s&#8217;appelle la <em>transaction de financement</em> et est enregistrée sur la blockchain Bitcoin.<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></p>
</div>
<div class="paragraph data-line-129">
<p>Même si la transaction de financement est publique, il n&#8217;est pas évident qu&#8217;il s&#8217;agisse d&#8217;un canal de paiement Lightning tant qu&#8217;il n&#8217;est pas fermé, à moins que le canal ne soit annoncé publiquement. Les canaux sont généralement annoncés publiquement par les nœuds de routage qui souhaitent transmettre des paiements. Toutefois, il existe également des canaux non annoncés, généralement créés par des nœuds mobiles qui ne participent pas activement au routage. De plus, les canaux de paiement ne sont toujours pas visibles par des tiers en dehors des partenaires de canal, pas plus que la répartition de leur solde.</p>
</div>
<div class="paragraph data-line-131">
<p>Le montant déposé dans l&#8217;adresse multisignature est appelé <em>capacité du canal</em> et définit le montant maximum pouvant être envoyé via le canal de paiement. Cependant, étant donné que les fonds peuvent être envoyés dans les deux sens, la capacité du canal n&#8217;est pas la limite supérieure de la quantité de valeur pouvant circuler à travers le canal. En effet, si la capacité du canal est épuisée avec des paiements dans une direction, elle peut être utilisée pour envoyer à nouveau des paiements dans la direction opposée.</p>
</div>
<div class="admonitionblock note data-line-135">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-136">
<p>Les fonds envoyés à l&#8217;adresse multisignature dans la transaction de financement sont parfois appelés "verrouillés dans un canal Lightning". Cependant, dans la pratique, les fonds d&#8217;un canal Lightning ne sont pas "verrouillés" mais plutôt "libérés". Les fonds de canal Lightning sont plus liquides que les fonds sur la blockchain Bitcoin, car ils peuvent être dépensés plus rapidement, à plus bas coût et de manière plus privée. Le transfert de fonds vers le Lightning Network présente certains inconvénients (comme la nécessité de les conserver dans un porte-monnaie "chaud"), mais l&#8217;idée de "verrouiller des fonds" dans Lightning est trompeuse.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4 data-line-139">
<h5 id="_exemple_dune_mauvaise_procédure_douverture_de_canal">Exemple d&#8217;une mauvaise procédure d&#8217;ouverture de canal</h5>
<div class="paragraph data-line-141">
<p>Si vous réfléchissez bien aux adresses multisignatures 2-de-2, vous vous rendrez compte que placer vos fonds dans une telle adresse semble comporter certains risques. Que se passe-t-il si votre partenaire de canal refuse de signer une transaction pour débloquer les fonds ? Sont-ils bloqués pour toujours ? Regardons maintenant ce scénario et comment le protocole LN l&#8217;évite.</p>
</div>
<div class="paragraph data-line-143">
<p>Alice et Bob veulent créer un canal de paiement. Ils créent chacun une paire de clés privée/publique, puis échangent des clés publiques. Désormais, ils peuvent construire une multisignature 2-de-2 avec les deux clés publiques, constituant la base de leur canal de paiement.</p>
</div>
<div class="paragraph data-line-145">
<p>Ensuite, Alice construit une transaction Bitcoin en envoyant quelques mBTC à l&#8217;adresse multisignature créée à partir des clés publiques d&#8217;Alice et de Bob. Si Alice ne prend aucune mesure supplémentaire et diffuse simplement cette transaction, elle doit être sûre que Bob fournira sa signature à dépenser à partir de l&#8217;adresse multisignature. Bob, d&#8217;autre part, a la possibilité de faire chanter Alice en retenant sa signature et en refusant à Alice l&#8217;accès à ses fonds.</p>
</div>
<div class="paragraph data-line-147">
<p>Pour éviter cela, Alice devra créer une transaction supplémentaire qui passe à partir de l&#8217;adresse multisignature, remboursant ses mBTC. Alice demande ensuite à Bob de signer la transaction de remboursement <em>avant</em> de diffuser sa transaction de financement sur le réseau Bitcoin. De cette façon, Alice peut obtenir un remboursement même si Bob disparaît ou ne coopère pas.</p>
</div>
<div class="paragraph data-line-149">
<p>La transaction de "remboursement" qui protège Alice est la première d&#8217;une classe de transactions appelées <em>transactions d&#8217;engagement</em>, que nous examinerons plus en détail ensuite.</p>
</div>
</div>
</div>
<div class="sect3 data-line-151">
<h4 id="_transaction_dengagement">Transaction d&#8217;engagement</h4>
<div class="paragraph data-line-153">
<p>Une <em>transaction d&#8217;engagement</em> est une transaction qui paie à chaque partenaire de canal le solde de son canal et garantit que les partenaires de canal n&#8217;ont pas à faire confiance l&#8217;un l&#8217;autre. En signant une transaction d&#8217;engagement, chaque partenaire de canal "s&#8217;engage" sur le solde actuel et donne à l&#8217;autre partenaire de canal la possibilité de récupérer ses fonds quand il le souhaite.</p>
</div>
<div class="paragraph data-line-155">
<p>En détenant une transaction d&#8217;engagement signée, chaque partenaire de canal peut obtenir ses fonds même sans la coopération de l&#8217;autre partenaire de canal. Cela les protège contre la disparition, le refus de coopérer ou la tentative de tricherie de l&#8217;autre partenaire de canal en violant le protocole du canal de paiement.</p>
</div>
<div class="paragraph data-line-157">
<p>La transaction d&#8217;engagement qu&#8217;Alice a préparée dans l&#8217;exemple précédent était un remboursement de son paiement initial à l&#8217;adresse multisignature. Plus généralement, cependant, une transaction d&#8217;engagement divise les fonds du canal de paiement, payant les deux partenaires du canal en fonction de la part (solde) qu&#8217;ils détiennent chacun. Au début, Alice détient tout le solde, il s&#8217;agit donc d&#8217;un simple remboursement. Mais au fur et à mesure que les fonds circulent d&#8217;Alice à Bob, ils échangeront des signatures pour de nouvelles transactions d&#8217;engagement qui représentent la nouvelle répartition du solde, une partie des fonds étant versée à Alice et une autre à Bob.</p>
</div>
<div class="paragraph data-line-159">
<p>Supposons qu&#8217;Alice ouvre un canal d&#8217;une capacité de 100 000 satoshis avec Bob.
Initialement, Alice possède 100 000 satoshis, l&#8217;intégralité des fonds du canal. Voici comment fonctionne le protocole du canal de paiement :</p>
</div>
<div class="olist arabic data-line-162">
<ol class="arabic">
<li class="data-line-162">
<p>Alice crée une nouvelle paire de clés privée/publique et informe Bob qu&#8217;elle souhaite ouvrir un canal via le message <code>open_channel</code> (un message du protocole LN).</p>
</li>
<li class="data-line-163">
<p>Bob crée également une nouvelle paire de clés privée/publique et s&#8217;engage à accepter un canal d&#8217;Alice, en envoyant sa clé publique à Alice via le message <code>accept_channel</code>.</p>
</li>
<li class="data-line-164">
<p>Alice crée maintenant une transaction de financement depuis son porte-monnaie qui envoie 100k satoshis à l&#8217;adresse multisignature avec un script de verrouillage : 2 &lt;PubKey Alice&gt; &lt;PubKey Bob&gt; 2 CHECKMULTISIG.</p>
</li>
<li class="data-line-165">
<p>Alice ne diffuse pas encore cette transaction de financement mais envoie à Bob l&#8217;ID de la transaction dans un message <code>funding_created</code> avec sa signature pour la transaction d&#8217;engagement de Bob.</p>
</li>
<li class="data-line-166">
<p>Alice et Bob créent tous deux leur version d&#8217;une transaction d&#8217;engagement. Cette transaction sera dépensée à partir de la transaction de financement et renverra tous les bitcoins à une adresse contrôlée par Alice.</p>
</li>
<li class="data-line-167">
<p>Alice et Bob n&#8217;ont pas besoin d&#8217;échanger ces transactions d&#8217;engagement, puisqu&#8217;ils savent chacun comment ils sont construits et peuvent construire les deux indépendamment (car ils se sont mis d&#8217;accord sur un ordre canonique des entrées et des sorties). Ils n&#8217;ont qu&#8217;à échanger des signatures.</p>
</li>
<li class="data-line-168">
<p>Bob fournit une signature pour la transaction d&#8217;engagement d&#8217;Alice et la renvoie à Alice via le message <code>funding_signed</code>.</p>
</li>
<li class="data-line-169">
<p>Maintenant que les signatures ont été échangées, Alice diffusera la transaction de financement sur le réseau Bitcoin.</p>
</li>
</ol>
</div>
<div class="paragraph data-line-171">
<p>En suivant ce protocole, Alice ne renonce pas à la propriété de ses 100 000 satoshis même si les fonds sont envoyés à une adresse multisignature 2-de-2 pour laquelle Alice ne contrôle qu&#8217;une seule clé.
Si Bob cesse de répondre à Alice, elle pourra diffuser sa transaction d&#8217;engagement et récupérer ses fonds.
Ses seuls frais sont les frais pour les transactions sur la chaîne.
Tant qu&#8217;elle suit le protocole, c&#8217;est son seul risque lors de l&#8217;ouverture d&#8217;un canal.</p>
</div>
<div class="paragraph data-line-176">
<p>Après cet échange initial, des transactions d&#8217;engagement sont créées à chaque fois que le solde du canal change. En d&#8217;autres termes, chaque fois qu&#8217;un paiement est envoyé entre Alice et Bob, de nouvelles transactions d&#8217;engagement sont créées et des signatures sont échangées. Chaque nouvelle transaction d&#8217;engagement encode le dernier solde entre Alice et Bob.</p>
</div>
<div class="paragraph data-line-178">
<p>Si Alice veut envoyer 30 000 satoshis à Bob, les deux créeraient une nouvelle version de leurs transactions d&#8217;engagement, qui paieraient désormais 70 000 satoshis à Alice et 30 000 satoshis à Bob. En codant un nouveau solde pour Alice et Bob, les nouvelles transactions d&#8217;engagement sont le moyen par lequel un paiement est "envoyé" à travers le canal.</p>
</div>
<div class="paragraph data-line-180">
<p>Maintenant que nous comprenons les transactions d&#8217;engagement, examinons certains des détails les plus subtils. Vous remarquerez peut-être que ce protocole permet à Alice ou à Bob de tricher.</p>
</div>
</div>
<div class="sect3 data-line-182">
<h4 id="_tricher_avec_un_état_antérieur">Tricher avec un état antérieur</h4>
<div class="paragraph data-line-184">
<p>Combien de transactions d&#8217;engagement Alice détient-elle après avoir payé 30 000 satoshis à Bob ? Elle en détient deux : l&#8217;original lui payant 100 000 satoshis et le plus récent, lui payant 70 000 satoshis et Bob 30 000 satoshis.</p>
</div>
<div class="paragraph data-line-186">
<p>Dans le protocole de canal que nous avons vu jusqu&#8217;à présent, rien n&#8217;empêche Alice de publier une transaction d&#8217;engagement précédente. Une Alice malhonnête pourrait publier la transaction d&#8217;engagement qui lui accorde 100 000 satoshis.
Puisque cette transaction d&#8217;engagement a été signée par Bob, il ne peut pas empêcher Alice de la transmettre.</p>
</div>
<div class="paragraph data-line-189">
<p>Un mécanisme est nécessaire pour empêcher Alice de publier une ancienne transaction d&#8217;engagement. Découvrons maintenant comment cela peut être réalisé et comment cela permet au Lightning Network de fonctionner sans nécessiter aucune confiance entre Alice et Bob.</p>
</div>
<div class="paragraph data-line-191">
<p>Parce que Bitcoin est résistant à la censure, personne ne peut empêcher quelqu&#8217;un de publier une ancienne transaction d&#8217;engagement. Pour éviter cette forme de tricherie, les transactions d&#8217;engagement sont construites de sorte que si une ancienne est transmise, le tricheur peut être puni. En rendant la pénalité suffisamment importante, nous créons une forte incitation contre la triche, ce qui sécurise le système.</p>
</div>
<div class="paragraph data-line-193">
<p>La façon dont la pénalité fonctionne est de donner à la partie trompée la possibilité de réclamer le solde du tricheur. Donc, si quelqu&#8217;un tente de tricher en diffusant une ancienne transaction d&#8217;engagement, dans laquelle il est payé un solde supérieur à ce qui lui est dû, l&#8217;autre partie peut le punir en prenant <em>simultanément</em> son propre solde et le solde du tricheur. Le tricheur perd tout.</p>
</div>
<div class="admonitionblock tip data-line-196">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-197">
<p>Vous remarquerez peut-être que si Alice vide presque complètement le solde de son canal, elle pourrait alors essayer de tricher avec peu de risques. La pénalité de Bob ne serait pas si douloureuse si le solde de son canal est bas. Pour éviter cela, le protocole Lightning exige que chaque partenaire de canal conserve un solde minimum dans le canal (appelé la <em>réserve</em>) afin qu&#8217;ils aient toujours un enjeu personnel.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-200">
<p>Reprenons le scénario de construction du canal, en ajoutant un mécanisme de pénalité pour se protéger contre la triche :</p>
</div>
<div class="olist arabic data-line-202">
<ol class="arabic">
<li class="data-line-202">
<p>Alice crée un canal avec Bob et y met 100k satoshis.</p>
</li>
<li class="data-line-203">
<p>Alice envoie 30k satoshis à Bob.</p>
</li>
<li class="data-line-204">
<p>Alice essaie de défrauder Bob de ses 30k satoshis gagnés en publiant une ancienne transaction d&#8217;engagement réclamant la totalité des 100k satoshis pour elle-même.</p>
</li>
<li class="data-line-205">
<p>Bob détecte la fraude et punit Alice en prenant la totalité des 100k satoshis pour lui-même.</p>
</li>
<li class="data-line-206">
<p>Bob se retrouve avec 100k satoshis, gagnant 70 000 satoshis pour avoir surpris Alice en train de tricher.</p>
</li>
<li class="data-line-207">
<p>Alice se retrouve avec 0 satoshi.</p>
</li>
<li class="data-line-208">
<p>En essayant de défrauder Bob de 30 000 satoshis, elle perd les 70 000 satoshis qu&#8217;elle possédait.</p>
</li>
</ol>
</div>
<div class="paragraph data-line-210">
<p>Avec un mécanisme de pénalité fort, Alice n&#8217;est pas tentée de tricher en publiant une ancienne transaction d&#8217;engagement car elle risque de perdre l&#8217;intégralité de son solde.</p>
</div>
<div class="admonitionblock note data-line-213">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-214">
<p>Dans le chapitre 12 de <em>Maîtriser Bitcoin</em>, Andreas Antonopoulos (le co-auteur de ce livre) l&#8217;énonce comme suit :
"Une caractéristique clé de Bitcoin est qu&#8217;une fois qu&#8217;une transaction est valide, elle reste valide et n&#8217;expire pas. La seule façon d&#8217;annuler une transaction est de doubler la dépense de ses entrées avec une autre transaction avant qu&#8217;elle ne soit minée."</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-218">
<p>Maintenant que nous comprenons <em>pourquoi</em> un mécanisme de pénalité est nécessaire et comment il empêchera la triche, voyons <em>comment</em> cela fonctionne en détail.</p>
</div>
<div class="paragraph data-line-220">
<p>Habituellement, la transaction d&#8217;engagement a au moins deux sorties, payant chaque partenaire de canal. Nous modifions cela pour ajouter un <em>délai timelock</em> et un <em>secret de révocation</em> à l&#8217;un des paiements. Le timelock empêche le propriétaire de la sortie de la dépenser immédiatement une fois que la transaction d&#8217;engagement est incluse dans un bloc. Le secret de révocation permet à l&#8217;une ou l&#8217;autre des parties de dépenser immédiatement ce paiement, en contournant le timelock.</p>
</div>
<div class="paragraph data-line-222">
<p>Ainsi, dans notre exemple, Bob détient une transaction d&#8217;engagement qui paie Alice <em>immédiatement</em>, mais son propre paiement est différé et révocable. Alice détient également une transaction d&#8217;engagement, mais la sienne est à l&#8217;opposé : elle paie Bob immédiatement mais son propre paiement est différé et révocable.</p>
</div>
<div class="paragraph data-line-224">
<p>Les deux partenaires de canal détiennent la moitié du secret de révocation, de sorte qu&#8217;aucun ne connaît tout le secret. S&#8217;ils partagent leur moitié, l&#8217;autre partenaire de canal a le secret complet et peut l&#8217;utiliser pour exercer la condition de révocation. Lors de la signature d&#8217;une nouvelle transaction d&#8217;engagement, chaque partenaire de canal révoque l&#8217;engagement précédent en donnant à l&#8217;autre partie sa moitié du secret de révocation.</p>
</div>
<div class="paragraph data-line-226">
<p>Nous examinerons plus en détail le mécanisme de révocation dans <a href="#revocation">[revocation]</a>, où nous apprendrons les détails de la construction et de l&#8217;utilisation des secrets de révocation.</p>
</div>
<div class="paragraph data-line-228">
<p>En termes simples, Alice signe la nouvelle transaction d&#8217;engagement de Bob uniquement si Bob offre sa moitié du secret de révocation pour l&#8217;engagement précédent. Bob ne signe la nouvelle transaction d&#8217;engagement d&#8217;Alice que si elle lui donne la moitié du secret de révocation de l&#8217;engagement précédent.</p>
</div>
<div class="paragraph data-line-230">
<p>A chaque nouvel engagement, ils échangent le secret de "punition" nécessaire qui leur permet de <em>révoquer</em> efficacement la transaction d&#8217;engagement précédente en rendant non rentable sa transmission. Essentiellement, ils détruisent la capacité d&#8217;utiliser les anciens engagements lorsqu&#8217;ils signent les nouveaux. Ce que nous voulons dire, c&#8217;est que s&#8217;il est encore techniquement possible d&#8217;utiliser d&#8217;anciens engagements, le mécanisme de pénalité rend le fait <span class="keep-together">de le faire</span> économiquement irrationnel.</p>
</div>
<div class="paragraph data-line-232">
<p>Le timelock (verrouillage temporel) est défini sur un nombre de blocs allant jusqu&#8217;à 2 016 (environ deux semaines). Si l&#8217;un des partenaires de canal publie une transaction d&#8217;engagement sans coopérer avec l&#8217;autre partenaire, il devra attendre ce nombre de blocs (par exemple, deux semaines) pour réclamer son solde. L&#8217;autre partenaire de canal peut réclamer son propre solde à tout moment. De plus, si l&#8217;engagement qu&#8217;il a publié a déjà été révoqué, le partenaire de canal peut <em>également</em> réclamer immédiatement le solde de la partie qui triche, en contournant le timelock et en punissant le tricheur.</p>
</div>
<div class="paragraph data-line-234">
<p>Le timelock est réglable et peut être négocié entre les partenaires de canal. Habituellement, il est plus long pour les canaux de plus grande capacité, et plus court pour les canaux plus petits, afin d&#8217;aligner les incitations avec la valeur des fonds.</p>
</div>
<div class="paragraph data-line-236">
<p>Pour chaque nouvelle mise à jour du solde du canal, de nouvelles transactions d&#8217;engagement et de nouveaux secrets de révocation doivent être créés et enregistrés. Tant qu&#8217;un canal reste ouvert, tous les secrets de révocation <em>déjà créés</em> pour le canal doivent être conservés car ils pourraient être nécessaires à l&#8217;avenir. Heureusement, les secrets sont plutôt petits et seuls les partenaires de canal doivent les garder, pas l&#8217;ensemble du réseau. De plus, grâce à un mécanisme de dérivation intelligent utilisé pour dériver les secrets de révocation, nous n&#8217;avons besoin de stocker que le secret le plus récent, car les secrets précédents peuvent en être dérivés (voir <a href="#revocation_secret_derivation">[revocation_secret_derivation]</a>).</p>
</div>
<div class="paragraph data-line-238">
<p>Néanmoins, la gestion et le stockage des secrets de révocation sont l&#8217;une des parties les plus élaborées des nœuds Lightning qui nécessitent que les opérateurs de nœud conservent des sauvegardes.</p>
</div>
<div class="admonitionblock note data-line-241">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-242">
<p>Des technologies telles que les services de watchtower ou le changement du protocole de construction de canaux pour le protocole eltoo pourraient être des stratégies futures pour atténuer ces problèmes et réduire le besoin de secrets de révocation, de transactions de pénalité et de sauvegardes de canaux.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-245">
<p>Alice peut fermer le canal à tout moment si Bob ne répond pas, réclamant sa juste part du solde.
Après avoir publié la <em>dernière</em> transaction d&#8217;engagement sur la chaîne, Alice doit attendre l&#8217;expiration du délai avant de pouvoir dépenser les fonds de la transaction d&#8217;engagement. Comme nous le verrons plus tard, il existe un moyen plus simple de fermer un canal sans attendre, tant qu&#8217;Alice et Bob sont tous les deux en ligne et coopèrent pour fermer le canal avec la bonne allocation de solde. Mais les transactions d&#8217;engagement stockées par chaque partenaire de canal agissent comme une sécurité intégrée, garantissant qu&#8217;ils ne perdent pas de fonds en cas de problème avec leur partenaire de canal.</p>
</div>
</div>
<div class="sect3 data-line-248">
<h4 id="_annonce_du_canal">Annonce du canal</h4>
<div class="paragraph data-line-250">
<p>Les partenaires de canal peuvent convenir d&#8217;annoncer leur canal à l&#8217;ensemble du Lightning Network, ce qui en fait un <em>canal public</em>. Pour annoncer le canal, ils utilisent le protocole de bavardage du Lightning Network pour informer les autres nœuds de l&#8217;existence, de la capacité et des frais du canal.</p>
</div>
<div class="paragraph data-line-252">
<p>L&#8217;annonce publique des canaux permet à d&#8217;autres nœuds de les utiliser pour le routage de paiements, générant ainsi également des frais de routage pour les partenaires de canal.</p>
</div>
<div class="paragraph data-line-254">
<p>En revanche, les partenaires de canal peuvent décider de ne pas annoncer le canal, ce qui en fait un canal <em>non annoncé</em>.</p>
</div>
<div class="admonitionblock note data-line-258">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-259">
<p>Vous pouvez entendre le terme "canal privé" utilisé pour décrire un canal non annoncé. Nous évitons d&#8217;utiliser ce terme car il est trompeur et crée un faux sentiment de confidentialité. Bien qu&#8217;un canal non annoncé ne soit pas connu des autres pendant son utilisation, son existence et sa capacité seront révélées lors de la fermeture du canal car ces détails seront visibles sur la chaîne lors de la transaction de règlement finale. Son existence peut également fuir de diverses autres manières, nous évitons donc de l&#8217;appeler "privé".</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-262">
<p>Les canaux non annoncés sont toujours utilisés pour acheminer les paiements, mais uniquement par les nœuds qui sont conscients de leur existence, ou qui reçoivent des "indications de routage" sur un chemin qui inclut un canal non annoncé.</p>
</div>
<div class="paragraph data-line-264">
<p>Lorsqu&#8217;un canal et sa capacité sont annoncés publiquement à l&#8217;aide du protocole de bavardage, l&#8217;annonce peut également inclure des informations sur le canal (métadonnées), telles que ses frais de routage et la durée du timelock.</p>
</div>
<div class="paragraph data-line-266">
<p>Lorsque de nouveaux nœuds rejoignent le Lightning Network, ils collectent les annonces de canaux propagées via le protocole de bavardage de leurs pairs, en créant une carte interne du Lightning Network. Cette carte peut ensuite être utilisée pour trouver des routes de paiement, en connectant les canaux de bout en bout.</p>
</div>
</div>
<div class="sect3 data-line-268">
<h4 id="_fermeture_du_canal">Fermeture du canal</h4>
<div class="paragraph data-line-270">
<p>La meilleure façon de fermer un canal est&#8230;&#8203; de ne pas le fermer !
L&#8217;ouverture et la fermeture des canaux nécessitent une transaction sur la chaîne, ce qui entraînera des frais de transaction.
Il est donc préférable de garder les canaux ouverts le plus longtemps possible.
Vous pouvez continuer à utiliser votre canal pour effectuer et transférer des paiements, tant que vous disposez d&#8217;une capacité suffisante de votre côté du canal.
Mais même si vous envoyez tout le solde à l&#8217;autre extrémité du canal, vous pouvez ensuite utiliser le canal pour recevoir des paiements de votre partenaire de canal.
Ce concept d&#8217;utilisation d&#8217;un canal dans une direction, puis de son utilisation dans la direction opposée est appelé "rééquilibrage" ("rebalancing" en anglais), et nous l&#8217;examinerons plus en détail dans un autre chapitre.
En rééquilibrant un canal, il peut être maintenu ouvert presque indéfiniment et utilisé pour un nombre pratiquement illimité de paiements.</p>
</div>
<div class="paragraph data-line-279">
<p>Cependant, la fermeture d&#8217;un canal est parfois souhaitable ou nécessaire. Par exemple :</p>
</div>
<div class="ulist data-line-281">
<ul>
<li class="data-line-281">
<p>Vous souhaitez réduire le solde détenu sur vos canaux Lightning pour des raisons de sécurité et souhaitez envoyer des fonds en "cold storage".</p>
</li>
<li class="data-line-282">
<p>Votre partenaire de canal ne répond plus pendant une longue période et vous ne pouvez plus utiliser le canal.</p>
</li>
<li class="data-line-283">
<p>Le canal n&#8217;est pas souvent utilisé car votre partenaire de canal n&#8217;est pas un nœud bien connecté, vous souhaitez donc utiliser les fonds pour un autre canal avec un nœud mieux connecté.</p>
</li>
<li class="data-line-284">
<p>Votre partenaire de canal a enfreint le protocole en raison d&#8217;un bogue logiciel ou exprès, vous obligeant à fermer le canal pour protéger vos fonds.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-286">
<p>Il existe trois façons de fermer un canal de paiement :</p>
</div>
<div class="ulist data-line-288">
<ul>
<li class="data-line-288">
<p>Fermeture mutuelle (la bonne manière)</p>
</li>
<li class="data-line-289">
<p>Forcer la fermeture (la mauvaise manière)</p>
</li>
<li class="data-line-290">
<p>Violation du protocole (la manière laide)</p>
</li>
</ul>
</div>
<div class="paragraph data-line-292">
<p>Chacune de ces méthodes est utile dans des circonstances différentes, que nous explorerons dans les prochaines sections de ce chapitre.
Par exemple, si votre partenaire de canal est hors ligne, vous ne pourrez pas suivre "la bonne manière" car une fermeture mutuelle ne peut se faire sans un partenaire coopérant.
Habituellement, votre logiciel LN sélectionne automatiquement le meilleur mécanisme de fermeture disponible selon les circonstances.</p>
</div>
<div class="sect4 data-line-296">
<h5 id="_fermeture_mutuelle_la_bonne_manière">Fermeture mutuelle (la bonne manière)</h5>
<div class="paragraph data-line-298">
<p>La fermeture mutuelle se produit lorsque les deux partenaires du canal acceptent de fermer un canal, et c&#8217;est la méthode préférée de fermeture de canal.</p>
</div>
<div class="paragraph data-line-300">
<p>Lorsque vous décidez de fermer un canal, votre nœud LN informera votre partenaire de canal de votre intention.
Maintenant, votre nœud et le nœud du partenaire de canal travaillent ensemble pour fermer le canal.
Aucune nouvelle tentative de routage ne sera acceptée de l&#8217;un ou l&#8217;autre des partenaires de canal, et toutes les tentatives de routage en cours seront réglées ou supprimées après leur expiration.
La finalisation des tentatives de routage prend du temps, de sorte qu&#8217;une fermeture mutuelle peut également prendre un certain temps.</p>
</div>
<div class="paragraph data-line-305">
<p>Une fois qu&#8217;il n&#8217;y a plus de tentatives de routage en attente, les nœuds coopèrent pour préparer une <em>transaction de fermeture</em>.
Cette transaction est similaire à la transaction d&#8217;engagement : elle encode le dernier solde du canal, mais les sorties ne sont PAS grevées d&#8217;un timelock.</p>
</div>
<div class="paragraph data-line-308">
<p>Les frais de transaction sur la chaîne pour la transaction de fermeture sont payés par le partenaire de canal qui a ouvert le canal et non par celui qui a initié la procédure de fermeture.
À l&#8217;aide de l&#8217;estimateur de frais sur la chaîne, les partenaires de canal conviennent des frais appropriés et signent tous deux la transaction de fermeture.</p>
</div>
<div class="paragraph data-line-311">
<p>Une fois la transaction de fermeture diffusée et confirmée par le réseau Bitcoin, le canal est effectivement fermé et chaque partenaire de canal a reçu sa part du solde du canal.
Malgré le temps d&#8217;attente, une fermeture mutuelle est généralement plus rapide qu&#8217;une fermeture forcée.</p>
</div>
</div>
<div class="sect4 data-line-315">
<h5 id="_forcer_la_fermeture_la_mauvaise_manière">Forcer la fermeture (la mauvaise manière)</h5>
<div class="paragraph data-line-317">
<p>Une fermeture forcée se produit lorsqu&#8217;un partenaire de canal tente de fermer un canal sans le consentement de l&#8217;autre partenaire de canal.</p>
</div>
<div class="paragraph data-line-319">
<p>Cela se produit généralement lorsque l&#8217;un des partenaires de canal est injoignable, de sorte qu&#8217;une fermeture mutuelle n&#8217;est pas possible.
Dans ce cas, vous lanceriez une fermeture forcée pour fermer unilatéralement le canal et "libérer" les fonds.</p>
</div>
<div class="paragraph data-line-322">
<p>Pour initier une fermeture forcée, vous pouvez simplement publier la dernière transaction d&#8217;engagement de votre nœud.
Après tout, c&#8217;est à cela que servent les transactions d&#8217;engagement &#x2014; elles offrent la garantie que vous n&#8217;avez pas besoin de faire confiance à votre partenaire de canal pour récupérer le solde de votre canal.</p>
</div>
<div class="paragraph data-line-325">
<p>Une fois que vous avez diffusé la dernière transaction d&#8217;engagement sur le réseau Bitcoin et qu&#8217;elle est confirmée, cela créera deux sorties utilisables, une pour vous et une pour votre partenaire.
Comme nous en avons discuté précédemment, le réseau Bitcoin n&#8217;a aucun moyen de savoir s&#8217;il s&#8217;agissait de la transaction d&#8217;engagement la plus récente ou d&#8217;une ancienne qui a été publiée pour voler votre partenaire.
Par conséquent, cette transaction d&#8217;engagement donnera un léger avantage à votre partenaire.
Le partenaire qui a initié la fermeture forcée verra sa sortie grevée d&#8217;un timelock, et la sortie de l&#8217;autre partenaire pourra être dépensée immédiatement.
Dans le cas où vous avez diffusé une transaction d&#8217;engagement antérieure, le délai de blocage donne à votre partenaire la possibilité de contester la transaction en utilisant le secret de révocation et de vous punir pour avoir triché.</p>
</div>
<div class="paragraph data-line-331">
<p>Lors de la publication d&#8217;une transaction d&#8217;engagement durant une fermeture forcée, les frais sur la chaîne seront plus élevés qu&#8217;une fermeture mutuelle pour plusieurs raisons :</p>
</div>
<div class="olist arabic data-line-333">
<ol class="arabic">
<li class="data-line-333">
<p>Lorsque la transaction d&#8217;engagement a été négociée, les partenaires de canal ne savaient pas à combien s&#8217;élèveraient les frais sur la chaîne quand la transaction serait éventuellement diffusée. Étant donné que les frais ne peuvent pas être modifiés sans modifier les sorties de la transaction d&#8217;engagement (qui nécessite les deux signatures), et que la fermeture forcée se produit lorsqu&#8217;un partenaire de canal n&#8217;est pas disponible pour signer, les développeurs du protocole ont décidé d&#8217;être très généreux avec le taux de frais inclus dans les transactions d&#8217;engagement. Il peut être jusqu&#8217;à cinq fois plus élevé que ce que suggèrent les estimateurs de frais au moment où la transaction d&#8217;engagement est négociée.</p>
</li>
<li class="data-line-334">
<p>La transaction d&#8217;engagement inclut des sorties supplémentaires pour toutes les tentatives en attente de routage de contrats Hash Time-Locked (HTLC), ce qui rend la transaction d&#8217;engagement plus grande (en termes d&#8217;octets) qu&#8217;une transaction de fermeture mutuelle. Les transactions plus importantes entraînent plus de frais.</p>
</li>
<li class="data-line-335">
<p>Toute tentative de routage en attente devra être résolue sur la chaîne, ce qui entraînera des transactions supplémentaires sur la chaîne.</p>
</li>
</ol>
</div>
<div class="admonitionblock note data-line-338">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-339">
<p>Les contrats Hash Time-Locked (HTLC) seront traités en détail dans <a href="#htlcs">[htlcs]</a>.
Pour l&#8217;instant, supposons qu&#8217;il s&#8217;agisse de paiements acheminés via le Lightning Network, plutôt que de paiements effectués directement entre les deux partenaires de canal.
Ces HTLC sont transportés en tant que sorties supplémentaires dans les transactions d&#8217;engagement, augmentant ainsi la taille de la transaction et les frais sur la chaîne.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-344">
<p>En général, une fermeture forcée n&#8217;est pas recommandée sauf en cas d&#8217;absolue nécessité.
Vos fonds seront bloqués plus longtemps et la personne qui a ouvert le canal devra payer des frais plus élevés.
De plus, vous devrez peut-être payer des frais de chaîne pour abandonner ou régler les tentatives de routage même si vous n&#8217;avez pas ouvert le canal.</p>
</div>
<div class="paragraph data-line-348">
<p>Si vous connaissez le partenaire de canal, vous pouvez envisager de contacter cette personne ou cette entreprise pour savoir pourquoi son nœud Lightning est en panne et lui demander de le redémarrer afin que vous puissiez parvenir à une fermeture mutuelle du canal.</p>
</div>
<div class="paragraph data-line-350">
<p>Vous ne devriez envisager une fermeture forcée qu&#8217;en dernier recours.</p>
</div>
</div>
<div class="sect4 data-line-352">
<h5 id="_violation_du_protocole_la_manière_laide">Violation du protocole (la manière laide)</h5>
<div class="paragraph data-line-354">
<p>Une violation de protocole se produit lorsque votre partenaire de canal tente de vous tromper, délibérément ou non, en publiant une transaction d&#8217;engagement obsolète sur la blockchain Bitcoin, initiant essentiellement une fermeture forcée (malhonnête) de leur côté.</p>
</div>
<div class="paragraph data-line-356">
<p>Votre nœud doit être en ligne et surveiller de nouveaux blocs et transactions sur la blockchain Bitcoin pour détecter ceci.</p>
</div>
<div class="paragraph data-line-358">
<p>Étant donné que le paiement de votre partenaire de canal sera grevé d&#8217;un timelock, votre nœud dispose d&#8217;un certain temps pour agir afin de détecter une violation de protocole et publier une <em>transaction punitive</em> avant l&#8217;expiration du timelock.</p>
</div>
<div class="paragraph data-line-360">
<p>Si vous réussissez à détecter la violation du protocole et à appliquer la pénalité, vous recevrez tous les fonds du canal, y compris les fonds de votre partenaire de canal.</p>
</div>
<div class="paragraph data-line-362">
<p>Dans ce scénario, la fermeture du canal sera assez rapide.
Vous devrez payer des frais sur la chaîne pour publier la transaction punitive, mais votre nœud peut définir ces frais en fonction de l&#8217;estimation des frais et ne pas surpayer.
Vous voudrez généralement payer des frais plus élevés pour garantir une confirmation dès que possible.
Cependant, comme vous recevrez éventuellement tous les fonds du tricheur, c&#8217;est essentiellement le tricheur qui paiera pour cette transaction.</p>
</div>
<div class="paragraph data-line-367">
<p>Si vous ne parvenez pas à détecter la violation du protocole et que le timelock expire, vous ne recevrez que les fonds qui vous ont été alloués par la transaction d&#8217;engagement publiée par votre partenaire.
Tous les fonds que vous avez reçus après cela auront été volés par votre partenaire.
Si un solde vous est attribué, vous devrez payer des frais sur la chaîne pour percevoir ce solde.</p>
</div>
<div class="paragraph data-line-371">
<p>Comme pour une fermeture forcée, toutes les tentatives de routage en attente devront également être résolues dans la transaction d&#8217;engagement.</p>
</div>
<div class="paragraph data-line-373">
<p>Une violation de protocole peut être exécutée plus rapidement qu&#8217;une fermeture mutuelle parce que vous n&#8217;attendez pas pour négocier une fermeture avec votre partenaire, et plus rapidement qu&#8217;une fermeture forcée parce que vous n&#8217;avez pas besoin d&#8217;attendre que votre timelock expire.</p>
</div>
<div class="paragraph data-line-375">
<p>La théorie des jeux prédit que tricher n&#8217;est pas une stratégie attrayante car il est facile de détecter un tricheur, et le tricheur risque de perdre <em>tous</em> ses fonds tout en ne pouvant gagner que ce qu&#8217;il avait dans un état antérieur.
De plus, à mesure que le Lightning Network mûrit et que les tours de guet ("watchtowers" en anglais) se généralisent, les tricheurs seront détectables par une tierce partie même si le partenaire de canal trompé est hors ligne.</p>
</div>
<div class="paragraph data-line-378">
<p>Par conséquent, nous vous déconseillons de tricher.
Nous recommandons en revanche à toute personne qui attrape un tricheur de le punir en lui retirant ses fonds.</p>
</div>
<div class="paragraph data-line-381">
<p>Alors, comment attraper un tricheur ou une violation de protocole dans vos activités quotidiennes ?
Pour ce faire, vous exécutez un logiciel qui surveille la blockchain publique Bitcoin pour les transactions sur la chaîne qui correspondent à toutes les transactions d&#8217;engagement pour l&#8217;un de vos canaux.
Ce logiciel est l&#8217;un des trois types suivants :</p>
</div>
<div class="ulist data-line-385">
<ul>
<li class="data-line-385">
<p>Un nœud Lightning correctement entretenu, fonctionnant 24h/24 et 7j/7</p>
</li>
<li class="data-line-386">
<p>Un nœud watchtower à usage unique que vous exécutez pour surveiller vos canaux</p>
</li>
<li class="data-line-387">
<p>Un nœud watchtower tiers que vous payez pour surveiller vos canaux</p>
</li>
</ul>
</div>
<div class="paragraph data-line-389">
<p>N&#8217;oubliez pas que la transaction d&#8217;engagement a une période de temporisation spécifiée en tant qu&#8217;un nombre donné de blocs, jusqu&#8217;à un maximum de 2016 blocs.
Tant que vous exécutez votre nœud Lightning une fois avant que le délai d&#8217;expiration ne soit atteint, il détectera toutes les tentatives de triche.
Il n&#8217;est pas conseillé de prendre ce genre de risque ; il est important de garder un nœud bien entretenu en fonctionnement continu (voir <a href="#continuous_operation">[continuous_operation]</a>).</p>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-393">
<h3 id="_factures">Factures</h3>
<div class="paragraph data-line-395">
<p>La plupart des paiements sur le Lightning Network commencent par une facture, générée par le destinataire du paiement. Dans notre exemple précédent, Bob crée une facture pour demander un paiement à Alice.</p>
</div>
<div class="admonitionblock note data-line-398">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-399">
<p>Il existe un moyen d&#8217;envoyer un paiement non sollicité sans facture, en utilisant une solution de contournement dans le protocole appelé keysend. Nous examinerons cela dans <a href="#keysend">[keysend]</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-402">
<p>Une facture est une simple instruction de paiement contenant des informations telles qu&#8217;un identifiant de paiement unique (appelé hachage de paiement), un destinataire, un montant et une description textuelle facultative.</p>
</div>
<div class="paragraph data-line-404">
<p>La partie la plus importante de la facture est le hachage de paiement, qui permet au paiement de circuler sur plusieurs canaux de manière <em>atomique</em>. Atomique, en informatique, signifie toute action ou tout changement d&#8217;état qui est terminé avec succès ou qui ne l&#8217;est pas du tout &#x2014; il n&#8217;y a aucune possibilité d&#8217;état intermédiaire ou d&#8217;action partielle. Dans le Lightning Network, cela signifie que le paiement parcourt tout le chemin ou échoue complètement. Il ne peut pas être partiellement rempli de sorte qu&#8217;un nœud intermédiaire sur le chemin puisse recevoir le paiement et le conserver.
Il n&#8217;existe pas de "paiement partiel" ou de "paiement partiellement réussi".</p>
</div>
<div class="paragraph data-line-407">
<p>Les factures ne sont pas communiquées sur le Lightning Network. Au lieu de cela, elles sont communiquées "hors bande", en utilisant tout autre mécanisme de communication. Ceci est similaire à la façon dont les adresses Bitcoin sont communiquées aux expéditeurs en dehors du réseau Bitcoin : sous forme de code QR, par e-mail ou par SMS. Par exemple, Bob peut présenter une facture Lightning à Alice sous forme de code QR, par e-mail ou via tout autre canal de messagerie.</p>
</div>
<div class="paragraph data-line-409">
<p>Les factures sont généralement encodées soit sous la forme d&#8217;une longue chaîne encodée au format <em>bech32</em>, soit sous la forme d&#8217;un code QR, à scanner par un porte-monnaie Lightning sur smartphone. La facture contient le montant en bitcoin demandé et une signature du destinataire. L&#8217;expéditeur utilise la signature pour extraire la clé publique (également appelée ID de nœud) du destinataire afin que l&#8217;expéditeur sache où envoyer le paiement.</p>
</div>
<div class="paragraph data-line-411">
<p>Avez-vous remarqué à quel point cela contraste avec Bitcoin et comment les différents termes sont utilisés ? Sur Bitcoin, le destinataire transmet une adresse à l&#8217;expéditeur. Sur Lightning, le destinataire crée une facture et envoie une facture à l&#8217;expéditeur. Sur Bitcoin, l&#8217;expéditeur envoie des fonds à une adresse. Sur Lightning, l&#8217;expéditeur paie une facture et le paiement est acheminé vers le destinataire. Bitcoin est basé sur le concept "d&#8217;adresse" et Lightning est un réseau de paiement basé sur le concept de "facture". Dans Bitcoin, nous créons une "transaction", tandis que dans Lightning, nous envoyons un "paiement".</p>
</div>
<div class="sect3 data-line-413">
<h4 id="_hachage_de_paiement_et_préimage">Hachage de paiement et préimage</h4>
<div class="paragraph data-line-415">
<p>La partie la plus importante de la facture est le <em>hachage de paiement</em>. Lors de la construction de la facture, Bob effectuera un hachage de paiement comme suit :</p>
</div>
<div class="olist arabic data-line-417">
<ol class="arabic">
<li class="data-line-417">
<p>Bob choisit un nombre aléatoire <em>r</em>. Ce nombre aléatoire est appelé <em>préimage</em> ou <em>secret de paiement</em>.</p>
</li>
<li class="data-line-418">
<p>Bob utilise SHA-256 pour calculer le hachage <em>H</em> de <em>r</em> appelé <em>hachage de paiement</em> : <br/><em>H</em> = SHA-256(<em>r</em>).</p>
</li>
</ol>
</div>
<div class="admonitionblock note data-line-421">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-422">
<p>Le terme <em>préimage</em> vient des mathématiques. Dans toute fonction <span class="keep-together"><em>y</em> = <em>f</em>(<em>x</em>)</span>, l&#8217;ensemble des entrées qui produisent une certaine valeur <em>y</em> sont appelés la préimage de <em>y</em>. Dans ce cas, la fonction est l&#8217;algorithme de hachage SHA-256, et toute valeur <em>r</em> qui produit le hachage <em>H</em> est appelée une préimage.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-425">
<p>Il n&#8217;existe aucun moyen connu de trouver l&#8217;inverse de SHA-256 (c&#8217;est-à-dire de calculer une préimage à partir d&#8217;un hachage). Seul Bob connaît la valeur <em>r</em>, c&#8217;est donc le secret de Bob. Mais une fois que Bob révèle <em>r</em>, quiconque possède le hachage <em>H</em> peut vérifier que <em>r</em> est le bon secret, en calculant SHA-256(<em>r</em>) et en voyant qu&#8217;il correspond à <em>H</em>.</p>
</div>
<div class="paragraph data-line-427">
<p>Le processus de paiement du Lightning Network n&#8217;est sécurisé que si <em>r</em> est choisi de manière complètement aléatoire et n&#8217;est pas prévisible. Cette sécurité repose sur le fait que les fonctions de hachage ne peuvent pas être inversées ou de manière faisable brisée par une attaque par force brute, par conséquent, personne ne peut trouver <em>r</em> à partir de <em>H</em>.</p>
</div>
</div>
<div class="sect3 data-line-429">
<h4 id="_métadonnées_supplémentaires">Métadonnées supplémentaires</h4>
<div class="paragraph data-line-431">
<p>Les factures peuvent éventuellement inclure d&#8217;autres métadonnées utiles telles qu&#8217;une courte description textuelle. Si un utilisateur a plusieurs factures à payer, l&#8217;utilisateur peut lire la description et se rappeler l&#8217;objet de la facture.</p>
</div>
<div class="paragraph data-line-433">
<p>La facture peut également inclure des <em>conseils de routage</em>, qui permettent à l&#8217;expéditeur d&#8217;utiliser des canaux non annoncés pour construire une route vers le destinataire. Les conseils de routage peuvent également être utilisés pour suggérer des canaux publics, par exemple, des canaux connus par le destinataire pour avoir une capacité entrante suffisante afin d&#8217;acheminer le paiement.</p>
</div>
<div class="paragraph data-line-435">
<p>Si le nœud Lightning de l&#8217;expéditeur n&#8217;est pas en mesure d&#8217;envoyer le paiement via le Lightning Network, les factures peuvent éventuellement inclure une adresse Bitcoin sur la chaîne comme solution de secours.</p>
</div>
<div class="admonitionblock note data-line-438">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-439">
<p>S&#8217;il est toujours possible de se "replier" sur une transaction Bitcoin sur la chaîne, il est en fait plutôt préférable d&#8217;ouvrir un nouveau canal avec le destinataire. Si vous devez encourir des frais sur la chaîne pour effectuer un paiement, vous pouvez également encourir ces frais pour ouvrir un canal et effectuer le paiement via Lightning. Une fois le paiement effectué, il vous reste un canal ouvert qui dispose de liquidités du côté du destinataire et peut être utilisé pour réacheminer les paiements vers votre nœud Lightning à l&#8217;avenir. Une transaction sur la chaîne vous donne un paiement et un canal pour une utilisation future.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-443">
<p>Les factures Lightning contiennent une date d&#8217;expiration. Étant donné que le destinataire doit conserver la préimage <em>r</em> pour chaque facture émise, il est utile que les factures expirent afin que ces préimages n&#8217;aient pas besoin d&#8217;être conservées indéfiniment. Une fois qu&#8217;une facture expire ou est payée, le destinataire peut supprimer la préimage.</p>
</div>
</div>
</div>
<div class="sect2 data-line-445">
<h3 id="_livrer_le_paiement">Livrer le paiement</h3>
<div class="paragraph data-line-447">
<p>Nous avons vu comment le destinataire crée une facture qui contient un hachage de paiement. Ce hachage de paiement sera utilisé pour déplacer le paiement sur une série de canaux de paiement, de l&#8217;expéditeur au destinataire, même s&#8217;ils n&#8217;ont pas de canal de paiement direct entre eux.</p>
</div>
<div class="paragraph data-line-449">
<p>Dans les prochaines sections, nous plongerons dans les idées et les méthodes utilisées pour effectuer un paiement sur le Lightning Network et utiliserons tous les concepts que nous avons présentés jusqu&#8217;à présent.</p>
</div>
<div class="paragraph data-line-451">
<p>Examinons d&#8217;abord le protocole de communication du Lightning Network.</p>
</div>
<div class="sect3 data-line-453">
<h4 id="_le_protocole_de_bavardage_pair_à_pair">Le protocole de bavardage pair-à-pair</h4>
<div class="paragraph data-line-455">
<p>Comme nous l&#8217;avons mentionné précédemment, lorsqu&#8217;un canal de paiement est construit, les partenaires du canal ont la possibilité de le rendre public, en annonçant son existence et ses détails à l&#8217;ensemble du Lightning Network.</p>
</div>
<div class="paragraph data-line-457">
<p>Les annonces de canal sont communiquées via un <em>protocole de bavardage</em> pair-à-pair. Un protocole pair-à-pair est un protocole de communication dans lequel chaque nœud se connecte à une sélection aléatoire d&#8217;autres nœuds du réseau, généralement via TCP/IP. Chacun des nœuds qui sont directement connectés (via TCP/IP) à votre nœud sont appelés vos <em>pairs</em>. Votre nœud, à son tour, est l&#8217;un de leurs pairs. Gardez à l&#8217;esprit que lorsque nous disons que votre nœud est connecté à d&#8217;autres pairs, nous ne voulons pas dire que vous avez des canaux de paiement, mais seulement que vous êtes connecté via le protocole de bavardage.</p>
</div>
<div class="paragraph data-line-459">
<p>Après avoir ouvert un canal, un nœud peut choisir d&#8217;envoyer une annonce du canal via le message <code>channel_announcement</code> à ses pairs.
Chaque pair valide les informations du message <code>channel_announcement</code> et vérifie que la transaction de financement est confirmée sur la blockchain Bitcoin.
Après vérification, le nœud transmettra le message de bavardage à ses propres pairs, et ils le transmettront à leurs pairs, et ainsi de suite, en diffusant l&#8217;annonce sur l&#8217;ensemble du réseau.
Pour éviter une communication excessive, l&#8217;annonce de canal n&#8217;est transmise par chaque nœud que s&#8217;il n&#8217;a pas déjà transmis cette annonce précédemment.</p>
</div>
<div class="paragraph data-line-464">
<p>Le protocole de bavardage est également utilisé pour annoncer des informations sur les nœuds connus avec le message <code>node_announcement</code>.
Pour que ce message soit transmis, un nœud doit avoir au moins un canal public annoncé sur le protocole de bavardage, là encore pour éviter un trafic de communication excessif.</p>
</div>
<div class="paragraph data-line-467">
<p>Les canaux de paiement disposent de diverses métadonnées utiles pour les autres participants du réseau.
Ces métadonnées sont principalement utilisées pour prendre des décisions de routage.
Étant donné que les nœuds peuvent occasionnellement modifier les métadonnées de leurs canaux, ces informations sont partagées dans un message <code>channel_update</code>.
Ces messages ne seront transférés qu&#8217;environ quatre fois par jour (par canal) pour éviter une communication excessive.
Le protocole de bavardage a également un assortiment de requêtes et de messages pour synchroniser initialement un nœud avec la vue du réseau ou pour mettre à jour la vue du nœud lorsqu&#8217;il a été hors ligne pendant un certain temps.</p>
</div>
<div class="paragraph data-line-473">
<p>Un défi majeur pour les participants du Lightning Network est que les informations de topologie partagées par le protocole de bavardage ne sont que partielles.
Par exemple, la capacité des canaux de paiement est partagée sur le protocole de bavardage via le message <span class="keep-together"><code>channel_announcement</code></span>.
Cependant, cette information n&#8217;est pas aussi utile que la répartition réelle de la capacité en termes de solde local entre les deux partenaires de canal.
Un nœud ne peut transmettre que la quantité de bitcoins qu&#8217;il possède réellement (solde local) au sein de ce canal.</p>
</div>
<div class="paragraph data-line-478">
<p>Bien que le Lightning Network aurait pu être conçu pour partager des informations de solde des canaux et une topologie précise, cela n&#8217;est pas le cas pour plusieurs raisons :</p>
</div>
<div class="ulist data-line-480">
<ul>
<li class="data-line-480">
<p>Pour protéger la confidentialité des utilisateurs, il n&#8217;annonce pas toutes les transactions financières et tous les paiements. Les mises à jour du solde du canal révéleraient qu&#8217;un paiement a traversé le canal. Ces informations pourraient être corrélées pour révéler toutes les sources et destinations de paiements.</p>
</li>
<li class="data-line-482">
<p>Pour rendre évolutif le montant des paiements pouvant être effectués avec le Lightning Network. N&#8217;oubliez pas que le Lightning Network a été créé en premier lieu car notifier chaque participant de tous les paiements ne peut pas se faire à grande échelle. Ainsi, le Lightning Network ne peut pas être conçu de manière à partager les mises à jour de soldes des canaux entre les participants.</p>
</li>
<li class="data-line-484">
<p>Le Lightning Network est un système dynamique. Il change constamment et fréquemment. Des nœuds sont ajoutés, d&#8217;autres nœuds sont désactivés, les soldes changent, etc. Même si tout est toujours communiqué, les informations ne seront valables que durant une courte période. En fait, l&#8217;information est souvent obsolète au moment où elle est reçue.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-486">
<p>Nous examinerons les détails du protocole de bavardage dans un chapitre ultérieur.</p>
</div>
<div class="paragraph data-line-488">
<p>Pour l&#8217;instant, il est seulement important de savoir que le protocole de bavardage existe et qu&#8217;il est utilisé pour partager les informations de topologie du Lightning Network.
Ces informations de topologie sont essentielles pour effectuer des paiements via le réseau de canaux de paiement.</p>
</div>
</div>
<div class="sect3 data-line-492">
<h4 id="_recherche_de_chemin_et_routage">Recherche de chemin et routage</h4>
<div class="paragraph data-line-494">
<p>Les paiements sur le Lightning Network sont transmis le long d&#8217;un <em>chemin</em> constitué de canaux reliant un participant à un autre, de la source de paiement à la destination du paiement. Le processus de recherche d&#8217;un chemin de la source à la destination s&#8217;appelle le <em>pathfinding</em>. Le processus d&#8217;utilisation de ce chemin pour effectuer le paiement est appelé <em>routage</em>.</p>
</div>
<div class="admonitionblock note data-line-497">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-498">
<p>Une critique fréquente du Lightning Network est que le routage n&#8217;est pas résolu, voire qu&#8217;il s&#8217;agit d&#8217;un problème "insoluble". En fait, le routage est trivial. Le pathfinding, d&#8217;autre part, est un problème difficile. Les deux termes sont souvent confondus et doivent être clairement définis pour identifier le problème que nous tentons de résoudre.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-501">
<p>Comme nous le verrons par la suite, le Lightning Network utilise actuellement un protocole <em>basé sur la source</em> pour la recherche de chemins et un protocole de <em>routage en oignon</em> pour acheminer les paiements. Basé sur la source signifie que l&#8217;expéditeur du paiement doit trouver un chemin à travers le réseau jusqu&#8217;à la destination prévue. Le routage en oignon signifie que les éléments du chemin sont en couches (comme un oignon), chaque couche étant cryptée de sorte qu&#8217;elle ne peut être vue que par un nœud à la fois. Nous discuterons du routage en oignon dans la section suivante.</p>
</div>
</div>
</div>
<div class="sect2 data-line-503">
<h3 id="_pathfinding_basé_sur_la_source">Pathfinding basé sur la source</h3>
<div class="paragraph data-line-505">
<p>Si nous connaissions les soldes exacts de chaque canal, nous pourrions facilement calculer un chemin de paiement à l&#8217;aide de l&#8217;un des algorithmes de pathfinding standard enseignés dans n&#8217;importe quel cours d&#8217;informatique. Cela pourrait même être résolu de manière à optimiser les frais payés aux nœuds pour la transmission du paiement.</p>
</div>
<div class="paragraph data-line-507">
<p>Cependant, les informations de solde de tous les canaux ne sont pas et ne peuvent pas être connues de tous les participants du réseau. Nous avons besoin de stratégies de pathfinding plus innovantes.</p>
</div>
<div class="paragraph data-line-509">
<p>Avec seulement des informations partielles sur la topologie du réseau, le pathfinding est un véritable défi et des recherches actives sont toujours en cours dans cette partie du Lightning Network. Le fait que le problème de pathfinding ne soit pas "entièrement résolu" dans le Lightning Network est un point de critique majeur envers la technologie.</p>
</div>
<div class="admonitionblock note data-line-512">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-513">
<p>Une critique courante du pathfinding dans le Lightning Network est qu&#8217;il est insoluble car il équivaut au <em>Problème du voyageur de commerce</em> ("traveling salesperson problem" ou "TSP" en anglais) qui est NP-complet, un problème fondamental de la théorie de la complexité computationnelle. En fait, le pathfinding dans Lightning n&#8217;est pas équivalente au TSP et relève d&#8217;une classe de problèmes différente. Nous résolvons avec succès ces types de problèmes (pathfinding dans des graphes avec des informations incomplètes) chaque fois que nous demandons à Google de nous donner des indications routières avec évitement de trafic. Nous résolvons également avec succès ce problème chaque fois que nous acheminons un paiement sur le Lightning Network.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-516">
<p>Le pathfinding et le routage peuvent être mis en œuvre de différentes manières, et plusieurs algorithmes de pathfinding et de routage peuvent coexister sur le Lightning Network, tout comme plusieurs algorithmes de pathfinding et de routage existent sur Internet. La pathfinding basée sur la source est l&#8217;une des nombreuses solutions possibles et fonctionne avec succès à l&#8217;échelle actuelle du Lightning Network.</p>
</div>
<div class="paragraph data-line-518">
<p>La stratégie de pathfinding actuellement mise en œuvre par les nœuds Lightning consiste à essayer de manière itérative des chemins jusqu&#8217;à en trouver un qui dispose de suffisamment de liquidités pour transférer le paiement. Il s&#8217;agit d&#8217;un processus itératif d&#8217;essais et d&#8217;erreurs, jusqu&#8217;à ce que le succès soit atteint ou qu&#8217;aucun chemin ne soit trouvé. L&#8217;algorithme actuel n&#8217;aboutit pas nécessairement au chemin avec les frais les plus bas. Bien que ce ne soit pas optimal et qu&#8217;elle puisse certainement être améliorée, cette stratégie simpliste fonctionne tout de même assez bien.</p>
</div>
<div class="paragraph data-line-520">
<p>Ce "sondage" est effectué par le nœud Lightning ou le porte-monnaie et n&#8217;est pas directement vu par l&#8217;utilisateur.
L&#8217;utilisateur peut seulement se rendre compte que le sondage est en train d&#8217;avoir lieu si le paiement ne se termine pas instantanément.</p>
</div>
<div class="admonitionblock note data-line-524">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-525">
<p>Sur Internet, nous utilisons l&#8217;Internet Protocol et un algorithme de transfert IP pour transférer des paquets de l&#8217;expéditeur à leur destination. Bien que ces protocoles aient la propriété sympathique de permettre aux hôtes Internet de trouver en collaboration un chemin pour le flux d&#8217;informations sur Internet, nous ne pouvons pas réutiliser et adopter ce protocole pour transférer les paiements sur le Lightning Network. Contrairement à Internet, les paiements Lightning doivent être <em>atomiques</em> et les soldes des canaux doivent rester <em>privés</em>. De plus, la capacité des canaux dans Lightning change fréquemment, contrairement à Internet où la capacité de connexion est relativement statique. Ces contraintes nécessitent de nouvelles <span class="keep-together">stratégies</span>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-528">
<p>Bien sûr, le pathfinding est trivial si nous voulons payer notre partenaire de canal direct et que nous avons suffisamment de solde de notre côté du canal pour le faire. Dans tous les autres cas, notre nœud utilise les informations du protocole de bavardage pour faire le pathfinding. Cela inclut les canaux de paiement publics actuellement connus, les nœuds connus, la topologie connue (comment les nœuds connus sont connectés), les capacités des canaux connus et les politiques de tarification connues définies par les propriétaires de nœuds.</p>
</div>
<div class="sect3 data-line-530">
<h4 id="_routage_en_oignon">Routage en oignon</h4>
<div class="paragraph data-line-532">
<p>Le Lightning Network utilise un <em>protocole de routage en oignon</em> similaire au célèbre réseau Tor (The Onion Router).
Le protocole de routage en oignon utilisé dans Lightning est appelé <em>SPHINX Mix Format</em>,<sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup>  qui sera expliqué en détail dans un chapitre ultérieur.</p>
</div>
<div class="admonitionblock note data-line-536">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-537">
<p>Le SPHINX Mix Format de Lightning n&#8217;est similaire au routage du réseau Tor que dans son concept, mais le protocole et l&#8217;implémentation sont entièrement différents de ceux utilisés dans le réseau Tor.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-540">
<p>Un paquet de paiement utilisé pour le routage est appelé un "oignon".<sup class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnotedef_3" title="View footnote.">3</a>]</sup></p>
</div>
<div class="paragraph data-line-542">
<p>Utilisons l&#8217;analogie de l&#8217;oignon pour suivre un paiement routé. Sur son parcours de l&#8217;expéditeur du paiement (payeur) à la destination du paiement (bénéficiaire), l&#8217;oignon est transmis de nœud en nœud le long du chemin. L&#8217;expéditeur construit l&#8217;oignon entier, du centre vers l&#8217;extérieur. Tout d&#8217;abord, l&#8217;expéditeur crée les informations de paiement pour le destinataire (final) du paiement et les crypte avec une couche de cryptage que seul le destinataire peut décrypter. Ensuite, l&#8217;expéditeur encapsule cette couche avec des instructions pour le nœud <em>précédant immédiatement le destinataire final</em> dans le chemin et l&#8217;encrypte avec une couche que seul ce nœud peut décrypter.</p>
</div>
<div class="paragraph data-line-544">
<p>Les couches sont construites avec des instructions, en travaillant à rebours jusqu&#8217;à ce que le chemin entier soit encodé en couches. L&#8217;expéditeur donne ensuite l&#8217;oignon complet au premier nœud du chemin, qui ne peut lire que la couche la plus externe. Chaque nœud épluche une couche, trouve des instructions à l&#8217;intérieur révélant le nœud suivant dans le chemin et transmet l&#8217;oignon. Comme chaque nœud épluche une couche, il ne peut pas lire le reste de l&#8217;oignon. Tout ce qu&#8217;il sait, c&#8217;est d&#8217;où vient l&#8217;oignon et où il va ensuite, sans aucune indication quant à qui est l&#8217;expéditeur d&#8217;origine ou le destinataire final.</p>
</div>
<div class="paragraph data-line-546">
<p>Cela continue jusqu&#8217;à ce que l&#8217;oignon atteigne la destination du paiement (bénéficiaire). Ensuite, le nœud de destination ouvre l&#8217;oignon et trouve qu&#8217;il n&#8217;y a plus de couches à décrypter et peut lire les informations de paiement à l&#8217;intérieur.</p>
</div>
<div class="admonitionblock note data-line-549">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-550">
<p>Contrairement à un vrai oignon, lors de l&#8217;épluchage de chaque couche, les nœuds ajoutent un rembourrage encrypté pour conserver la même taille d&#8217;oignon pour le nœud suivant. Comme nous le verrons, cela rend impossible pour l&#8217;un des nœuds intermédiaires de savoir quoi que ce soit sur la taille (longueur) du chemin, combien de nœuds sont impliqués dans le routage, combien de nœuds les ont précédés ou combien suivent. Cela augmente la confidentialité en empêchant les attaques triviales d&#8217;analyse du trafic.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-553">
<p>Le protocole de routage en oignon utilisé dans Lightning possède les propriétés suivantes :</p>
</div>
<div class="ulist data-line-555">
<ul>
<li class="data-line-555">
<p>Un nœud intermédiaire ne peut voir que sur quel canal il a reçu un oignon et sur quel canal transmettre l&#8217;oignon. Cela signifie qu&#8217;aucun nœud de routage ne peut savoir qui a initié le paiement et à qui le paiement est destiné. C&#8217;est la propriété la plus importante, qui se traduit par un degré élevé de confidentialité.</p>
</li>
<li class="data-line-557">
<p>Les oignons sont suffisamment petits pour tenir dans un seul paquet TCP/IP et même dans une trame de couche de liaison (par exemple, Ethernet). Cela rend l&#8217;analyse du trafic des paiements beaucoup plus difficile, ce qui augmente encore la confidentialité.</p>
</li>
<li class="data-line-559">
<p>Les oignons sont construits de telle sorte qu&#8217;ils auront toujours la même longueur indépendamment de la position du nœud de traitement le long du chemin. Au fur et à mesure que chaque couche est "épluchée", l&#8217;oignon est rempli de données "déchet" cryptées pour conserver la même taille d&#8217;oignon. Cela empêche les nœuds intermédiaires de connaître leur position sur le chemin.</p>
</li>
<li class="data-line-561">
<p>Les oignons ont un HMAC (code d&#8217;authentification de message basé sur le hachage) sur chaque couche afin que les manipulations des oignons soient empêchées et pratiquement impossibles.</p>
</li>
<li class="data-line-563">
<p>Les oignons peuvent avoir jusqu&#8217;à environ 26 sauts, ou couches d&#8217;oignon si vous préférez. Cela permet des trajets suffisamment longs. La longueur de chemin précise disponible dépend de la quantité d&#8217;octets alloués à la charge utile du routage à chaque saut.</p>
</li>
<li class="data-line-565">
<p>Le cryptage de l&#8217;oignon pour chaque saut utilise différentes clés de cryptage éphémères. Si une clé (en particulier la clé privée d&#8217;un nœud) fuit à un moment donné, un attaquant ne peut pas les décrypter. En termes plus simples, les clés ne sont jamais réutilisées afin d&#8217;augmenter la sécurité.</p>
</li>
<li class="data-line-567">
<p>Des erreurs peuvent être renvoyées du nœud qui a rencontré une erreur  vers l&#8217;expéditeur d&#8217;origine, en utilisant le même protocole routé par oignon. Les oignons d&#8217;erreur sont indiscernables des oignons de routage pour des observateurs externes et des nœuds intermédiaires. Le routage d&#8217;erreur permet la méthode de "sondage" ("probing" en anglais) par essais-et-erreurs utilisée pour trouver un chemin ayant une capacité suffisante pour acheminer avec succès un paiement.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-569">
<p>Le routage des oignons sera examiné en détail dans <a href="#onion_routing">[onion_routing]</a>.</p>
</div>
</div>
<div class="sect3 data-line-571">
<h4 id="_algorithme_de_transfert_de_paiement">Algorithme de transfert de paiement</h4>
<div class="paragraph data-line-573">
<p>Une fois que l&#8217;expéditeur d&#8217;un paiement trouve un chemin possible sur le réseau et construit un oignon, le paiement est transmis par chaque nœud du chemin. Chaque nœud traite une couche de l&#8217;oignon et la transmet au nœud suivant sur le chemin.</p>
</div>
<div class="paragraph data-line-575">
<p>Chaque nœud intermédiaire reçoit un message Lightning appelé <code>update_add_htlc</code> avec un hachage de paiement et un oignon. Le nœud intermédiaire exécute une série d&#8217;étapes, appelées <em>algorithme de transfert de paiement</em> :</p>
</div>
<div class="olist arabic data-line-577">
<ol class="arabic">
<li class="data-line-577">
<p>Le nœud décrypte la couche externe de l&#8217;oignon et vérifie l&#8217;intégrité du message.</p>
</li>
<li class="data-line-579">
<p>Il confirme qu&#8217;il peut réaliser les indications de routage, sur la base des frais de canal et de la capacité disponible sur le canal sortant.</p>
</li>
<li class="data-line-581">
<p>Il travaille avec son partenaire de canal sur le canal entrant pour mettre à jour l&#8217;état du canal.</p>
</li>
<li class="data-line-583">
<p>Il ajoute un peu de rembourrage à la fin de l&#8217;oignon pour le maintenir à une longueur constante car il a supprimé certaines données du début.</p>
</li>
<li class="data-line-585">
<p>Il suit les conseils de routage pour transmettre le paquet oignon modifié sur son canal de paiement sortant en envoyant également un message <code>update_add_htlc</code> qui inclut le même hachage de paiement et l&#8217;oignon.</p>
</li>
<li class="data-line-587">
<p>Il travaille avec son partenaire de canal sur le canal sortant pour mettre à jour l&#8217;état du canal.</p>
</li>
</ol>
</div>
<div class="paragraph data-line-589">
<p>Bien entendu, ces étapes sont interrompues et abandonnées si une erreur est détectée, et un message d&#8217;erreur est renvoyé à l&#8217;expéditeur du message <code>update_add_htlc</code>. Le message d&#8217;erreur est également formaté comme un oignon et renvoyé sur le canal entrant.</p>
</div>
<div class="paragraph data-line-591">
<p>Au fur et à mesure que l&#8217;erreur se propage en arrière sur chaque canal le long du chemin, les partenaires de canal suppriment le paiement en attente, annulant le paiement dans le sens opposé à partir duquel il a commencé.</p>
</div>
<div class="paragraph data-line-593">
<p>Bien que la probabilité d&#8217;un échec de paiement soit élevée s&#8217;il ne se règle pas rapidement, un nœud ne doit jamais initier une autre tentative de paiement sur un chemin différent avant que l&#8217;oignon ne revienne avec une erreur. L&#8217;expéditeur paierait deux fois si les deux tentatives de paiement aboutissaient.</p>
</div>
</div>
</div>
<div class="sect2 data-line-595">
<h3 id="_cryptage_des_communications_de_pair_à_pair">Cryptage des communications de pair-à-pair</h3>
<div class="paragraph data-line-597">
<p>Le protocole LN est principalement un protocole pair-à-pair entre ses participants. Comme nous l&#8217;avons vu dans les sections précédentes, il existe deux fonctions qui se chevauchent dans le réseau, formant deux réseaux logiques qui forment ensemble <em>le Lightning Network</em> :</p>
</div>
<div class="olist arabic data-line-599">
<ol class="arabic">
<li class="data-line-599">
<p>Un large réseau pair-à-pair qui utilise un protocole de bavardage pour propager les informations de topologie, où les pairs se connectent au hasard les uns aux autres. Les pairs n&#8217;ont pas nécessairement de canaux de paiement entre eux, ils ne sont donc pas toujours des partenaires de canal.</p>
</li>
<li class="data-line-601">
<p>Un réseau de canaux de paiement entre partenaires de canal. Les partenaires de canal parlent également de topologie, ce qui signifie qu&#8217;ils sont des nœuds homologues dans le protocole de bavardage.</p>
</li>
</ol>
</div>
<div class="paragraph data-line-603">
<p>Toutes les communications entre pairs sont envoyées via des messages appelés <em>messages Lightning</em>. Ces messages sont tous cryptés à l&#8217;aide d&#8217;un framework de communications cryptographiques appelé <em>Noise Protocol Framework</em>. Le Noise Protocol Framework permet la construction de protocoles de communications cryptographiques qui offrent l&#8217;authentification, le cryptage, le secret de transmission et la confidentialité d&#8217;identité. Le Noise Protocol Framework est également utilisé dans un certain nombre de systèmes de communication cryptés de bout en bout populaires tels que WhatsApp, WireGuard et I2P. Plus d&#8217;informations peuvent être trouvées <a href="https://noiseprotocol.org" data-href="https://noiseprotocol.org">sur le site Web du Noise Protocol Framework</a>.</p>
</div>
<div class="paragraph data-line-605">
<p>L&#8217;utilisation du Noise Protocol Framework dans le Lightning Network garantit que chaque message sur le réseau est à la fois authentifié et encrypté, ce qui augmente la confidentialité du réseau et sa résistance à l&#8217;analyse de trafic, à l&#8217;inspection approfondie des paquets et à l&#8217;écoute clandestine. Cependant, comme effet secondaire, cela rend le développement et les tests de protocole un peu délicats car on ne peut pas simplement observer le réseau avec un outil de capture de paquets ou d&#8217;analyse de réseau tel que Wireshark. Au lieu de cela, les développeurs doivent utiliser des plug-ins spécialisés qui décryptent le protocole du point de vue d&#8217;un nœud, comme  <a href="https://github.com/nayutaco/lightning-dissector" data-href="https://github.com/nayutaco/lightning-dissector"><em>lightning dissector</em></a>, un plug-in Wireshark.</p>
</div>
</div>
<div class="sect2 data-line-607">
<h3 id="_réflexions_sur_la_confiance">Réflexions sur la confiance</h3>
<div class="paragraph data-line-608">
<p>Tant qu&#8217;une personne suit le protocole et que son nœud est sécurisé, il n&#8217;y a pas de risque majeur de perte de fonds lors de la participation au Lightning Network.
Cependant, il y a le coût du paiement des frais de chaîne lors de l&#8217;ouverture d&#8217;un canal.
Tout coût doit être accompagné d&#8217;un avantage correspondant.
Dans notre cas, la récompense pour Alice d&#8217;avoir supporté le coût d&#8217;ouverture d&#8217;un canal est qu&#8217;Alice peut envoyer et, après avoir déplacé certaines des fonds à l&#8217;autre bout du canal, recevoir des paiements en bitcoin sur le Lightning Network à tout moment, et qu&#8217;elle peut gagner des frais en bitcoin en transférant des paiements pour d&#8217;autres personnes.
Alice sait qu&#8217;en théorie, Bob peut fermer le canal immédiatement après son ouverture, ce qui entraîne des frais de fermeture sur la chaîne pour Alice.
Alice devra avoir un petit peu confiance en Bob.
Alice est allée au Café de Bob et il est clair que Bob est intéressé à vendre son café, donc Alice peut faire confiance à Bob dans ce sens.
Il y a des avantages mutuels pour Alice et Bob.
Alice décide que la récompense est suffisante pour qu&#8217;elle assume le coût des frais de chaîne pour la création d&#8217;un canal avec Bob.
En revanche, Alice n&#8217;ouvrira pas de canal avec quelqu&#8217;un d&#8217;inconnu qui vient de lui envoyer un e-mail sans y être invité lui demandant d&#8217;ouvrir un nouveau canal.</p>
</div>
</div>
<div class="sect2 data-line-619">
<h3 id="_comparaison_avec_bitcoin">Comparaison avec Bitcoin</h3>
<div class="paragraph data-line-621">
<p>Bien que le Lightning Network soit construit sur Bitcoin et hérite de plusieurs de ses fonctionnalités et propriétés, il existe des différences importantes dont les utilisateurs des deux réseaux doivent être conscients.</p>
</div>
<div class="paragraph data-line-623">
<p>Certaines de ces différences sont des différences de terminologie. Il existe également des différences architecturales et des différences dans l&#8217;expérience utilisateur. Dans les prochaines sections, nous examinerons les différences et les similitudes, expliquerons la terminologie et ajusterons nos attentes.</p>
</div>
<div class="sect3 data-line-625">
<h4 id="_adresses_versus_factures_transactions_versus_paiements">Adresses versus Factures, Transactions versus Paiements</h4>
<div class="paragraph data-line-627">
<p>Dans un paiement typique utilisant Bitcoin, un utilisateur reçoit une adresse Bitcoin (par exemple, en scannant un code QR sur une page Web, ou en le recevant dans un message instantané ou un e-mail d&#8217;un ami). Ils utilisent ensuite leur porte-monnaie Bitcoin pour créer une transaction afin d&#8217;envoyer des fonds à cette adresse.</p>
</div>
<div class="paragraph data-line-629">
<p>Sur le Lightning Network, le destinataire d&#8217;un paiement crée une facture. Une facture Lightning peut être considérée comme analogue à une adresse Bitcoin. Le destinataire prévu donne la facture Lightning à l&#8217;expéditeur sous forme de code QR ou de chaîne de caractères, tout comme une adresse Bitcoin.</p>
</div>
<div class="paragraph data-line-631">
<p>L&#8217;expéditeur utilise son porte-monnaie Lightning pour payer la facture, en copiant le texte de la facture ou en scannant le code QR de la facture. Un paiement Lightning est analogue à une « transaction » Bitcoin.</p>
</div>
<div class="paragraph data-line-633">
<p>Il existe cependant quelques différences dans l&#8217;expérience utilisateur. Une adresse Bitcoin est <em>réutilisable</em>. Les adresses Bitcoin n&#8217;expirent jamais, et si le propriétaire de l&#8217;adresse détient toujours les clés, les fonds détenus à l&#8217;intérieur sont toujours accessibles. Un expéditeur peut envoyer n&#8217;importe quelle quantité de bitcoins à une adresse précédemment utilisée, et un destinataire peut publier une seule adresse statique pour recevoir de nombreux paiements. Toutefois cela va à l&#8217;encontre des meilleures pratiques relatives à la confidentialité, c&#8217;est techniquement possible et en fait assez courant.</p>
</div>
<div class="paragraph data-line-635">
<p>Avec Lightning, en revanche, chaque facture ne peut être utilisée qu&#8217;une seule fois pour un montant de paiement spécifique. Vous ne pouvez pas payer plus ou moins, vous ne pouvez pas utiliser une facture à nouveau et la facture a un délai d&#8217;expiration intégré. Avec Lightning, un destinataire doit générer une nouvelle facture pour chaque paiement, en spécifiant le montant du paiement à l&#8217;avance. Il existe une exception à cela, un mécanisme appelé <em>keysend</em>, que nous examinerons dans <a href="#keysend">[keysend]</a>.</p>
</div>
</div>
<div class="sect3 data-line-637">
<h4 id="_sélection_des_sorties_versus_trouver_dun_chemin">Sélection des sorties versus Trouver d&#8217;un chemin</h4>
<div class="paragraph data-line-639">
<p>Pour effectuer un paiement sur le réseau Bitcoin, un expéditeur doit consommer une ou plusieurs sorties de transaction non dépensées (UTXO).
Si un utilisateur a plusieurs UTXO, il (ou plutôt son porte-monnaie) devra sélectionner le ou les UTXO à envoyer.
Par exemple, un utilisateur effectuant un paiement de 1 BTC peut utiliser une seule sortie avec une valeur de 1 BTC, deux sorties avec une valeur de 0,25 BTC et 0,75 BTC, ou quatre sorties avec une valeur de 0,25 BTC chacune.</p>
</div>
<div class="paragraph data-line-643">
<p>Sur Lightning, les paiements ne nécessitent pas la consommation d&#8217;entrées. Au lieu de cela, chaque paiement entraîne une mise à jour du solde du canal, le redistribuant entre les deux partenaires du canal. L&#8217;expéditeur vit cela comme un "déplacement" de solde du canal de son extrémité d&#8217;un canal à l&#8217;autre extrémité, vers son partenaire de canal. Les paiements Lightning utilisent une série de canaux pour s&#8217;acheminer de l&#8217;expéditeur au destinataire. Chacun de ces canaux doit avoir une capacité suffisante pour acheminer le paiement.</p>
</div>
<div class="paragraph data-line-645">
<p>Étant donné que de nombreux canaux et chemins possibles peuvent être utilisés pour effectuer un paiement, le choix des canaux et des chemins par l&#8217;utilisateur de Lightning est quelque peu analogue au choix d&#8217;UTXO par l&#8217;utilisateur de Bitcoin.</p>
</div>
<div class="paragraph data-line-647">
<p>Avec des technologies telles que les paiements multivoies atomiques (AMP) et les paiements multipartites (MPP), que nous examinerons dans les chapitres suivants, plusieurs chemins Lightning peuvent être agrégés en un seul paiement atomique, tout comme plusieurs UTXO Bitcoin peuvent être agrégés en une seule transaction Bitcoin atomique.</p>
</div>
</div>
<div class="sect3 data-line-649">
<h4 id="_sorties_de_monnaie_sur_bitcoin_versus_pas_de_monnaie_sur_lightning">Sorties de monnaie sur Bitcoin versus Pas de monnaie sur Lightning</h4>
<div class="paragraph data-line-651">
<p>Pour effectuer un paiement sur le réseau Bitcoin, l&#8217;expéditeur doit consommer une ou plusieurs sorties de transaction non dépensées (UTXO). Les UTXO ne peuvent être dépensés qu&#8217;en totalité ; elles ne peuvent pas être divisées et partiellement dépensées. Ainsi, si un utilisateur souhaite dépenser 0,8 BTC, mais ne dispose que d&#8217;un UTXO de 1 BTC, il doit dépenser la totalité de l&#8217;UTXO de 1 BTC en envoyant 0,8 BTC au destinataire et 0,2 BTC à lui-même en tant que monnaie. Le paiement de modification de 0,2 BTC crée un nouvel UTXO appelé "sortie de monnaie".</p>
</div>
<div class="paragraph data-line-653">
<p>Sur Lightning, la transaction de financement dépense des  UTXO Bitcoin, créant un UTXO multisignature pour ouvrir le canal. Une fois que les bitcoins sont verrouillés dans ce canal, des parties de celui-ci peuvent être envoyées dans les deux sens dans le canal, sans qu&#8217;il soit nécessaire de créer de monnaie.
En effet, les partenaires de canal mettent simplement à jour le solde du canal et ne créent un nouvel UTXO que lorsque le canal est finalement fermé à l&#8217;aide de la transaction de fermeture de canal.</p>
</div>
</div>
<div class="sect3 data-line-656">
<h4 id="_frais_de_minage_versus_frais_de_routage">Frais de minage versus Frais de routage</h4>
<div class="paragraph data-line-658">
<p>Sur le réseau Bitcoin, les utilisateurs paient des frais aux mineurs pour que leurs transactions soient incluses dans un bloc.
Ces frais sont payés au mineur qui mine ce bloc particulier.
Le montant des frais est basé sur la <em>taille</em> de la transaction en <em>octets</em> que la transaction utilise dans un bloc, ainsi que sur la rapidité avec laquelle l&#8217;utilisateur souhaite que cette transaction soit minée.
Étant donné que les mineurs minent généralement les transactions les plus rentables en premier, un utilisateur qui souhaite que sa transaction soit minée immédiatement paiera des frais <em>plus élevés</em> par octet, tandis qu&#8217;un utilisateur qui n&#8217;est pas pressé paiera des frais <em>inférieurs</em> par octet.</p>
</div>
<div class="paragraph data-line-663">
<p>Sur le Lightning Network, les utilisateurs paient des frais à d&#8217;autres utilisateurs (nœud intermédiaire) pour acheminer les paiements via leurs canaux.
Pour acheminer un paiement, un nœud intermédiaire devra déplacer des fonds dans deux ou plusieurs canaux qu&#8217;il possède, ainsi que transmettre les données pour le paiement de l&#8217;expéditeur. En règle générale, l&#8217;utilisateur du routage facturera l&#8217;expéditeur en fonction de la <em>valeur</em> du paiement, après avoir établi un minimum  <em>frais de base</em> (des frais fixes pour chaque paiement) et un <em>taux de frais</em> (frais au prorata, proportionnels, à la valeur du paiement). Les paiements de valeur plus élevée coûteront donc plus cher à acheminer, et un marché de liquidités se forme, où différents utilisateurs facturent des frais différents pour l&#8217;acheminement via leurs canaux.</p>
</div>
</div>
<div class="sect3 data-line-666">
<h4 id="_frais_variables_en_fonction_du_trafic_versus_frais_annoncés">Frais variables en fonction du trafic versus Frais annoncés</h4>
<div class="paragraph data-line-668">
<p>Sur le réseau Bitcoin, les mineurs sont à la recherche de profits et incluront généralement autant de transactions que possible dans un bloc, tout en restant dans la capacité de bloc appelée le <em>poids du bloc</em>.</p>
</div>
<div class="paragraph data-line-670">
<p>S&#8217;il y a plus de transactions dans la file d&#8217;attente (appelée <em>mempool</em>) qu&#8217;un bloc ne peut en contenir, ils commenceront par miner les transactions qui paient les frais les plus élevés par unité (octets) de <em>poids de transaction</em>.
Ainsi, lorsqu&#8217;il y a de nombreuses transactions dans la file d&#8217;attente, les utilisateurs doivent payer des frais plus élevés pour être inclus dans le bloc suivant, ou ils doivent attendre qu&#8217;il y ait moins de transactions dans la file d&#8217;attente.
Cela conduit naturellement à l&#8217;émergence d&#8217;un marché des frais où les utilisateurs paient en fonction de l&#8217;urgence avec laquelle ils ont besoin que leur transaction soit incluse dans le bloc suivant.</p>
</div>
<div class="paragraph data-line-674">
<p>La ressource rare sur le réseau Bitcoin est l&#8217;espace dans les blocs. Les utilisateurs de Bitcoin se disputent l&#8217;espace de bloc, et le marché des frais de Bitcoin est basé sur l&#8217;espace de bloc disponible. Les ressources rares du Lightning Network sont la <em>liquidité de canal</em> (capacité de fonds disponibles pour le routage dans les canaux) et <em>connectivité de canal</em> (combien de canaux des nœuds bien connectés peuvent atteindre). Les utilisateurs de Lightning se disputent la capacité <span class="keep-together">et la connectivité</span> ; par conséquent, le marché des frais Lightning est déterminé par la capacité et la <span class="keep-together">connectivité</span>.</p>
</div>
<div class="paragraph data-line-676">
<p>Sur le Lightning Network, les utilisateurs paient des frais aux utilisateurs acheminant leurs paiements. Acheminer un paiement, en termes économiques, n&#8217;est rien de plus que fournir et attribuer de la capacité à l&#8217;expéditeur. Naturellement, les routeurs qui facturent des frais moins élevés pour la même capacité seront plus intéressants pour l&#8217;acheminement. Il existe donc un marché des frais où les routeurs sont en concurrence les uns avec les autres sur les frais qu&#8217;ils facturent pour acheminer les paiements via leurs canaux.</p>
</div>
</div>
<div class="sect3 data-line-678">
<h4 id="_transactions_bitcoin_publiques_versus_paiements_lightning_privés">Transactions Bitcoin publiques versus Paiements Lightning privés</h4>
<div class="paragraph data-line-680">
<p>Sur le réseau Bitcoin, chaque transaction est visible publiquement sur la blockchain Bitcoin. Bien que les adresses impliquées soient pseudonymes et ne soient généralement pas liées à une identité, elles sont toujours vues et validées par tous les autres utilisateurs du réseau.
De plus, les sociétés de surveillance blockchain collectent et analysent ces données en masse et les vendent à des parties intéressées telles que des entreprises privées, des gouvernements et des agences de renseignement.</p>
</div>
<div class="paragraph data-line-683">
<p>Les paiements LN, en revanche, sont presque entièrement privés. En règle générale, seuls l&#8217;expéditeur et le destinataire sont pleinement conscients de la source, de la destination et du montant traité dans un paiement particulier. De plus, le destinataire peut même ne pas connaître la source du paiement. Étant donné que les paiements sont acheminés en oignon, les utilisateurs qui acheminent le paiement ne connaissent que le montant du paiement et ils ne peuvent déterminer ni la source ni la destination.</p>
</div>
<div class="paragraph data-line-685">
<p>En résumé, les transactions Bitcoin sont diffusées publiquement et stockées pour toujours. Les paiements Lightning sont exécutés entre quelques pairs sélectionnés, et les informations les concernant ne sont stockées en privé que jusqu&#8217;à la fermeture du canal. Créer des outils de surveillance et d&#8217;analyse de masse équivalents à ceux utilisés sur Bitcoin sera beaucoup plus difficile sur Lightning.</p>
</div>
</div>
<div class="sect3 data-line-687">
<h4 id="_attente_de_confirmations_versus_règlement_instantané">Attente de confirmations versus Règlement instantané</h4>
<div class="paragraph data-line-689">
<p>Sur le réseau Bitcoin, les transactions ne sont réglées qu&#8217;une fois qu&#8217;elles ont été incluses dans un bloc, auquel cas elles sont dites "confirmées " dans ce bloc. Au fur et à mesure que de plus en plus de blocs sont minés, la transaction acquiert plus de "confirmations" et est considérée comme plus sûre.</p>
</div>
<div class="paragraph data-line-691">
<p>Sur le Lightning Network, les confirmations ne comptent que pour l&#8217;ouverture et la fermeture de canaux sur la chaîne. Une fois qu&#8217;une transaction de financement a atteint un nombre approprié de confirmations (par exemple, 3), les partenaires de canal considèrent que le canal est ouvert. Étant donné que les bitcoins dans le canal sont sécurisés par un contrat intelligent qui gère ce canal, les paiements sont réglés <em>instantanément</em> une fois reçus par le destinataire final.
Concrètement, le règlement instantané signifie que les paiements ne prennent que quelques secondes pour être exécutés et réglés. Comme avec Bitcoin, les paiements Lightning ne sont pas réversibles.</p>
</div>
<div class="paragraph data-line-694">
<p>Enfin, lorsque le canal est fermé, une transaction est effectuée sur le réseau Bitcoin ; une fois cette transaction confirmée, le canal est considéré comme fermé.</p>
</div>
</div>
<div class="sect3 data-line-696">
<h4 id="_envoi_de_montants_arbitraires_versus_restrictions_de_capacité">Envoi de montants arbitraires versus Restrictions de capacité</h4>
<div class="paragraph data-line-698">
<p>Sur le réseau Bitcoin, un utilisateur peut envoyer n&#8217;importe quelle quantité de bitcoin qu&#8217;il possède à un autre utilisateur, sans restriction de capacité. Une seule transaction peut théoriquement envoyer jusqu&#8217;à 21 millions de bitcoins comme paiement.</p>
</div>
<div class="paragraph data-line-700">
<p>Sur le Lightning Network, un utilisateur ne peut envoyer à un partenaire de canal que la quantité de bitcoins qui existe actuellement de son côté d&#8217;un canal particulier. Par exemple, si un utilisateur possède un canal avec 0,4 BTC de son côté et un autre canal avec 0,2 BTC de son côté, le maximum qu&#8217;il peut envoyer avec un paiement est de 0,4 BTC. Cela est vrai quelle que soit la quantité de bitcoins que l&#8217;utilisateur possède actuellement dans son porte-monnaie Bitcoin.</p>
</div>
<div class="paragraph data-line-702">
<p>Les paiements en plusieurs parties (MPP) sont une fonctionnalité qui, dans l&#8217;exemple précédent, permet à l&#8217;utilisateur de combiner à la fois ses canaux 0,4 BTC et 0,2 BTC pour envoyer un maximum de 0,6 BTC en un paiement. Les MPP sont actuellement testés sur le Lightning Network et devraient être largement disponibles et utilisés au moment où ce livre sera terminé. Pour plus de détails sur les MPP, voir <a href="#mpp">[mpp]</a>.</p>
</div>
<div class="paragraph data-line-704">
<p>Si le paiement est acheminé, chaque nœud de routage le long du chemin de routage doit avoir des canaux avec une capacité au moins égale au montant du paiement acheminé. Cela doit être vrai pour chaque canal par lequel le paiement est acheminé. La capacité du canal de capacité la plus faible dans un chemin fixe la limite supérieure de la capacité de l&#8217;ensemble du chemin.</p>
</div>
<div class="paragraph data-line-706">
<p>Par conséquent, la capacité et la connectivité sont des ressources critiques et rares sur le Lightning Network.</p>
</div>
</div>
<div class="sect3 data-line-708">
<h4 id="_incitations_pour_les_paiements_de_grande_valeur_versus_paiements_de_petite_valeur">Incitations pour les Paiements de grande valeur versus Paiements de petite valeur</h4>
<div class="paragraph data-line-710">
<p>La structure des frais sur Bitcoin est indépendante de la valeur de la transaction.
Une transaction de 1 million de dollars implique les mêmes frais qu&#8217;une transaction de 1 dollar sur Bitcoin, en supposant une taille de transaction similaire, en octets (plus précisément des octets "virtuels" depuis SegWit [Segregated Witness protocol]).
Sur Lightning, les frais sont des frais fixes plus un pourcentage de la valeur de la transaction.
Par conséquent, sur Lightning, les frais de paiement augmentent avec la valeur du paiement.
Ces structures de frais opposées créent des incitations différentes et conduisent à une utilisation différente en ce qui concerne la valeur de la transaction.
Une transaction de plus grande valeur sera moins chère sur Bitcoin ; par conséquent, les utilisateurs préféreront Bitcoin pour les transactions de grande valeur. De même, à l&#8217;autre bout de l&#8217;échelle, les utilisateurs préféreront Lightning pour les transactions de faible valeur.</p>
</div>
</div>
<div class="sect3 data-line-717">
<h4 id="_utiliser_la_blockchain_comme_un_registre_versus_comme_un_système_judiciaire">Utiliser la blockchain Comme un registre versus Comme un système judiciaire</h4>
<div class="paragraph data-line-719">
<p>Sur le réseau Bitcoin, chaque transaction est finalement enregistrée dans un bloc de la blockchain.
La blockchain forme ainsi un historique complet de chaque transaction depuis la création de Bitcoin, et un moyen d&#8217;auditer entièrement chaque bitcoin existant.
Une fois qu&#8217;une transaction est incluse dans la blockchain, elle est définitive.
Ainsi, aucun litige ne peut survenir et la quantité de bitcoins contrôlée par une adresse particulière à un point particulier de la blockchain est sans ambiguïté.</p>
</div>
<div class="paragraph data-line-724">
<p>Sur le Lightning Network, le solde d&#8217;un canal à un moment donné n&#8217;est connu que des deux partenaires du canal et n&#8217;est rendu visible au reste du réseau que lorsque le canal est fermé.
Lorsque le canal est fermé, le solde final du canal est soumis à la blockchain Bitcoin et chaque partenaire reçoit sa part des bitcoins dans ce canal.
Par exemple, si le solde d&#8217;ouverture était de 1 BTC payé par Alice et qu&#8217;Alice a effectué un paiement de 0,3 BTC à Bob, le solde final du canal est de 0,7 BTC pour Alice et de 0,3 BTC pour Bob.
Si Alice essaie de tricher en soumettant l&#8217;état d&#8217;ouverture du canal à la blockchain Bitcoin, avec 1 BTC pour Alice et 0 BTC pour Bob, alors Bob peut riposter en soumettant le véritable état final du canal, ainsi qu&#8217;en créant une transaction de pénalité qui lui donne tous les bitcoins dans le canal.
Pour le Lightning Network, la blockchain Bitcoin agit comme un système judiciaire.
Comme un juge robotique, Bitcoin enregistre les soldes initiaux et finaux de chaque canal et approuve les sanctions si l&#8217;une des parties tente de tricher.</p>
</div>
</div>
<div class="sect3 data-line-731">
<h4 id="_hors_ligne_versus_en_ligne_asynchrone_versus_synchrone">Hors ligne versus En ligne, Asynchrone versus Synchrone</h4>
<div class="paragraph data-line-733">
<p>Lorsqu&#8217;un utilisateur Bitcoin envoie des fonds à une adresse de destination, il n&#8217;a pas besoin de savoir quoi que ce soit sur le destinataire. Le destinataire peut être hors ligne ou en ligne, et aucune interaction entre l&#8217;expéditeur et le destinataire n&#8217;est nécessaire. L&#8217;interaction se fait entre l&#8217;expéditeur et la blockchain Bitcoin. Recevoir des bitcoins sur la blockchain Bitcoin est une activité <em>passive</em> et <em>asynchrone</em> qui ne nécessite aucune interaction de la part du destinataire ou que le destinataire soit en ligne à tout moment. Les adresses Bitcoin peuvent même être générées hors ligne et ne sont jamais "répertoriées" sur le réseau Bitcoin. Seules les dépenses en bitcoins nécessitent une interaction.</p>
</div>
<div class="paragraph data-line-735">
<p>Sur Lightning, le destinataire doit être en ligne pour effectuer le paiement avant son expiration.
Le destinataire doit exécuter un nœud ou avoir quelqu&#8217;un qui exécute un nœud en son nom (un dépositaire tiers). Pour être précis, les deux nœuds, celui de l&#8217;expéditeur et celui du destinataire, doivent être en ligne au moment du paiement et doivent se coordonner. La réception d&#8217;un paiement Lightning est une activité <em>active</em> et <em>synchrone</em> entre l&#8217;expéditeur et le destinataire, sans la participation de la majeure partie du Lightning Network ou du réseau Bitcoin (à l&#8217;exception des nœuds de routage intermédiaires, le cas échéant).</p>
</div>
<div class="paragraph data-line-738">
<p>La nature synchrone et toujours en ligne du Lightning Network est probablement la plus grande différence pour l&#8217;expérience utilisateur, et cela déroute souvent les utilisateurs habitués au Bitcoin.</p>
</div>
</div>
<div class="sect3 data-line-740">
<h4 id="_satoshis_versus_millisatoshis">Satoshis versus Millisatoshis</h4>
<div class="paragraph data-line-742">
<p>Sur le réseau Bitcoin, le plus petit montant est un <em>satoshi</em>, qui ne peut pas être divisé davantage. Lightning est un peu plus flexible et les nœuds Lightning fonctionnent avec des <em>millisatoshis</em> (millièmes de satoshi). Cela permet d&#8217;envoyer de petits paiements via Lightning. Un seul paiement millisatoshi peut être envoyé via un canal de paiement, un montant si petit qu&#8217;il devrait être qualifié de <em>nanopaiement</em>.</p>
</div>
<div class="paragraph data-line-744">
<p>L&#8217;unité millisatoshi ne peut bien sûr pas être réglée sur la blockchain Bitcoin à cette granularité. À la fermeture du canal, les soldes sont arrondis au satoshi le plus proche. Mais sur la durée de vie d&#8217;un canal, des millions de nanopaiements sont possibles au niveau des millisatoshis. Le Lightning Network franchit la barrière du micropaiement.</p>
</div>
</div>
</div>
<div class="sect2 data-line-746">
<h3 id="_points_communs_entre_bitcoin_et_lightning">Points communs entre Bitcoin et Lightning</h3>
<div class="paragraph data-line-748">
<p>Alors que le Lightning Network diffère de Bitcoin de plusieurs manières, notamment en termes d&#8217;architecture et d&#8217;expérience utilisateur, il est construit à partir de Bitcoin et conserve de nombreuses fonctionnalités de base de Bitcoin.</p>
</div>
<div class="sect3 data-line-750">
<h4 id="_unité_monétaire">Unité monétaire</h4>
<div class="paragraph data-line-752">
<p>Le réseau Bitcoin et le Lightning Network utilisent les mêmes unités monétaires : le bitcoin. Les paiements Lightning utilisent le même bitcoin que les transactions Bitcoin. Par implication, parce que l&#8217;unité monétaire est la même, la limite monétaire est la même : moins de 21 millions de bitcoins. Sur les 21 millions de bitcoins au total de Bitcoin, certains sont déjà attribués à des adresses multisignatures sur 2-de-2 dans le cadre des canaux de paiement sur le Lightning Network.</p>
</div>
</div>
<div class="sect3 data-line-754">
<h4 id="_irréversibilité_et_caractère_définitif_des_paiements">Irréversibilité et caractère définitif des paiements</h4>
<div class="paragraph data-line-756">
<p>Les transactions Bitcoin et les paiements Lightning sont irréversibles et immuables. Il n&#8217;y a pas d&#8217;opération "annuler" ou de "rétrofacturation" pour l&#8217;un ou l&#8217;autre système. En tant qu&#8217;expéditeur de l&#8217;un ou l&#8217;autre, vous devez agir de manière responsable, mais aussi, en tant que destinataire, vous êtes assuré de la finalité de vos transactions.</p>
</div>
</div>
<div class="sect3 data-line-758">
<h4 id="_confiance_et_risque_de_contrepartie">Confiance et risque de contrepartie</h4>
<div class="paragraph data-line-760">
<p>Comme pour Bitcoin, Lightning exige que l&#8217;utilisateur fasse uniquement confiance aux mathématiques, au cryptage et que le logiciel ne présente aucun bogue critique. Ni Bitcoin, ni Lightning n&#8217;obligent l&#8217;utilisateur à faire confiance à une personne, une entreprise, une institution ou un gouvernement.
Étant donné que Lightning repose sur Bitcoin et s&#8217;appuie sur Bitcoin comme couche de base sous-jacente, il est clair que le modèle de sécurité de Lightning se réduit à la sécurité de Bitcoin. Cela signifie que Lightning offre globalement la même sécurité que Bitcoin dans la plupart des circonstances, avec seulement une légère réduction de la sécurité dans certaines circonstances spécifiques.</p>
</div>
</div>
<div class="sect3 data-line-763">
<h4 id="_exploitation_sans_permission">Exploitation sans permission</h4>
<div class="paragraph data-line-765">
<p>Bitcoin et Lightning peuvent être utilisés par toute personne ayant accès à Internet et au logiciel approprié, par exemple, nœud et porte-monnaie.
Aucun des deux réseaux n&#8217;exige que les utilisateurs obtiennent la permission, la vérification ou l&#8217;autorisation de tiers, d&#8217;entreprises, d&#8217;institutions ou d&#8217;un gouvernement. Les gouvernements peuvent interdire Bitcoin ou Lightning dans leur juridiction, mais ne peuvent pas empêcher leur utilisation mondiale.</p>
</div>
</div>
<div class="sect3 data-line-768">
<h4 id="_open_source_et_système_ouvert">Open source et système ouvert</h4>
<div class="paragraph data-line-770">
<p>Bitcoin et Lightning sont des systèmes logiciels open source construits par une communauté mondiale décentralisée de bénévoles, disponibles sous licences ouvertes. Les deux sont basés sur des protocoles ouverts et interopérables qui fonctionnent comme des systèmes ouverts et des réseaux ouverts. Globaux, ouverts et gratuits.</p>
</div>
</div>
</div>
<div class="sect2 data-line-772">
<h3 id="_conclusion">Conclusion</h3>
<div class="paragraph data-line-774">
<p>Dans ce chapitre, nous avons examiné le fonctionnement réel du Lightning Network et tous ses composants. Nous avons examiné chaque étape de la construction, de l&#8217;exploitation et de la fermeture d&#8217;un canal. Nous avons examiné comment les paiements sont acheminés, et enfin, nous avons comparé Lightning avec Bitcoin et analysé leurs différences et leurs points communs.</p>
</div>
<div class="paragraph data-line-776">
<p>Dans les prochains chapitres, nous reviendrons sur tous ces sujets, mais de manière beaucoup plus détaillée.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. Alors que le livre blanc original de Lightning décrivait les canaux financés par les deux partenaires de canal, la spécification actuelle, en 2020, suppose qu&#8217;un seul partenaire engage des fonds dans le canal. Depuis mai 2021, des canaux Lightning à double financement sont en expérimentation dans l&#8217;implémentation du LN c-lightning.
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. George Danezis and Ian Goldberg, "Sphinx: A Compact and Provably Secure Mix Format," in <em>IEEE Symposium on Security and Privacy</em> (New York: IEEE, 2009), 269–282.
</div>
<div class="footnote" id="_footnotedef_3">
<a href="#_footnoteref_3">3</a>. Le terme "onion" (oignon) a été utilisé à l&#8217;origine par le projet Tor. D&#8217;ailleurs, le réseau Tor est aussi appelé le réseau Onion et le projet utilise un oignon comme logo. Le nom de domaine de premier niveau utilisé par les services Tor sur l&#8217;internet est <em>onion</em>.
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2023-04-28 02:37:26 -0400
</div>
</div>
</body>
</html>